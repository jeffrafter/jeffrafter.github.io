<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.237ba1bc08ffadef5a9e.css">html{box-sizing:border-box;margin:0;padding:0}*,:after,:before{box-sizing:inherit}body{margin:0!important;padding:0}a.anchor,a.anchor:hover,a.anchor:link{background:none!important}figure a.gatsby-resp-image-link{background:none}figure span.gatsby-resp-image-wrapper{max-width:100%!important}article .excerpt{display:none}.btn,.button{display:inline-block;background:none!important;border-radius:40px;line-height:40px;min-height:40px;min-width:80px;padding:0 12px;text-align:center;text-decoration:none;border:1px solid #666;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}@font-face{font-family:et-book;src:url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.eot);src:url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.woff) format("woff"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.ttf) format("truetype"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.svg#etbookromanosf) format("svg");font-weight:400;font-style:normal}@font-face{font-family:et-book;src:url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.eot);src:url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.woff) format("woff"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.ttf) format("truetype"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.svg#etbookromanosf) format("svg");font-weight:400;font-style:italic}@font-face{font-family:et-book;src:url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.eot);src:url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.woff) format("woff"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.ttf) format("truetype"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.svg#etbookromanosf) format("svg");font-weight:700;font-style:normal}@font-face{font-family:et-book-roman-old-style;src:url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.eot);src:url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.woff) format("woff"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.ttf) format("truetype"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.svg#etbookromanosf) format("svg");font-weight:400;font-style:normal}html{font-size:15px}body{width:87.5%;margin-left:auto;margin-right:auto;padding-left:12.5%;font-family:et-book,Palatino,Palatino Linotype,Palatino LT STD,Book Antiqua,Georgia,serif;background-color:#fffff8;color:#111;max-width:1400px;counter-reset:sidenote-counter}h1{font-weight:400;margin-top:4rem;margin-bottom:1.5rem;font-size:3.2rem;line-height:1}h2{margin-top:2.1rem;font-size:2.2rem}h2,h3{font-style:italic;font-weight:400;margin-bottom:1.4rem;line-height:1}h3{font-size:1.7rem;margin-top:2rem}hr{display:block;height:1px;width:55%;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}p.subtitle{font-style:italic;margin-top:1rem;margin-bottom:1rem;font-size:1.8rem;display:block;line-height:1}.numeral{font-family:et-book-roman-old-style}.danger{color:red}article{position:relative;padding:1rem 0}section{padding-top:1rem;padding-bottom:1rem}ol,p,ul{font-size:1.4rem;line-height:2rem}p{margin-top:1.4rem;margin-bottom:1.4rem;padding-right:0;vertical-align:baseline}div.epigraph{margin:5em 0}div.epigraph>blockquote{margin-top:3em;margin-bottom:3em}div.epigraph>blockquote,div.epigraph>blockquote>p{font-style:italic}div.epigraph>blockquote>footer{font-style:normal}div.epigraph>blockquote>footer>cite{font-style:italic}blockquote{font-size:1.4rem}blockquote p{width:55%;margin-right:40px;font-style:italic;color:#999}blockquote footer{width:55%;font-size:1.1rem;text-align:right}section>footer,section>p,section>table{width:55%;clear:left}section>ol,section>ul{width:55%;-webkit-padding-start:5%}li:not(:first-child){margin-top:.25rem}figure{padding:0;border:0;font-size:100%;font:inherit;max-width:55%;-webkit-margin-start:0;-webkit-margin-end:0;-webkit-margin-before:0;margin-block-start:0;-webkit-margin-after:0;margin-block-end:0;margin:0 0 3em}figcaption,figure{vertical-align:baseline}figcaption{margin-top:-2em;margin-bottom:0;font-size:1.1rem;font-style:italic;line-height:1.6;position:relative;max-width:40%}figure.fullwidth figcaption{max-width:80%}a:link,a:visited{color:inherit}a:link{text-decoration:none;border-bottom:1px solid #000;padding-bottom:.05em;margin-bottom:.05em;word-break:break-word}a.anchor:link,nav.navigation a{border-bottom:0;padding-bottom:0;margin-bottom:0}@media screen and (-webkit-min-device-pixel-ratio:0){a:link{background-position-y:101%,101%,101%}}img{max-width:100%}.sidenote{margin-bottom:2em!important}.marginnote,.sidenote{float:right;clear:right;width:45%;margin:0 -75% 0 5%;font-size:1.1rem;line-height:1.3;vertical-align:baseline;position:relative}.sidenote-number{counter-increment:sidenote-counter}.sidenote-number:after,.sidenote:before{font-family:et-book-roman-old-style;position:relative;vertical-align:baseline}.sidenote-number:after{content:counter(sidenote-counter);font-size:1rem;top:-.5rem;left:.1rem}.sidenote:before{content:counter(sidenote-counter) " ";font-size:1rem;top:-.5rem}blockquote .marginnote,blockquote .sidenote{margin-right:-82%;min-width:59%;text-align:left}div.fullwidth,table.fullwidth{width:100%}div.table-wrapper{overflow-x:auto}.sans,div.table-wrapper{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}.sans{letter-spacing:.03em}code{font-family:Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:1rem;line-height:1.42}.sans>code{font-size:1.2rem}h1>code,h2>code,h3>code{font-size:.8em}.marginnote>code,.sidenote>code{font-size:1rem}pre.code{font-size:.9rem;width:52.5%;margin-left:2.5%;overflow-x:auto}pre.code.fullwidth{width:90%}.fullwidth{max-width:100%;clear:both}span.newthought{font-variant:small-caps;font-size:1.2em}input.margin-toggle{display:none}label.sidenote-number{display:inline}label.margin-toggle:not(.sidenote-number){display:none}.iframe-wrapper{position:relative;padding-bottom:56.25%;padding-top:25px;height:0}.iframe-wrapper iframe{position:absolute;top:0;left:0;width:100%;height:100%}@media (max-width:760px){body{padding-left:8%;padding-right:8%}body,hr,section>footer,section>p,section>table{width:100%}pre.code{width:97%}section>ol,section>ul{width:90%}figure{max-width:90%}figcaption,figure.fullwidth figcaption{margin-right:0;max-width:none}blockquote{margin-left:1.5em;margin-right:0}blockquote footer,blockquote p{width:100%}label.margin-toggle:not(.sidenote-number){display:inline}.marginnote,.sidenote{display:none}.margin-toggle:checked+.marginnote,.margin-toggle:checked+.sidenote{display:block;float:left;left:1rem;clear:both;width:95%;margin:1rem 2.5%;vertical-align:baseline;position:relative}label{cursor:pointer}div.table-wrapper,table{width:85%}img{width:100%}}:not(pre)>code[class*=language-]{font-size:.9em!important}.gatsby-highlight:after{content:"";display:block;clear:both}.gatsby-highlight{clear:both}h4{font-size:1.3em}.markdown-body ol,.markdown-body p,.markdown-body ul{font-size:inherit;line-height:inherit}.markdown-body blockquote{font-size:inherit}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:24px;letter-spacing:normal;border-bottom:1px solid #efefef}@media (max-width:767px){.markdown-body{padding:15px}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;-o-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;-o-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;-o-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;-o-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;-o-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;-o-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;-o-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;-o-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;-o-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;-o-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;-o-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;-o-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><meta name="generator" content="Gatsby 2.23.4"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://jeffrafter.com/releasing-github-actions/" data-baseprotocol="https:" data-basehost="jeffrafter.com"/><link rel="icon" href="/favicon-32x32.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><title data-react-helmet="true">Releasing GitHub Actions | Jeff Rafter</title><meta data-react-helmet="true" name="description" content="Once you&#x27;ve made some amazing GitHub Actions, you&#x27;ll want to re-use them and share them with your friends. To do that you&#x27;ll want to organize your project a little differently, publish and release them."/><meta data-react-helmet="true" property="og:title" content="Releasing GitHub Actions"/><meta data-react-helmet="true" property="og:description" content="Once you&#x27;ve made some amazing GitHub Actions, you&#x27;ll want to re-use them and share them with your friends. To do that you&#x27;ll want to organize your project a little differently, publish and release them."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://jeffrafter.com//static/d0a43dcf6d9204bf622e7ba48c8ea463/10e03/actions.png"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Jeff Rafter"/><meta data-react-helmet="true" name="twitter:title" content="Releasing GitHub Actions"/><meta data-react-helmet="true" name="twitter:description" content="Once you&#x27;ve made some amazing GitHub Actions, you&#x27;ll want to re-use them and share them with your friends. To do that you&#x27;ll want to organize your project a little differently, publish and release them."/><meta data-react-helmet="true" name="keywords" content="typescript, github, actions, honk, goose"/><style data-styled="coseIW ddlDEo bOnSNx gXLbcD aCPwf" data-styled-version="4.4.1">
/* sc-component-id: sc-global-3268680936 */
::selection{background-color:#dad9d9;color:rgba(0,0,0,0.70);}
/* sc-component-id: sc-bdVaJa */
.coseIW ul{list-style-type:none;margin:1rem 0;padding:0;margin-left:-16px;} .coseIW li{display:inline-block;margin:16px;} .coseIW li a{background:none;}
/* sc-component-id: sc-bwzfXH */
.aCPwf{padding-bottom:36px;}
/* sc-component-id: sc-ifAKCX */
.ddlDEo{width:55%;}
/* sc-component-id: sc-gzVnrw */
.bOnSNx{margin-top:40px;margin-bottom:40px;float:right;}
/* sc-component-id: sc-htoDjs */
.gXLbcD{list-style-type:none;} .gXLbcD li::before{content:'' !important;padding-right:0 !important;}</style><link as="script" rel="preload" href="/webpack-runtime-b2bee9accda6121d83bd.js"/><link as="script" rel="preload" href="/framework-95b680cb3190aa9bfe59.js"/><link as="script" rel="preload" href="/styles-24c541b6ac347bae38f1.js"/><link as="script" rel="preload" href="/app-51d0929071629bddce45.js"/><link as="script" rel="preload" href="/commons-6458b952aa116f5f11f8.js"/><link as="script" rel="preload" href="/109cf451cc5d7f6d2abc8e688d09142e78350594-53a6b222a8910dfb5d1b.js"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-7133ab7322325c379163.js"/><link as="fetch" rel="preload" href="/page-data/releasing-github-actions/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav class="sc-bdVaJa coseIW navigation"><ul><li><a href="/">&amp;</a></li><li><a href="/tags">Tags</a></li><li><a href="/about">About</a></li></ul></nav><main class="content" role="main"><article><header><h1>Releasing GitHub Actions</h1><p>January 31, 2020</p></header><div class="page-content"><div><section><figure class="fullwidth"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+klEQVQoz0WRyW7bMBCG/bS99wkKpO9Q9NDlVKBBekwOaWvHdtw68VZJsaldpEhKpKjNi6zItORUQFPkB/6Zy3zzYzCdpq6XujOcmQBY9opqGpwqwCdCsLRpmv2+tG0HAP3xsZLy+FhVh+pQ/1dHHqrR9GGkoOls7hrB/IbMVeMhkCbONpuNpmrnX8/fnp1dXHwrysO+rNolp9PTP3VauxAD08OUuTBAJI7jdKw4uhcbwCKYUsLuxpPFfEFpmKT5riib5vQCizhVtBUkfJPzfWJkWTYcDrXFKk12ZSVjTgTzt5uChyElYZzk7S0v8EHWaZZvdwdJv5xWr4Tb5VGOfQQRPJ6eZHQV2ZdLHSfJhhMnYTgIRDv/DEciWW+LNgWFOGQ6gstPHz9P7qfr9VZKyUWkkmKiWIPuZa2/fnLedK8v7+7nz/Bi9mc8nQxcy+KligsPsXfvP8zmSl03UtaqjhSYeDT53u/75m3MwQpoHlvzrOjI47HXvfnx88ZykBfmA9WfKYD4BCIa8rh9TJLvVkj8nqjXv5ZXI7unpUZYagbsDu47sVgrygNGjuCRH/CljQBwGWYU0wAFgmdRlDIWexDbAAS2AZxAM/Hwdnx13e+ElPs+8yCBNvRcH0LKKAtDwQIWQGQaDjTNtrUVWo5lOq6HFWXZ6496g/FfhZYOguROJa4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Octocats launching a spaceship"
        title="Octocats launching a spaceship"
        src="/static/d0a43dcf6d9204bf622e7ba48c8ea463/21b4d/actions.png"
        srcset="/static/d0a43dcf6d9204bf622e7ba48c8ea463/72799/actions.png 320w,
/static/d0a43dcf6d9204bf622e7ba48c8ea463/6af66/actions.png 640w,
/static/d0a43dcf6d9204bf622e7ba48c8ea463/21b4d/actions.png 1280w,
/static/d0a43dcf6d9204bf622e7ba48c8ea463/2cefc/actions.png 1400w"
        sizes="(max-width: 1280px) 100vw, 1280px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></figure><figcaption class="fullwidth">
Image credit: GitHub's <a href="https://www.youtube.com/watch?v=STWzZsg973o" rel="noopener noreferrer">Bring innovation to work with GitHub Enterprise</a>
</figcaption><p>Previously, I posted about <a href="/working-with-github-actions">Working with GitHub Actions</a>. It covered the basics of setting up a repository, configuring embedded actions and the associated workflows. If you haven’t worked with GitHub Actions before, you might want to read that first.</p><p>Once you’ve created your amazing GitHub Actions, you’ll want to re-use them and share them with your friends. To do that you’ll want to organize your project a little differently. Also, you’ll want to release your actions with all of the dependencies included so that they run efficiently. In this post we’ll create a repository which contains a GitHub Action - built in TypeScript - and a second repository which will use the action.</p><p>Before you read this it is important to note: starting with a <a href="https://github.com/jeffrafter/typescript-action-template">template</a> will save you a lot of time and setup. Creating actions can be very simple. In this post, however, I am going to work through and explain all of the steps. Included in this post are some of the reasons I’ve chosen one particular setup and skipped another. When getting started with GitHub Actions it is difficult to understand how all of the pieces fit together, or why you might want to create an action for a particular task. Hopefully this post provides some helpful examples. That said, there are probably steps here that you’ve seen before, don’t care about, or just want to skip and that’s okay.</p><p>In order to follow this, you’ll need a GitHub account. You’ll need Node, Node Version Manager (<code class="language-text">nvm</code>), and Node Package Manager (<code class="language-text">npm</code>). The examples will be in TypeScript. All of the code is available at <a href="https://github.com/jeffrafter/honk-action">https://github.com/jeffrafter/honk-action</a>.</p><h1 id="honk" style="position:relative;"><a href="#honk" aria-label="honk permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Honk</h1><p>For our example we’ll create a GitHub Action which listens for new issue comments - if the comment doesn’t contain the word “honk” our action will delete the comment and add a new comment with a picture of the goose from <a href="https://goose.game/">Untitled Goose Game</a>.<label for="sd-the-inspiration-for" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-the-inspiration-for" class="margin-toggle" /><span class="sidenote">The inspiration for this GitHub Action came from a Discord Bot created by <a href="https://twitter.com/melissamcewen/status/1176980019811405824">@melissamcewen</a>.</span> This isn’t very practical, but it should serve as a good foundation for building actions that respond to comments.</p><p>Here is the layout for our action:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">__tests__
  honk.test.ts
.eslintignore
.eslintrc.json
.gitignore
.nvmrc
action.yml
honk.ts
jest.config.js
package-lock.json
package.json
README.md
tsconfig.json</code></pre></div><p>Notice that <code class="language-text">honk.ts</code> and <code class="language-text">__tests__</code> are both in the root of our repository. In this case our action is not very complex, using only a single file. If you have a complex action which contains many modules it might make sense to to put these into a <code class="language-text">src</code> or <code class="language-text">lib</code> folder.</p><p>We’ll dig into each of these files.</p><h1 id="setup" style="position:relative;"><a href="#setup" aria-label="setup permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup</h1><p>First you want to create a folder for your project:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">mkdir</span> honk-action
<span class="token builtin class-name">cd</span> honk-action</code></pre></div></section>
<section><h2 id="environment" style="position:relative;"><a href="#environment" aria-label="environment permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Environment</h2><p>As we did in the previous post we’ll be using TypeScript to build our action, which requires Node. Out of the box GitHub supports a few environments for your actions to run <label for="sd-there-are-several" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-there-are-several" class="margin-toggle" /><span class="sidenote">There are several different <a href="https://help.github.com/en/articles/virtual-environments-for-github-actions#supported-virtual-environments-and-hardware-resources">virtual operating systems</a> you can use for your actions which come preloaded with <a href="https://help.github.com/en/articles/software-in-virtual-environments-for-github-actions">useful software</a>. Additionally, you can utilize Docker containers running in one of these virtual environments to pre-configure your hosts.</span>. There is built-in support for running actions built in JavaScript (using Node). When we release our action we’ll package up the compiled JavaScript so that users of the action don’t need to install the TypeScript dependencies. Taking a few extra seconds to build your action on execution may not seem like a big deal; but GitHub Actions have a limited about of <a href="https://github.com/features/actions">free</a> compute time. While developing an action this might not matter; but long-term those seconds can add up. Leveraging the default environments means your action will run more quickly and reduce the amount of billable hours used.</p><p>Let’s setup our example to use Node. If you have multiple local projects you might run into a conflict about which Node version should be used. <a href="https://npm.github.io/installation-setup-docs/installing/using-a-node-version-manager.html">Node Version Manager</a> solves this problem. After installing a Node Version Manager, check which version of Node you have installed:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">nvm ls</code></pre></div><p>If you don’t have the version you want, find a remote version:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">nvm ls-remote</code></pre></div><p>This will show lots of versions. Find the last one with <code class="language-text">LTS</code> (for Long Term Support). Generally LTS versions are very stable. Install it using:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">nvm install 12.16.1</code></pre></div><p>To control which version of Node should be used in your project, add a <code class="language-text">.nvmrc</code><label for="sd-notice-that-the-less" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-notice-that-the-less" class="margin-toggle" /><span class="sidenote">Notice that the <code>.nvmrc</code> file starts with a "<code>.</code>" (period). By default on most systems this creates a hidden file. Oftentimes general project config is hidden away. On MacOS you can show hidden files in Finder by running <code>defaults write com.apple.finder AppleShowAllFiles -bool true</code> and restarting Finder. If you want to list hidden files in your console use the <code>-a</code> parameter: <code>ls -a</code>.</span> file:</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token number">12.16</span>.<span class="token number">1</span></code></pre></div><p>The file is pretty simple; just the version. I chose 12.16.1 because it matches the version that is used to run our action (<code class="language-text">node12</code>). Node 10.16.3 is installed in the default <a href="https://help.github.com/en/articles/software-in-virtual-environments-for-github-actions">GitHub Action software environment</a> and can be used as well but will not match the running action environment. At the time you read this there may be a newer version of Node or you may chose to use an older version because your code requires it. You can check <a href="https://nodejs.org">https://nodejs.org</a>.</p></section>
<section><h2 id="ignore-some-things" style="position:relative;"><a href="#ignore-some-things" aria-label="ignore some things permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ignore some things</h2><p>We plan to use <code class="language-text">git</code> to keep track of our changes. As we work on our project locally, there will be a lot of files we won’t want to keep track of; we’ll want to ignore them. To do this we’ll create a <code class="language-text">.gitignore</code> file. If you are looking for an complete example <code class="language-text">.gitignore</code> you can check out <a href="https://github.com/github/gitignore">https://github.com/github/gitignore</a>. For now, just copy the following (this <code class="language-text">.gitignore</code> includes only what is important for this post. For a more complete version see <a href="https://github.com/jeffrafter/honk-action/blob/master/.gitignore">here</a>):</p><div class="gatsby-highlight" data-language=".gitignore"><pre class="language-.gitignore"><code class="language-.gitignore"># Dependency directories
node_modules/

# Logs
logs
*.log
npm-debug.log*

# Typescript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache</code></pre></div><p>With this setup we’ll ignore <code class="language-text">node_modules</code>. Again, when we release our action we’ll need the dependencies included. If we don’t include them, we’ll need users of our action to install them which will not only take 25 to 30 seconds but will require extra steps in the calling workflow.</p></section>
<section><h2 id="packages--dependencies" style="position:relative;"><a href="#packages--dependencies" aria-label="packages  dependencies permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Packages &#x26; Dependencies</h2><p>For almost any Node project you’ll find that you use a lot of packages – you’ll have far more code in packages in your <code class="language-text">node_modules</code> folder (where package code is stored) than your main project.</p><p>Initialize your packages:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> init -y</code></pre></div><p>Now you have a <code class="language-text">package.json</code>:</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"honk-action"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span>
<span class="token punctuation">}</span></code></pre></div><p>Let’s simplify it a bit (you can fill out or keep fields you like here, but this is the minimum):</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"tsc"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"tsc --noEmit &amp;&amp; jest"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span>
<span class="token punctuation">}</span></code></pre></div><p>The only scripts we need at the moment are <code class="language-text">build</code> which will convert our TypeScript to JavaScript and <code class="language-text">test</code> which will run our tests. While we’re developing our action we’ll need access to all of our project’s dependencies; but when we release our action we don’t want to include the testing, linting and TypeScript dependencies. Because of this, the difference between <code class="language-text">dependencies</code> and <code class="language-text">devDependencies</code> is important (as well as <code class="language-text">--save</code> versus <code class="language-text">--save-dev</code>).</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save <span class="token punctuation">\</span>
  @actions/core <span class="token punctuation">\</span>
  @actions/github</code></pre></div><p>The <code class="language-text">@actions/core</code> and <code class="language-text">@actions/github</code> are the baseline for interacting with GitHub and the incoming events. Our published action will need these dependencies when it runs.</p><p>When developing we’ll want to add testing support to test our action:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev <span class="token punctuation">\</span>
  jest <span class="token punctuation">\</span>
  nock</code></pre></div></section>
<section><h2 id="typescript" style="position:relative;"><a href="#typescript" aria-label="typescript permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TypeScript</h2><p>Let’s add TypeScript support to our development dependencies:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev <span class="token punctuation">\</span>
  typescript <span class="token punctuation">\</span>
  ts-jest</code></pre></div><p>Finally, because we’re using TypeScript, we’ll want to add type support for development:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev <span class="token punctuation">\</span>
  @types/jest <span class="token punctuation">\</span>
  @types/node</code></pre></div><p>We’ll need to configure TypeScript before we can build our action. Create <code class="language-text">tsconfig.json</code>:</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"commonjs"</span><span class="token punctuation">,</span>
    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"esnext"</span><span class="token punctuation">,</span>
    <span class="token property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"es2015"</span><span class="token punctuation">,</span> <span class="token string">"es2017"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"skipLibCheck"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"noUnusedLocals"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"noUnusedParameters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"noImplicitAny"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"removeComments"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">"preserveConstEnums"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"**/*.ts"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"exclude"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"node_modules"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div><p>By default this allows us to build all of the actions contained in our repository, adds some strict compile-time checks, and skips type checking for our dependencies.</p></section>
<section><h2 id="keep-it-clean-optional" style="position:relative;"><a href="#keep-it-clean-optional" aria-label="keep it clean optional permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Keep it clean (optional)</h2><blockquote>
<p>Note: this section is not required to complete this tutorial; if you want to skip it feel free.</p>
</blockquote><p>Everyone has different preferences when they edit code. Some prefer tabs over spaces. Some want two spaces instead of four. Some prefer semicolons and some don’t. It shouldn’t matter right? But it does. If editors are auto-formatting code based on user preferences it is important to make sure everyone has chosen the same set of defaults for that auto-formatting. This makes it easy to tell what changed between versions – even when different developers (with different preferences) have made changes.</p><p>For this reason we’ll setup a linter and code formatter for our code. Install <a href="https://eslint.org/">eslint</a> and <a href="https://prettier.io/">prettier</a>:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev <span class="token punctuation">\</span>
  eslint <span class="token punctuation">\</span>
  @typescript-eslint/eslint-plugin <span class="token punctuation">\</span>
  @typescript-eslint/parser <span class="token punctuation">\</span>
  eslint-config-prettier <span class="token punctuation">\</span>
  eslint-plugin-prettier <span class="token punctuation">\</span>
  prettier</code></pre></div><p>Now that we have the packages we’ll need to configure them in <code class="language-text">.eslintrc.json</code>:</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"parser"</span><span class="token operator">:</span> <span class="token string">"@typescript-eslint/parser"</span><span class="token punctuation">,</span>
  <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@typescript-eslint"</span><span class="token punctuation">,</span> <span class="token string">"prettier"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"extends"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"eslint:recommended"</span><span class="token punctuation">,</span>
    <span class="token string">"plugin:@typescript-eslint/recommended"</span><span class="token punctuation">,</span>
    <span class="token string">"plugin:prettier/recommended"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"rules"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"prettier/prettier"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"error"</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"singleQuote"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"trailingComma"</span><span class="token operator">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span>
        <span class="token property">"bracketSpacing"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"printWidth"</span><span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span>
        <span class="token property">"tabWidth"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"semi"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// octokit/rest requires parameters that are not in camelcase</span>
    <span class="token property">"camelcase"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>
    <span class="token property">"@typescript-eslint/camelcase"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token property">"properties"</span><span class="token operator">:</span> <span class="token string">"never"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"env"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"node"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"jest"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"es6"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"parserOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"ecmaVersion"</span><span class="token operator">:</span> <span class="token number">2018</span><span class="token punctuation">,</span>
    <span class="token property">"sourceType"</span><span class="token operator">:</span> <span class="token string">"module"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>I won’t go into too much detail here; there are <a href="https://www.robertcooper.me/using-eslint-and-prettier-in-a-typescript-project">better explanations</a> to be found. This configuration does a few things:</p><ul>
<li>Relies on the typescript eslint parser with the prettier plugin - I’ve found this works very well in @Code. If you were previously using <code class="language-text">ts-lint</code> with prettier this setup should replace your old configuration.</li>
<li>This eslint config doesn’t work perfectly for projects that contain both JavaScript and TypeScript - because of that we won’t attempt to lint JavaScript files in our project</li>
<li>I’ve turned off the camelcase rules for properties - when writing GitHub Actions you will likely use properties from <code class="language-text">@actions/github</code> and from the API and these will not be camelcase.<label for="sd-there-are-lots-of" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-there-are-lots-of" class="margin-toggle" /><span class="sidenote">There are lots of ways to name variables including <code>camelCase</code>, <code>snake_case</code>, <code>ProperCase</code>, and <code>CONSTANT_CASE</code>. JavaScript and TypeScript tend to use <code>camelCase</code> for variable names, but Ruby (which is what much of GitHub and the GitHub API is written in) generally uses <code>snake_case</code>. This is one of those places where the idioms of different languages collide and you have to make the best of it.</span></li>
<li>The expected environment should include <code class="language-text">node</code> and <code class="language-text">jest</code> - this will help <code class="language-text">eslint</code> ignore missing declarations for things like <code class="language-text">describe</code>, <code class="language-text">process</code>, <code class="language-text">module</code>, etc.</li>
</ul><p>If you need to ignore specific files when linting you can add them to <code class="language-text">.eslintignore</code>. Because our setup doesn’t work well for JavaScript we’ll ignore all JavaScript files in <code class="language-text">.eslintignore</code>:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">*.js</code></pre></div><p>Add a <code class="language-text">lint</code> item to the <code class="language-text">scripts</code> node in <code class="language-text">package.json</code>:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;tsc&quot;,
    &quot;test&quot;: &quot;tsc --noEmit &amp;&amp; jest&quot;,
    &quot;lint&quot;: &quot;eslint . --ext .ts&quot;
  },</code></pre></div><p>With this in place we can run:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run lint</code></pre></div><p>Wait, there’s an error:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Oops! Something went wrong! :(

ESLint: 6.6.0.

No files matching the pattern &quot;.&quot; were found.
Please check for typing mistakes in the pattern.</code></pre></div><p>We haven’t written any TypeScript to lint yet. Time to stop configuring and start writing code.</p><h1 id="building-the-action" style="position:relative;"><a href="#building-the-action" aria-label="building the action permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Building the action</h1><p>Create a new file called <code class="language-text">honk.ts</code>:</p><div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> core <span class="token keyword">from</span> <span class="token string">'@actions/core'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> github <span class="token keyword">from</span> <span class="token string">'@actions/github'</span>

<span class="token keyword">const</span> run <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Our action will need to API access the repository so we require a token</span>
    <span class="token comment">// This can be set in the calling workflow or it can use the default</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">'GITHUB_TOKEN'</span><span class="token punctuation">]</span> <span class="token operator">||</span> core<span class="token punctuation">.</span><span class="token function">getInput</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token <span class="token operator">||</span> token <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

    <span class="token comment">// Create the octokit client</span>
    <span class="token keyword">const</span> octokit<span class="token operator">:</span> github<span class="token punctuation">.</span>GitHub <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">github</span><span class="token punctuation">.</span><span class="token function">GitHub</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>

    <span class="token comment">// The environment contains a variable for current repository. The repository</span>
    <span class="token comment">// will be formatted as a name with owner (`nwo`); e.g., jeffrafter/example</span>
    <span class="token comment">// We'll split this into two separate variables for later use</span>
    <span class="token keyword">const</span> nwo <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">'GITHUB_REPOSITORY'</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'/'</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>owner<span class="token punctuation">,</span> repo<span class="token punctuation">]</span> <span class="token operator">=</span> nwo<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>

    <span class="token comment">// This action works on issue comments. Because of this we expect the context</span>
    <span class="token comment">// payload to contain the issue and the comment</span>
    <span class="token keyword">const</span> issue <span class="token operator">=</span> github<span class="token punctuation">.</span>context<span class="token punctuation">.</span>payload<span class="token punctuation">[</span><span class="token string">'issue'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>issue<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">const</span> comment <span class="token operator">=</span> github<span class="token punctuation">.</span>context<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>comment
    <span class="token keyword">const</span> commentBody <span class="token operator">=</span> comment<span class="token punctuation">.</span>body

    <span class="token comment">// If the comment contains "honk" anywhere in the body, there is nothing for our action to do</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>commentBody<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/honk/i</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

    <span class="token comment">// The comment didn't contain "honk", delete it</span>
    <span class="token comment">// https://octokit.github.io/rest.js/#octokit-routes-issues-delete-comment</span>
    <span class="token keyword">const</span> deleteCommentResponse <span class="token operator">=</span> <span class="token keyword">await</span> octokit<span class="token punctuation">.</span>issues<span class="token punctuation">.</span><span class="token function">deleteComment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      owner<span class="token punctuation">,</span>
      repo<span class="token punctuation">,</span>
      comment_id<span class="token operator">:</span> comment<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Deleted comment! </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>deleteCommentResponse<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

    <span class="token comment">// Add a new comment that says honk</span>
    <span class="token comment">// https://octokit.github.io/rest.js/#octokit-routes-issues-create-comment</span>
    <span class="token keyword">const</span> issueCommentResponse <span class="token operator">=</span> <span class="token keyword">await</span> octokit<span class="token punctuation">.</span>issues<span class="token punctuation">.</span><span class="token function">createComment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      owner<span class="token punctuation">,</span>
      repo<span class="token punctuation">,</span>
      issue_number<span class="token operator">:</span> issue<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">,</span>
      body<span class="token operator">:</span>
        <span class="token string">'![honk](https://user-images.githubusercontent.com/4064/65900857-cf462f80-e36b-11e9-9a9c-76170c99618b.png)'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Honk! </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>issueCommentResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// If there is any error we'll fail the action with the error message</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    core<span class="token punctuation">.</span><span class="token function">setFailed</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Honk-action failure: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Don't auto-execute in the test environment</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">'NODE_ENV'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'test'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> run</code></pre></div><p>The code inside your action should be auto-executing. In this case we define a <code class="language-text">run</code><label for="sd-we-ve-named-our" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-we-ve-named-our" class="margin-toggle" /><span class="sidenote">We've named our function <code>run</code> but you could name the function anything you wanted. <code>run</code> is a convention used in the base <a href="https://github.com/actions/typescript-action/blob/master/src/main.ts"><code>typescript-template</code></a></span> method and then immediately call it right after it has been defined. In fact, you don’t even need to define a method, you could include the code for your action directly. In some cases that might be okay, but as the complexity of the action increases it would become confusing. We’ve also made our function the default export. This isn’t required but will make things easier as we move forward and test our code.</p><p>The image this includes is:</p><p><img src="https://user-images.githubusercontent.com/4064/65900857-cf462f80-e36b-11e9-9a9c-76170c99618b.png" alt="honk"></p></section>
<section><h2 id="testing-the-action" style="position:relative;"><a href="#testing-the-action" aria-label="testing the action permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Testing the action</h2><p>Create a new file called <code class="language-text">__tests__/honk.test.ts</code>:</p><div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> github <span class="token keyword">from</span> <span class="token string">'@actions/github'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> core <span class="token keyword">from</span> <span class="token string">'@actions/core'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>WebhookPayload<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@actions/github/lib/interfaces'</span>
<span class="token keyword">import</span> nock <span class="token keyword">from</span> <span class="token string">'nock'</span>
<span class="token keyword">import</span> run <span class="token keyword">from</span> <span class="token string">'../honk'</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// resetModules allows you to safely change the environment and mock imports</span>
  <span class="token comment">// separately in each of your tests</span>
  jest<span class="token punctuation">.</span><span class="token function">resetModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>core<span class="token punctuation">,</span> <span class="token string">'getInput'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">'token'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'12345'</span>
    <span class="token keyword">return</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">'GITHUB_REPOSITORY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'example/repository'</span>

  <span class="token comment">// Create a mock payload for our tests to use</span>
  <span class="token comment">// https://developer.github.com/v3/activity/events/types/#issuecommentevent</span>
  github<span class="token punctuation">.</span>context<span class="token punctuation">.</span>payload <span class="token operator">=</span> <span class="token punctuation">{</span>
    action<span class="token operator">:</span> <span class="token string">'created'</span><span class="token punctuation">,</span>
    issue<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    comment<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      user<span class="token operator">:</span> <span class="token punctuation">{</span>
        login<span class="token operator">:</span> <span class="token string">'monalisa'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      body<span class="token operator">:</span> <span class="token string">'Honk'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token keyword">as</span> WebhookPayload
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>nock<span class="token punctuation">.</span><span class="token function">pendingMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  nock<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  nock<span class="token punctuation">.</span><span class="token function">cleanAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'honk action'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// The most basic test is just checking that the run method doesn't throw an error.</span>
  <span class="token comment">// This test relies on our default payload which contains "honk" in the comment body.</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'runs'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'deletes the comment and adds a comment'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Override the default payload so that it doesn't include "honk". This should make the</span>
    <span class="token comment">// action run through more of the code</span>
    github<span class="token punctuation">.</span>context<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>comment<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'No geese allowed'</span>

    <span class="token comment">// Use nock to mock out the external call to delete the comment</span>
    <span class="token comment">// Setting this up creates an expectation that must be called and returns a 200 response</span>
    <span class="token function">nock</span><span class="token punctuation">(</span><span class="token string">'https://api.github.com'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">'/repos/example/repository/issues/comments/1'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// Use nock to mock out the external call to create the honk comment</span>
    <span class="token comment">// Setting this up creates an expectation that must be called and returns a 200 response</span>
    <span class="token function">nock</span><span class="token punctuation">(</span><span class="token string">'https://api.github.com'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/repos/example/repository/issues/1/comments</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> body <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          body<span class="token punctuation">.</span>body <span class="token operator">===</span>
          <span class="token string">'![honk](https://user-images.githubusercontent.com/4064/65900857-cf462f80-e36b-11e9-9a9c-76170c99618b.png)'</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        url<span class="token operator">:</span> <span class="token string">'https://github.com/#example'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div><p>We import the actions core library and the run method we just created in our honk action. We only have two tests, a very basic test which guarantees that by default we don’t throw errors. The second uses <code class="language-text">nock</code> to mock out any external calls. These expectations must be satisfied or the test will fail (because of the check in the <code class="language-text">afterEach</code> callback). Additionally, if there are any unexpected external calls the test will fail.</p><p>In order to run these tests we’ll need to configure Jest. Create a new file called <code class="language-text">jest.config.js</code> in the root of your project:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// Setup nock to disable all external calls</span>
<span class="token keyword">const</span> nock <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'nock'</span><span class="token punctuation">)</span>
nock<span class="token punctuation">.</span><span class="token function">disableNetConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// By default, debug messages are written to the console which can make the test output confusing</span>
<span class="token comment">// Instead, bind to stdout and hide all debug messages</span>
<span class="token keyword">const</span> processStdoutWrite <span class="token operator">=</span> process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function-variable function">write</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Debug messages begin with ::</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/^::/</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token keyword">return</span> <span class="token function">processStdoutWrite</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> cb<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  clearMocks<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  moduleFileExtensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token string">'ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  testEnvironment<span class="token operator">:</span> <span class="token string">'node'</span><span class="token punctuation">,</span>
  testMatch<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'**/*.test.ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  transform<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'^.+\\.ts$'</span><span class="token operator">:</span> <span class="token string">'ts-jest'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  verbose<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div><p>At this point you can run the tests. From your terminal run:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token builtin class-name">test</span></code></pre></div><p>You should see:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">&gt; @ test ...
&gt; tsc --noEmit &amp;&amp; jest

 PASS  __tests__/honk.test.ts
  honk action
    ✓ runs (10ms)
    ✓ deletes the comment and adds a comment (32ms)

  console.log honk.ts:37
    Deleted comment! 200

  console.log honk.ts:47
    Honk! https://github.com/#example

Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total
Snapshots:   0 total
Time:        1.729s
Ran all test suites.</code></pre></div><p>We can also run our <code class="language-text">lint</code> task to verify that our code is clean:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run lint</code></pre></div><p>It should succeed with no errors and no warnings<label for="sd-if-you-get-an-error" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-if-you-get-an-error" class="margin-toggle" /><span class="sidenote">If you get an error or warning about missing <code>beforeEach</code>, it is possible you are not using the correct version of Node and npm. In your project directory run <code>nvm use</code> and try again.</span>.</p><h3 id="create-the-actionyml-for-the-honk-action" style="position:relative;"><a href="#create-the-actionyml-for-the-honk-action" aria-label="create the actionyml for the honk action permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create the action.yml for the honk action</h3><p>We’ve written the code for our action and a test that tells us it is working. Unfortunately we haven’t defined how our action should be used. To do that we have to configure the action in a <code class="language-text">yml</code> file. In our previous post on Working with GitHub Actions our action was embedded in our project and wasn’t meant to be reused. In this case we want the action to be used; create <code class="language-text">action.yml</code> in the project root:</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> honk
<span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Checks to see if a comment contains 'Honk', otherwise deletes it"</span>
<span class="token key atrule">author</span><span class="token punctuation">:</span> <span class="token string">'@jeffrafter'</span>
<span class="token key atrule">inputs</span><span class="token punctuation">:</span>
  <span class="token key atrule">token</span><span class="token punctuation">:</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token punctuation">></span><span class="token scalar string">
      GitHub token used to create and remove comments. By default, this uses the
      repository token provided by GitHub Actions. You can customize the user by
      replacing this token with a user token which has write-access to your
      repository. Note that the token will be accessible to all repository
      collaborators.</span>
    <span class="token key atrule">default</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> github.token <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token key atrule">runs</span><span class="token punctuation">:</span>
  <span class="token key atrule">using</span><span class="token punctuation">:</span> <span class="token string">'node12'</span>
  <span class="token key atrule">main</span><span class="token punctuation">:</span> <span class="token string">'./dist/index.js'</span></code></pre></div><p>There are <a href="https://help.github.com/en/articles/metadata-syntax-for-github-actions">more configuration options available</a> for actions but this represents the minimum amount needed to run. Specifically, it gives the action a name (which does not need to match the name of our TypeScript file) and points to the the code <code class="language-text">./dist/index.js</code>. Unfortunately, we don’t yet have a file called <code class="language-text">dist/index.js</code>, we only have a file called <code class="language-text">honk.ts</code>. GitHub Actions have built-in support for JavaScript and cannot run TypeScript directly. Because of this we will need to <em>transpile</em> our TypeScript to JavaScript before it can be run. We’ll do this as part of our release step.</p><p>We’ve also included an input for our <code class="language-text">token</code> which defaults to the repository token provided by the GitHub Actions runner. By using an input (instead of an environment variable) we simplify the configuration for workflows that use our action.<label for="sd-previously-i-would" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-previously-i-would" class="margin-toggle" /><span class="sidenote">Previously, I would use an environment variable out of habit. <a href="https://github.com/joshmgross">Josh Gross</a> showed me this trick. Not only can you have default values (as we've done here), but you can add documentation for users that will appear in the workflow editor (when you publish your action in the marketplace).</span> By default the workflow doesn’t need to include any value. Individual workflows can be customized by overriding the default and setting an input (generally, by using a token stored in the repository’s secrets).</p><p>For more information on creating secrets, see <a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/creating-and-using-encrypted-secrets">Creating and using encrypted secrets</a>.</p><p>For more information on using secrets and tokens for authentication, see <a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/authenticating-with-the-github_token">Authenticating with the github token</a>.<label for="sd-be-careful-when" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-be-careful-when" class="margin-toggle" /><span class="sidenote">Be careful when using <a href="https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line">personal access tokens</a> as secrets. Because GitHub Actions have the ability to read your repository secrets, any collaborator could steal your token by modifying the workflow and exfiltrating the secret. If the token you've included in your secrets has a broad set of permissions this can be very dangerous.</span></p><h1 id="releasing-a-github-action" style="position:relative;"><a href="#releasing-a-github-action" aria-label="releasing a github action permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Releasing a GitHub Action</h1><p>At this point our action is built. If we create the honk-action repository on GitHub and push up the results, however, it won’t work. When workflows refer to actions defined in other repositories it expects there to be a release.</p><p>GitHub provides documentation on releasing your action:</p><ul>
<li><a href="https://help.github.com/en/github/automating-your-workflow-with-github-actions/creating-a-javascript-action#commit-and-push-your-action-to-github">https://help.github.com/en/github/automating-your-workflow-with-github-actions/creating-a-javascript-action#commit-and-push-your-action-to-github</a></li>
<li><a href="https://help.github.com/en/github/automating-your-workflow-with-github-actions/publishing-actions-in-github-marketplace">https://help.github.com/en/github/automating-your-workflow-with-github-actions/publishing-actions-in-github-marketplace</a></li>
</ul></section>
<section><h2 id="creating-a-workflow-that-points-to-the-action" style="position:relative;"><a href="#creating-a-workflow-that-points-to-the-action" aria-label="creating a workflow that points to the action permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating a workflow that points to the action</h2><p>In order to use a published action a repository must use a workflow. For example:</p><div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Honk workflow
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">issue_comment</span><span class="token punctuation">:</span>
    <span class="token key atrule">types</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>created<span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Honk
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> jeffrafter/honk<span class="token punctuation">-</span>action@v1</code></pre></div><p>Notice that the action is referenced by the username and action repository along with a version number; in this case <code class="language-text">@v1</code>. This version number refers to a tagged release. This helps ensure that that users of your action have consistent behavior (for example providing the correct inputs and seeing consistent outputs). As an action author you can make use of whatever versioning system you want (including semantic versions) however the actions runner will treat everything after the <code class="language-text">@</code> as a ref<label for="sd-workflows-can-also" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-workflows-can-also" class="margin-toggle" /><span class="sidenote">Workflows can also refer to GitHub Actions by SHA. In many cases this is much safer as an author could make changes to the code for a given tag.</span> and expects and exact match.</p></section>
<section><h2 id="preparing-the-release" style="position:relative;"><a href="#preparing-the-release" aria-label="preparing the release permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Preparing the release</h2><p>To release our action we need to do the following:</p><ol>
<li>Verify that our tests pass and there are no lint errors</li>
<li>Compile our TypeScript to JavaScript</li>
<li>Include our dependencies (but not our development dependencies)</li>
<li>Push our release</li>
<li>Create a tag for our release</li>
</ol></section>
<section><h2 id="compiling-a-release-using-zeits-code-classlanguage-textncccode" style="position:relative;"><a href="#compiling-a-release-using-zeits-code-classlanguage-textncccode" aria-label="compiling a release using zeits code classlanguage textncccode permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Compiling a release using Zeit’s <code class="language-text">ncc</code></h2><p>If your action is utilizing a small set of runtime dependencies which are cross-platform, you can utilize <a href="https://github.com/zeit/ncc">zeit/ncc</a> to compile your action to a single file. In most cases this is a much simpler and better workflow then manually preparing your dependencies for release. Additionally, <code class="language-text">ncc</code> works with TypeScript, simplifying things even more.</p><p>Install it as a development dependency:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev @zeit/ncc</code></pre></div><blockquote>
<p>Note: Zeit recommends you install <code class="language-text">ncc</code> globally. I tend to avoid global packages as the interface may change over time and you may have multiple projects using the dependency differently.</p>
</blockquote><p>With this installed, let’s change the <code class="language-text">build</code> script in <code class="language-text">package.json</code>:</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"dist/index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"tsc --noEmit &amp;&amp; ncc build honk.ts -o dist -m"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"tsc --noEmit &amp;&amp; jest"</span><span class="token punctuation">,</span>
    <span class="token property">"lint"</span><span class="token operator">:</span> <span class="token string">"eslint . --ext .ts"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span>
<span class="token punctuation">}</span></code></pre></div><p>The <code class="language-text">build</code> script will do a few things:</p><ol>
<li>Compile our TypeScript (without emitting)</li>
<li>Use <code class="language-text">ncc</code> to build a version of <code class="language-text">honk.ts</code> which includes all of the dependencies</li>
<li>Minify that build and save it to the <code class="language-text">dist/</code> folder</li>
</ol><p>We’ve also specified that our <code class="language-text">main</code> is <code class="language-text">dist/index.js</code> (the file <code class="language-text">ncc</code> will generate). This isn’t required but can help with discovery and automation.</p><p>The distribution that <code class="language-text">ncc</code> creates includes only the <em>necessary</em> dependencies. This means the resulting distribution file is incredibly small (when compared to the size of <code class="language-text">node_modules</code>). Even though the file is smaller it is still complex and can be easily auto-generated. Because of this, it doesn’t need to be stored in our repository; it will make reviewing future pull-requests more difficult. For this reason you might choose to add it to your <code class="language-text">.gitignore</code>. On the other hand, swapping things in and out of your <code class="language-text">.gitignore</code> can be cumbersome.</p><p>My solution is to do nothing: which happens to be the easiest solution. Instead, I <em>only</em> run <code class="language-text">build</code> on release branches.<label for="sd-what-happens-if" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-what-happens-if" class="margin-toggle" /><span class="sidenote">What happens if someone accidentally runs <code>build</code> on a feature branch or on master? Well as log as they don't mistakenly add the <code>dist</code> folder to git, nothing happens. If they do add the <code>dist</code> folder to their change you can easily reject the change or remove the folder in a subsequent change. To avoid this you could add a release branch check to the build script before running <code>ncc</code>.</span></p><p>Let’s create <code class="language-text">v1</code> of our Honk action. Start by creating a new branch:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> checkout -b releases/v1</code></pre></div><p>Run all of the checks:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run lint
<span class="token function">npm</span> <span class="token builtin class-name">test</span></code></pre></div><p>And build:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run build</code></pre></div><p>Checking <code class="language-text">git status</code> you see:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">On branch releases/v1
Untracked files:
  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)

	dist/

nothing added to commit but untracked files present (use &quot;git add&quot; to track)</code></pre></div><p>Let’s add the <code class="language-text">dist</code> folder:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span></code></pre></div><p>At this point we can create a commit:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> commit -m <span class="token string">"v1"</span></code></pre></div><p>Let’s push the <code class="language-text">releases/v1</code> branch to GitHub:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> push origin releases/v1</code></pre></div><p>Next we’ll want to create a tag for our release and push it:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> tag -fa v1 -m <span class="token string">"v1"</span>
<span class="token function">git</span> push origin v1</code></pre></div><p>Honk action <code class="language-text">v1</code> is now ready to be used by remote workflows.</p><p>Utilizing <code class="language-text">ncc</code> to generate your distribution simplifies the process of transpiling, preparing your dependencies for release, and bundling it all together. So why wouldn’t you do this all the time? In general you should. Very rarely, it is useful manually prepare a release when your action relies on native dependencies which must be compiled for the target platform (for example, you are developing on Windows or a Mac and you have to compile a dependency for running on Ubuntu). In those cases, creating your distribution requires more explicit control.</p></section>
<section><h2 id="pushing-changes-to-a-release" style="position:relative;"><a href="#pushing-changes-to-a-release" aria-label="pushing changes to a release permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pushing changes to a release</h2><p>Understanding how to create and tag new releases is helpful. But sometimes you want to push changes to an existing tagged release. This is convenient because it doesn’t require changes to workflows that use your action. However, you should only do this if the change is backward compatible with the existing usage. If, for example, you add a new required input, you’ll need to create a new release and have users upgrade.</p><p>To change an existing release, you can create a new commit and force-push it, then remove and republish the associated tags. I’ve included all of the commands here:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># Checkout the release branch</span>
<span class="token function">git</span> checkout releases/v1
<span class="token comment"># Get this branch even with master so the latest changes are included</span>
<span class="token function">git</span> reset --hard master
<span class="token comment"># Rerun the checks and rebuild the TypeScript and ncc distribution</span>
<span class="token function">npm</span> run build
<span class="token comment"># Add the dist</span>
<span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token comment"># Commit</span>
<span class="token function">git</span> commit -m <span class="token string">"v1"</span>
<span class="token comment"># Force push to overwrite any previous commits for this branch</span>
<span class="token function">git</span> push -f origin releases/v1
<span class="token comment"># Remove previously pushed tags (v1 will be unusable momentarily until you re-push)</span>
<span class="token function">git</span> push origin :refs/tags/v1
<span class="token comment"># Re-apply the tag</span>
<span class="token function">git</span> tag -fa v1 -m <span class="token string">"v1"</span>
<span class="token comment"># Push everything</span>
<span class="token function">git</span> push origin v1</code></pre></div><p>These steps are tedious but can be easily automated.</p><h1 id="using-the-released-action-in-a-workflow" style="position:relative;"><a href="#using-the-released-action-in-a-workflow" aria-label="using the released action in a workflow permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using the released action in a workflow</h1><p>In order to execute the <code class="language-text">honk-action</code> we need to create a workflow. Let’s create another repository called <code class="language-text">honk-test</code>.</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">mkdir honk-test
cd honk-test</code></pre></div><p>Workflows should be kept in the <code class="language-text">.github/workflows</code> folder in your repository. Your repository may contain multiple workflows. Create <code class="language-text">.github/workflows/honk-workflow.yml</code>:</p><div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Honk workflow
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">issue_comment</span><span class="token punctuation">:</span>
    <span class="token key atrule">types</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>created<span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Honk
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> jeffrafter/honk<span class="token punctuation">-</span>action@v1</code></pre></div><p>We’ve created a workflow that should be executed whenever issue comments are <code class="language-text">[created]</code>. There are many different <a href="https://help.github.com/en/articles/events-that-trigger-workflows">events that trigger workflows</a>. By specifying <code class="language-text">[created]</code> we’re saying that every time a new comment is added to an issue in our GitHub repository our workflow should be executed. In this case we’ve chosen to execute our workflow using the <code class="language-text">ubuntu-latest</code> environment. Our workflow has a single step which uses the <code class="language-text">honk-action@v1</code> we released.<label for="sd-versioning-can-be" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-versioning-can-be" class="margin-toggle" /><span class="sidenote">Versioning can be very difficult. We've started with a very simple numeric strategy here. This is fine for most projects but in larger projects you may want to use Semantic Versioning or rely on the the versioning system built into <code>npm</code>. GitHub also has <a href="https://github.com/actions/toolkit/blob/master/docs/action-versioning.md#recommendations">action versioning recommendations</a>.</span></p><p>This should be enough to run our <code class="language-text">honk-action</code>. Commit this and push it to GitHub.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> status</code></pre></div><p>You should see:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">On branch master
Untracked files:
  <span class="token punctuation">(</span>use <span class="token string">"git add &lt;file>..."</span> to include <span class="token keyword">in</span> what will be committed<span class="token punctuation">)</span>

	.github/workflows/

nothing added to commit but untracked files present <span class="token punctuation">(</span>use <span class="token string">"git add"</span> to track<span class="token punctuation">)</span></code></pre></div><p>Let’s add the workflow:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span></code></pre></div><p>And commit:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> commit -m <span class="token string">"Honk workflow and configuration"</span></code></pre></div><p>All that’s left is to push it to GitHub and try it out. Create a <a href="https://github.com/new">new repository</a>. Again, I called mine <code class="language-text">honk-test</code> and made it public.</p><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e9f15c50e6a3543a05bdaad2d6bda985/b1ffc/action-honk-test.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAACfElEQVQ4y41U2Y7bMAz0/39K+rTNS/c/2qLZxE6ay44P+ZYPyZ6STJzNAkViAQPJlEWRnKGcqqpwOB6RJAnC8ILL5YLz+YwgCDAMA+aOcRwFTl4U2LgeDicf+6OP3f4Ed3fA2Q/Ae4yyrGguZb6uyUaBFGSb9qfhdH1PhhJF3SHXI1RpBHQZrLUwxgj62yzr/nMWGPMZITvzKT1OOfB9tG1DG4McYIeMYRjnp8zhHo4nwhmXMKZU6mtqlFJV14KespgOvRqSsh+EVL8zat28jOAVHE7p8WKOpmk0oUHXtfcfySV7xfDKYRyF+Fj9RllrKm6PMMmxcvfYn0LEqkRrIKhai84+S/m65xR5hjU59EgqURwjUhW8Q4QgLpCWPaK0RpI3OMUZVE717Do0bUvQAt1yjbt7WRwuehQlUEohTVPkeU5EaCEmy3KyZbc5lz3WHn9nhaILYiRZKE6nKEXY642L3d+9MB0nig4WyOgwM86SsdQxd9hpPQq4mQzZmFy2O8NgUVNEAmKZnVSEgvTJkRpj7+gfxdx/FTbP3KpOUg4IqT7cw8zwtTvsXdRsmzpllg773lJ9FI4kbo6q1lrErClajnpaa7JPj8X/HI8TKdxmusoQRrEUvGlagTghLbbEKDt+dPZUhyxgJoYj4KeMo+Rvnq+MXlme3Skd6Wq73QmYaZeeMo/W3naLj/VGpMSXtfTfnEfCMdYg4sc1JjGHIRRFxG8fy4fLoFRKzGth/FkN7w4HM6KtjEAXFAW3GkWTZqzFgtovRaX7W2PNSHmTbfC2fcP7/geW2+/wMnc6+oXD2TVcxX+w+LnAcrXEt18LrJMPcTEQ+48/zh3/AAWSYPd01VFqAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Creating a new repository"
        title="Creating a new repository"
        src="/static/e9f15c50e6a3543a05bdaad2d6bda985/21b4d/action-honk-test.png"
        srcset="/static/e9f15c50e6a3543a05bdaad2d6bda985/72799/action-honk-test.png 320w,
/static/e9f15c50e6a3543a05bdaad2d6bda985/6af66/action-honk-test.png 640w,
/static/e9f15c50e6a3543a05bdaad2d6bda985/21b4d/action-honk-test.png 1280w,
/static/e9f15c50e6a3543a05bdaad2d6bda985/b1ffc/action-honk-test.png 1492w"
        sizes="(max-width: 1280px) 100vw, 1280px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p><p>Once you’ve created the repository you’ll need to click the <code class="language-text">SSH</code> button make sure to setup the remote for your repository to use <code class="language-text">ssh</code> instead of HTTPs:</p><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e6230310baff33832139a54516252b58/3e992/action-http-ssh-honk-test.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 11.249999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsSAAALEgHS3X78AAAAbklEQVQI1zXG4QqDIBRA4d7/8QaLpWVXvWVeHZZLQQe19iP4OJyGw/Rko9AG0Ha9fLSsG2QPyIRu2bi8YypnKkeuZ67H7f/hUxqYHAfkyktKAv1LGGV3TQkpauPUfKHFry5EGzJtX7tWF/LV2W8/9Jlt2UpyYhMAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Choose ssh"
        title="Choose ssh"
        src="/static/e6230310baff33832139a54516252b58/21b4d/action-http-ssh-honk-test.png"
        srcset="/static/e6230310baff33832139a54516252b58/72799/action-http-ssh-honk-test.png 320w,
/static/e6230310baff33832139a54516252b58/6af66/action-http-ssh-honk-test.png 640w,
/static/e6230310baff33832139a54516252b58/21b4d/action-http-ssh-honk-test.png 1280w,
/static/e6230310baff33832139a54516252b58/3e992/action-http-ssh-honk-test.png 1902w"
        sizes="(max-width: 1280px) 100vw, 1280px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p><p>Unfortunately you can’t push workflow changes via HTTPs as it is considered an integration. If you try you’ll see something like the following when you try to push:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">Enumerating objects: <span class="token number">31</span>, done.
Counting objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">31</span>/31<span class="token punctuation">)</span>, done.
Delta compression using up to <span class="token number">12</span> threads
Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">25</span>/25<span class="token punctuation">)</span>, done.
Writing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">31</span>/31<span class="token punctuation">)</span>, <span class="token number">55.08</span> KiB <span class="token operator">|</span> <span class="token number">7.87</span> MiB/s, done.
Total <span class="token number">31</span> <span class="token punctuation">(</span>delta <span class="token number">6</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>
remote: Resolving deltas: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">6</span>/6<span class="token punctuation">)</span>, done.
To https://github.com/jeffrafter/honk-test.git
 <span class="token operator">!</span> <span class="token punctuation">[</span>remote rejected<span class="token punctuation">]</span> master -<span class="token operator">></span> master <span class="token punctuation">(</span>refusing to allow an integration to create or update .github/workflows/debug-workflow.yml<span class="token punctuation">)</span>
error: failed to push some refs to <span class="token string">'https://github.com/jeffrafter/honk-test.git'</span></code></pre></div><p>Setup your remote by copying the instructions on the page for <code class="language-text">an existing repository from the command line</code>:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> remote <span class="token function">add</span> origin git@github.com:jeffrafter/honk-test.git</code></pre></div><p>Then push:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> push -u origin master</code></pre></div><p>On GitHub, click on the <code class="language-text">Actions</code> tab of your repository. Nothing is running yet. Remember, our workflow only runs when issue comments are created. <a href="https://github.com/jeffrafter/honk-test/issues/1">Open an issue</a> and then create a comment that doesn’t contain the word <code class="language-text">honk</code>.</p><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2c67839554674e152adb2a18cd8c5fad/7f15f/please-honk.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA+klEQVQY03WRP0/DMBDF8/2Z2TrxHZhg6YKQEAxU6gaNKuo09R8SO25ix/Hj4jRSEMXSzyffWc/3zhlnHGzHwA4FdnkOVhTQ2uC/FWMk5viX7H6/xs3bCq8f78g/9zgwBiEVtDFomgaGsNairjW6zs2yyxcu5ymXbcQWT+oFuj+nxDBEhDDA9yHhvCd6OOfRh4CBBMY7M1O3E2Mte7i7xfb5EdJE5GS//D7jqJoUed2i8UgYaq7uIur2N0xaFCPKwjoSrBSHEAKq0vhiJUoucTwJQuIkFISqwGUFY1sE6sLT1i/ofEg4Yqxl8yg82bpGsnyxe/0jFpZpBD8FP8+pEeEI4wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Please honk"
        title="Please honk"
        src="/static/2c67839554674e152adb2a18cd8c5fad/21b4d/please-honk.png"
        srcset="/static/2c67839554674e152adb2a18cd8c5fad/72799/please-honk.png 320w,
/static/2c67839554674e152adb2a18cd8c5fad/6af66/please-honk.png 640w,
/static/2c67839554674e152adb2a18cd8c5fad/21b4d/please-honk.png 1280w,
/static/2c67839554674e152adb2a18cd8c5fad/7f15f/please-honk.png 1530w"
        sizes="(max-width: 1280px) 100vw, 1280px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p><p>Once you add the comment, the action will run and be marked as successful.</p><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/be667e398664cd2d38912c49ee002701/0486e/honk-action-run.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 34.06249999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAAxElEQVQoz5VR1w7DIBDjW7rSbLLIgKShajr+/4NcDokqatP1YCHufMY+WNWNEFIjTCusvBjrfWKx8dMXUH0XZoY/WuS1QtH0CNIS24BbDkvLDgS6UJEGXHMZHF6UWxDX8d0sq407OU6gs1bavkqNudtfYR2SdaXPkIcJvb6AVxJRViMpWiR5Az8p365gCaxoBwzHK5RxSaLcxJ/HcLv7JOL6xGchFxDmY2LjhoTmpHmUb5/1cEiRD6cbcqHs/kj4efAfh3c7bNXtCco5JgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Honk action run"
        title="Honk action run"
        src="/static/be667e398664cd2d38912c49ee002701/21b4d/honk-action-run.png"
        srcset="/static/be667e398664cd2d38912c49ee002701/72799/honk-action-run.png 320w,
/static/be667e398664cd2d38912c49ee002701/6af66/honk-action-run.png 640w,
/static/be667e398664cd2d38912c49ee002701/21b4d/honk-action-run.png 1280w,
/static/be667e398664cd2d38912c49ee002701/29114/honk-action-run.png 1920w,
/static/be667e398664cd2d38912c49ee002701/0486e/honk-action-run.png 2008w"
        sizes="(max-width: 1280px) 100vw, 1280px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p><p>The action should have deleted the comment and added a honk comment in it’s place:</p><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f26e478fd7bc43c0834dd5b55773a47d/fb4e7/honk-comment-honk.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAADNklEQVQ4y32U7U9bZRjG+/dMPo3tE4lGpxMnGRhjjNkLScUPazb0g0DbQ9/O6SktbaEt5SWDgttYUDcyt0RWMwaOLdMY/bDND3PgxmQotNjSt2NrX34+PYxg4sudXHnuk+e5r/u6nvvJMfA8nqw+5cGDH0ml0ySSSXK5PNvbGTLZrI5sNkdya4tkcotsLkehoPFvYdA0jWKxSD6fJ7O9redaoUCpVNLzPZTQtD/YPV/fL1cqlMsVKpUdVKs1DD6fl5sLC5Rq8Hu2QEYr6rlWrukolqtoxTI1/jsED3lRV65UMWxsbJDJZLhzZZZLAwE+jwxydTTKpVCQzwb8zEyMs/T1DX74/i7ffbvE3TuL3L51k8WFeeLxr5i7Hmdu7jpfzsXZ3Exg2O0SMX3Aqf0v8FHTQc7sb6Dz8CuYXn2Jk0deZ2y4n2jIQ8AnI7scmC299PRYBSx095ixmCW6usw8fPgThlqtJrxXGf7QhKnpALZ3jiJ3HGMkOsDocAjVbiUQ8KO6VZxOBY9bIRZVcSuy+JZRZJVuqVs0cvPo0fKOwjrhVNCD2nOGiFASGQrg93tRPR5kRcVud+nFVslOOBzm/q0rhIMDKO5+jJ0nOHS8iY5OI8vLKzuEdZWXZ2fw+lQ8qgenQ8ZRhyByOHbI7GJVZJmzsavMXF5kZGiK0FCMt4zNNLY18Pb7rfy88vi5QkEYi01hFnehK7H2ityKzeYQ6py6VZdLweF0EzkbxxWN4w+EkcXZtvYWGlv2YTxt5MnjX/YIJyendCJFWLwxv8C9e/c5d26asZExMQwfXm8/qlA/PTsvpnobVXHrjY62v0Hjm/voON0hCJ/+nfATJMmGTSj6dPo8S/Fr9PX16w0UWRGWZcaiES6Oj/LNtS8IBYJIvQ5ajUc42NrAiVPvsra2tkc4MTGp26zfXa+5G0vXx6LArtuuN6lbt4jnUh/U7OQ4TskphiLz2vEXOdDSQJupmZXfVnanXOPChYvIslu31ifg9fqFQt8/4BN7g4NBJs6P4IpINJ98mUPvNdEuHWM1ubpHmMlkSaVSAun/RVr8PHK5LOl8mvXEOusbz/h1c51EKkGp/Cd/AV5+V6+KzvEVAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Honk action deleting a comment and adding a honk comment"
        title="Honk action deleting a comment and adding a honk comment"
        src="/static/f26e478fd7bc43c0834dd5b55773a47d/21b4d/honk-comment-honk.png"
        srcset="/static/f26e478fd7bc43c0834dd5b55773a47d/72799/honk-comment-honk.png 320w,
/static/f26e478fd7bc43c0834dd5b55773a47d/6af66/honk-comment-honk.png 640w,
/static/f26e478fd7bc43c0834dd5b55773a47d/21b4d/honk-comment-honk.png 1280w,
/static/f26e478fd7bc43c0834dd5b55773a47d/fb4e7/honk-comment-honk.png 1519w"
        sizes="(max-width: 1280px) 100vw, 1280px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p><h1 id="using-github-actions-to-run-your-tests" style="position:relative;"><a href="#using-github-actions-to-run-your-tests" aria-label="using github actions to run your tests permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using GitHub Actions to run your tests</h1><p>Not only can we create GitHub actions, we can use them. We’ll setup an action to run our tests whenever new code is pushed to GitHub. This form of CI (or Continuous Integration) is what GitHub Actions was built for.</p><p>Create a new file called <code class="language-text">.github/workflows/ci.yml</code>:</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> CI

<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
      <span class="token key atrule">matrix</span><span class="token punctuation">:</span>
        <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>12.x<span class="token punctuation">]</span>

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Use Node.js $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.node<span class="token punctuation">-</span>version <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.node<span class="token punctuation">-</span>version <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run lint
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm test</code></pre></div><p>Add this file:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span></code></pre></div><p>And commit it:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> commit -m <span class="token string">"Add CI"</span></code></pre></div><p>And then push to GitHub:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> push origin master</code></pre></div><p>You should see your tests run and build pass with a green checkmark.</p><h1 id="thanks" style="position:relative;"><a href="#thanks" aria-label="thanks permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Thanks</h1><p>Lots of folks @GitHub helped review and solve some of the issues I came across while writing this post. Also, special thanks to the docs team and the octokit/rest.js team who make great things.</p></section></div><hr/><h2>Comments</h2><div class="sc-ifAKCX ddlDEo github"><div><p>Thanks for reading ❤️ – comment by replying to the <a href="https://github.com/jeffrafter/jeffrafter.github.io/issues/9">issue for this post</a>.<!-- --> <!-- -->There’s no comments yet; you could be the first.<br/></p></div><div class="sc-gzVnrw bOnSNx"><a href="https://github.com/jeffrafter/jeffrafter.github.io/issues/9#new_comment_field" target="_blank" rel="noreferrer noopener" class="button btn">Add a comment →</a></div></div><hr/><h2>There’s more to read</h2><div><p><em>Looking for more long-form posts? Here ya go...</em></p></div><ul class="sc-htoDjs gXLbcD"><li><a rel="prev" href="/working-with-github-actions/">← <!-- -->Working with GitHub Actions</a></li><li><a rel="next" href="/bluetooth/">Bluetooth Hacking<!-- --> →</a></li></ul></div></article></main><footer class="sc-bwzfXH aCPwf footer">© <!-- -->2025<!-- -->,<!-- --> <a href="https://jeffrafter.com">jeffrafter.com</a>. Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-61511214-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/releasing-github-actions/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-51d0929071629bddce45.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-c709285770c005682b82.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-62b9eaa39bf8729ce54a.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-8c0fa96d2b2e2db049f0.js"],"component---src-pages-measure-tsx":["/component---src-pages-measure-tsx-812cff4fc3e078b55e54.js"],"component---src-pages-tags-tsx":["/component---src-pages-tags-tsx-7578574f5e2dead3e222.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-7133ab7322325c379163.js"],"component---src-templates-tag-tsx":["/component---src-templates-tag-tsx-b66b8eb25d0cb13a4d3b.js"]};/*]]>*/</script><script src="/component---src-templates-post-tsx-7133ab7322325c379163.js" async=""></script><script src="/109cf451cc5d7f6d2abc8e688d09142e78350594-53a6b222a8910dfb5d1b.js" async=""></script><script src="/commons-6458b952aa116f5f11f8.js" async=""></script><script src="/app-51d0929071629bddce45.js" async=""></script><script src="/styles-24c541b6ac347bae38f1.js" async=""></script><script src="/framework-95b680cb3190aa9bfe59.js" async=""></script><script src="/webpack-runtime-b2bee9accda6121d83bd.js" async=""></script></body></html>