<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.237ba1bc08ffadef5a9e.css">html{box-sizing:border-box;margin:0;padding:0}*,:after,:before{box-sizing:inherit}body{margin:0!important;padding:0}a.anchor,a.anchor:hover,a.anchor:link{background:none!important}figure a.gatsby-resp-image-link{background:none}figure span.gatsby-resp-image-wrapper{max-width:100%!important}article .excerpt{display:none}.btn,.button{display:inline-block;background:none!important;border-radius:40px;line-height:40px;min-height:40px;min-width:80px;padding:0 12px;text-align:center;text-decoration:none;border:1px solid #666;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}@font-face{font-family:et-book;src:url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.eot);src:url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.woff) format("woff"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.ttf) format("truetype"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.svg#etbookromanosf) format("svg");font-weight:400;font-style:normal}@font-face{font-family:et-book;src:url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.eot);src:url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.woff) format("woff"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.ttf) format("truetype"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.svg#etbookromanosf) format("svg");font-weight:400;font-style:italic}@font-face{font-family:et-book;src:url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.eot);src:url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.woff) format("woff"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.ttf) format("truetype"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.svg#etbookromanosf) format("svg");font-weight:700;font-style:normal}@font-face{font-family:et-book-roman-old-style;src:url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.eot);src:url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.woff) format("woff"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.ttf) format("truetype"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.svg#etbookromanosf) format("svg");font-weight:400;font-style:normal}html{font-size:15px}body{width:87.5%;margin-left:auto;margin-right:auto;padding-left:12.5%;font-family:et-book,Palatino,Palatino Linotype,Palatino LT STD,Book Antiqua,Georgia,serif;background-color:#fffff8;color:#111;max-width:1400px;counter-reset:sidenote-counter}h1{font-weight:400;margin-top:4rem;margin-bottom:1.5rem;font-size:3.2rem;line-height:1}h2{margin-top:2.1rem;font-size:2.2rem}h2,h3{font-style:italic;font-weight:400;margin-bottom:1.4rem;line-height:1}h3{font-size:1.7rem;margin-top:2rem}hr{display:block;height:1px;width:55%;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}p.subtitle{font-style:italic;margin-top:1rem;margin-bottom:1rem;font-size:1.8rem;display:block;line-height:1}.numeral{font-family:et-book-roman-old-style}.danger{color:red}article{position:relative;padding:1rem 0}section{padding-top:1rem;padding-bottom:1rem}ol,p,ul{font-size:1.4rem;line-height:2rem}p{margin-top:1.4rem;margin-bottom:1.4rem;padding-right:0;vertical-align:baseline}div.epigraph{margin:5em 0}div.epigraph>blockquote{margin-top:3em;margin-bottom:3em}div.epigraph>blockquote,div.epigraph>blockquote>p{font-style:italic}div.epigraph>blockquote>footer{font-style:normal}div.epigraph>blockquote>footer>cite{font-style:italic}blockquote{font-size:1.4rem}blockquote p{width:55%;margin-right:40px;font-style:italic;color:#999}blockquote footer{width:55%;font-size:1.1rem;text-align:right}section>footer,section>p,section>table{width:55%;clear:left}section>ol,section>ul{width:55%;-webkit-padding-start:5%}li:not(:first-child){margin-top:.25rem}figure{padding:0;border:0;font-size:100%;font:inherit;max-width:55%;-webkit-margin-start:0;-webkit-margin-end:0;-webkit-margin-before:0;margin-block-start:0;-webkit-margin-after:0;margin-block-end:0;margin:0 0 3em}figcaption,figure{vertical-align:baseline}figcaption{margin-top:-2em;margin-bottom:0;font-size:1.1rem;font-style:italic;line-height:1.6;position:relative;max-width:40%}figure.fullwidth figcaption{max-width:80%}a:link,a:visited{color:inherit}a:link{text-decoration:none;border-bottom:1px solid #000;padding-bottom:.05em;margin-bottom:.05em;word-break:break-word}a.anchor:link,nav.navigation a{border-bottom:0;padding-bottom:0;margin-bottom:0}@media screen and (-webkit-min-device-pixel-ratio:0){a:link{background-position-y:101%,101%,101%}}img{max-width:100%}.sidenote{margin-bottom:2em!important}.marginnote,.sidenote{float:right;clear:right;width:45%;margin:0 -75% 0 5%;font-size:1.1rem;line-height:1.3;vertical-align:baseline;position:relative}.sidenote-number{counter-increment:sidenote-counter}.sidenote-number:after,.sidenote:before{font-family:et-book-roman-old-style;position:relative;vertical-align:baseline}.sidenote-number:after{content:counter(sidenote-counter);font-size:1rem;top:-.5rem;left:.1rem}.sidenote:before{content:counter(sidenote-counter) " ";font-size:1rem;top:-.5rem}blockquote .marginnote,blockquote .sidenote{margin-right:-82%;min-width:59%;text-align:left}div.fullwidth,table.fullwidth{width:100%}div.table-wrapper{overflow-x:auto}.sans,div.table-wrapper{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}.sans{letter-spacing:.03em}code{font-family:Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:1rem;line-height:1.42}.sans>code{font-size:1.2rem}h1>code,h2>code,h3>code{font-size:.8em}.marginnote>code,.sidenote>code{font-size:1rem}pre.code{font-size:.9rem;width:52.5%;margin-left:2.5%;overflow-x:auto}pre.code.fullwidth{width:90%}.fullwidth{max-width:100%;clear:both}span.newthought{font-variant:small-caps;font-size:1.2em}input.margin-toggle{display:none}label.sidenote-number{display:inline}label.margin-toggle:not(.sidenote-number){display:none}.iframe-wrapper{position:relative;padding-bottom:56.25%;padding-top:25px;height:0}.iframe-wrapper iframe{position:absolute;top:0;left:0;width:100%;height:100%}@media (max-width:760px){body{padding-left:8%;padding-right:8%}body,hr,section>footer,section>p,section>table{width:100%}pre.code{width:97%}section>ol,section>ul{width:90%}figure{max-width:90%}figcaption,figure.fullwidth figcaption{margin-right:0;max-width:none}blockquote{margin-left:1.5em;margin-right:0}blockquote footer,blockquote p{width:100%}label.margin-toggle:not(.sidenote-number){display:inline}.marginnote,.sidenote{display:none}.margin-toggle:checked+.marginnote,.margin-toggle:checked+.sidenote{display:block;float:left;left:1rem;clear:both;width:95%;margin:1rem 2.5%;vertical-align:baseline;position:relative}label{cursor:pointer}div.table-wrapper,table{width:85%}img{width:100%}}:not(pre)>code[class*=language-]{font-size:.9em!important}.gatsby-highlight:after{content:"";display:block;clear:both}.gatsby-highlight{clear:both}h4{font-size:1.3em}.markdown-body ol,.markdown-body p,.markdown-body ul{font-size:inherit;line-height:inherit}.markdown-body blockquote{font-size:inherit}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:24px;letter-spacing:normal;border-bottom:1px solid #efefef}@media (max-width:767px){.markdown-body{padding:15px}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;-o-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;-o-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;-o-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;-o-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;-o-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;-o-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;-o-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;-o-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;-o-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;-o-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;-o-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;-o-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><meta name="generator" content="Gatsby 2.23.4"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://jeffrafter.com/unity-multiplayer-vr-with-normcore/" data-baseprotocol="https:" data-basehost="jeffrafter.com"/><link rel="icon" href="/favicon-32x32.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><title data-react-helmet="true">Unity Multiplayer Virtual Reality with Normcore | Jeff Rafter</title><meta data-react-helmet="true" name="description" content="What&#x27;s better than Virtual Reality? Virtual Reality with friends. Even the most basic games become more fun when played together. Learn how to quickly setup a multiplayer VR game with Normcore and Unity."/><meta data-react-helmet="true" property="og:title" content="Unity Multiplayer Virtual Reality with Normcore"/><meta data-react-helmet="true" property="og:description" content="What&#x27;s better than Virtual Reality? Virtual Reality with friends. Even the most basic games become more fun when played together. Learn how to quickly setup a multiplayer VR game with Normcore and Unity."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://jeffrafter.com//static/29432bc29d931b884eea7ab75c8fb59e/9d169/oculus-quest-2.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Jeff Rafter"/><meta data-react-helmet="true" name="twitter:title" content="Unity Multiplayer Virtual Reality with Normcore"/><meta data-react-helmet="true" name="twitter:description" content="What&#x27;s better than Virtual Reality? Virtual Reality with friends. Even the most basic games become more fun when played together. Learn how to quickly setup a multiplayer VR game with Normcore and Unity."/><meta data-react-helmet="true" name="keywords" content="oculus, quest, unity, development, vr, virtual-reality, multiplayer"/><style data-styled="coseIW ddlDEo bOnSNx gXLbcD aCPwf" data-styled-version="4.4.1">
/* sc-component-id: sc-global-3268680936 */
::selection{background-color:#dad9d9;color:rgba(0,0,0,0.70);}
/* sc-component-id: sc-bdVaJa */
.coseIW ul{list-style-type:none;margin:1rem 0;padding:0;margin-left:-16px;} .coseIW li{display:inline-block;margin:16px;} .coseIW li a{background:none;}
/* sc-component-id: sc-bwzfXH */
.aCPwf{padding-bottom:36px;}
/* sc-component-id: sc-ifAKCX */
.ddlDEo{width:55%;}
/* sc-component-id: sc-gzVnrw */
.bOnSNx{margin-top:40px;margin-bottom:40px;float:right;}
/* sc-component-id: sc-htoDjs */
.gXLbcD{list-style-type:none;} .gXLbcD li::before{content:'' !important;padding-right:0 !important;}</style><link as="script" rel="preload" href="/webpack-runtime-38c8a4ef93b968ef91ae.js"/><link as="script" rel="preload" href="/framework-8dcecaaefd71e2213eb2.js"/><link as="script" rel="preload" href="/styles-fa79fef4936efa84b233.js"/><link as="script" rel="preload" href="/app-3b271d6a60df7cd92087.js"/><link as="script" rel="preload" href="/commons-52923487d36b93dc329d.js"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-30b85df3d8081f386f13.js"/><link as="fetch" rel="preload" href="/page-data/unity-multiplayer-vr-with-normcore/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav class="sc-bdVaJa coseIW navigation"><ul><li><a href="/">&amp;</a></li><li><a href="/tags">Tags</a></li><li><a href="/about">About</a></li></ul></nav><main class="content" role="main"><article><header><h1>Unity Multiplayer Virtual Reality with Normcore</h1><p>October 16, 2021</p></header><div class="page-content"><div><section><figure class="fullwidth"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHUXUtpxgn/xAAYEAACAwAAAAAAAAAAAAAAAAAAAQIRIP/aAAgBAQABBQJlRWGf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAQUAAAAAAAAAAAAAAAAAAAERIDGB/9oACAEBAAY/AmLXY//EABsQAAIDAAMAAAAAAAAAAAAAAAABESExEFFh/9oACAEBAAE/IYNSlT0WGqdsN+cPTR//2gAMAwEAAgADAAAAEGMf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAQEBAQEAAAAAAAAAAAAAAREAgSEx/9oACAEBAAE/EApGF9I8dCpBUoncq0WhfmoUXrcbb67/2Q=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Oculus Quest with Controllers"
        title="Oculus Quest with Controllers"
        src="/static/29432bc29d931b884eea7ab75c8fb59e/eea4a/oculus-quest-2.jpg"
        srcset="/static/29432bc29d931b884eea7ab75c8fb59e/cb69c/oculus-quest-2.jpg 320w,
/static/29432bc29d931b884eea7ab75c8fb59e/c08c5/oculus-quest-2.jpg 640w,
/static/29432bc29d931b884eea7ab75c8fb59e/eea4a/oculus-quest-2.jpg 1280w"
        sizes="(max-width: 1280px) 100vw, 1280px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></figure><figcaption class="fullwidth">
Image credit: <a href="https://oculus.com">Oculus Quest</a>
</figcaption><p>What’s better than Virtual Reality? Virtual Reality with friends. Even the most basic games become more fun when played together. Previously, we focused on <a href="./getting-started-with-unity-and-vr">getting started with Unity and Virtual Reality</a>. This post builds on top of that foundation: adding multiplayer support, multi-platform support, multiple controllers, and virtual reality avatars.</p></section>
<section><h2 id="choosing-a-multiplayer-package" style="position:relative;"><a href="#choosing-a-multiplayer-package" aria-label="choosing a multiplayer package permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Choosing a multiplayer package</h2><p>There are a number of different approaches for building multiplayer games in Unity, some of the most common are:</p><ul>
<li>Mirror (Unity multiplayer networking) <a href="https://github.com/vis2k/Mirror">https://github.com/vis2k/Mirror</a></li>
<li>Normcore (Unity multiplayer service) <a href="https://normcore.io">https://normcore.io</a></li>
<li>Photon (Unity multiplayer service) <a href="https://www.photonengine.com/">https://www.photonengine.com/</a></li>
</ul><p>Mirror is open source and fantastic for peer to peer multiplayer. It requires that you (or a player) host the server which requires more work at scale. If you are looking to use Mirror I highly recommend the excellent YouTube series <a href="https://www.youtube.com/watch?v=5LhA4Tk_uvI&#x26;list=PLS6sInD7ThM1aUDj8lZrF4b4lpvejB2uB">How To Make A Multiplayer Game In Unity - Client-Server - Mirror Networking</a> by DapperDino.</p><p>Photon and Normcore are hosted services but both have free plans. Photon tends to charge based on the number of concurrently connected users and Normcore based on the hours spent in shared “rooms”. I tend to use Normcore because the kinds of games I want to make work better with their plans and I find it the simplest solution. Depending on your use case you might choose another option.</p><p>Check out the pricing:</p><ul>
<li><a href="https://normcore.io/pricing">https://normcore.io/pricing</a></li>
<li><a href="https://www.photonengine.com/en-US/PUN/Pricing">https://www.photonengine.com/en-US/PUN/Pricing</a></li>
</ul></section>
<section><h2 id="planning-out-the-scene" style="position:relative;"><a href="#planning-out-the-scene" aria-label="planning out the scene permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Planning out the scene</h2><p>Before we start building our scene it is important to outline our goals:</p><ul>
<li>Users should be able to view and control their player with a VR headset, Keyboard and AR</li>
<li>Each player will be represented by an avatar within the game</li>
<li>VR controllers can represent hands and teleport</li>
<li>Avatars are rigged with inverse kinematics</li>
<li>Networked objects should be sharable between players</li>
</ul><h3 id="user-control" style="position:relative;"><a href="#user-control" aria-label="user control permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>User control</h3><p>Within our basic example we were able to control the player’s view (what is displayed on the each lens) by moving the camera when the headset moved. In this way, the locomotion of our headset is our main “controller.” But what about our friends that don’t have an Oculus Quest? It would be great if they could also join our multiplayer game. To support this we will create three sets of controls:</p><ul>
<li>Virtual reality - the headset and the two VR controllers</li>
<li>Augmented reality - using a phone as an AR controller</li>
<li>Computer - using a keyboard and mouse to control the player</li>
</ul><p>This adds some complexity but it means our game will be more accessible. Additionally, it makes it much easier to test out the multiplayer functionality (without needing multiple headsets). We can run the game in the Unity editor and our device to test various aspects of our game.</p><h4 id="avatars" style="position:relative;"><a href="#avatars" aria-label="avatars permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Avatars</h4><p>Game designers often categorize their games as first-person or third-person. In a first-person game you view the game from the player’s perspective. Games like Quake or Counter-strike (or Superhot for VR) are “first-person shooters.” In a third-person game you control the player but not from the player’s perspective. Games like Super Mario 3D World (or Moss for VR) let you control Mario without seeing through Mario’s eyes. We’ll probably end up using multiple perspectives, but we’ll start with first-person as that will be more immersive in VR.</p><p>Regardless of the perspective, we’ll need to be able to show the player in the scene. Often in first-person VR games you don’t see yourself (you might see only your hands). Because our game is multiplayer we’ll need to be able to see the other players in the scene. These are called player avatars<label for="sd-why-are-they-called" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-why-are-they-called" class="margin-toggle" /><span class="sidenote">Why are they called "avatars"? According to <a href="https://en.wikipedia.org/wiki/Avatar_(computing)">wikipedia</a>, "The word avatar originates in Hinduism, where it stands for the 'descent' of a deity in a terrestrial form." It goes on to say, "The use of the term avatar for the on-screen representation of the user was coined in 1985 by Richard Garriott for the computer game Ultima IV: Quest of the Avatar. In this game, Garriott desired the player's character to be his earth self manifested into the virtual world."</span>; and they are what we’ll be controlling.</p><p>When a player joins the multiplayer version of our game we’ll create a local player avatar for them. As they control their character and move it around the scene, we’ll update our local copy of the avatar. To do this we’ll separate out how the player is controlled from how the player object is updated and displayed - even for our own local player object.</p><h4 id="vr-controllers-can-represent-hands-and-teleport" style="position:relative;"><a href="#vr-controllers-can-represent-hands-and-teleport" aria-label="vr controllers can represent hands and teleport permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>VR controllers can represent hands and teleport</h4><p>In the previous post we were able to look around our scene - but we didn’t have a body or even hands. The Oculus Quest offers two ways to control the hands of your character: hand tracking and touch controllers. We’ll implement the touch controllers and use those as our “hands” within our scene. This will allow us to leverage haptic feedback and different button inputs for interacting.</p><p>Tracking the headset’s position means that walking around in reality will translate to player movement in virtual reality. That’s great, but a given player’s play-space size might be very small. Because we’ll be using the controllers, we could easily utilize the thumb-sticks to control player locomotion. Generally there are three kinds of controller based locomotion:</p><ul>
<li>Teleporting</li>
<li>Snap-turns</li>
<li>Thumbstick movement</li>
</ul><p>We’ll implement all three of these controls. Unfortunately, though, thumbstick based movement can induce discomfort as the player’s visual position changes without a corresponding physical change. For this reason, many games do not enable thumbstick based movement, so we’ll make it optional.</p><h4 id="rigged-characters-and-inverse-kinematics" style="position:relative;"><a href="#rigged-characters-and-inverse-kinematics" aria-label="rigged characters and inverse kinematics permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rigged characters and inverse kinematics</h4><p>Our VR avatars will be controlled using three 3D points: the headset and the two controllers. Using these three points we can easily represent a head and two hands in our scene. We can go further: rigging these to an entire body with arms will let us control all parts of the body like a puppeteer. This is done by solving how the joints would need to bend based on the three control points using a technique called inverse kinematics.</p><h4 id="networked-objects-should-be-sharable-between-players" style="position:relative;"><a href="#networked-objects-should-be-sharable-between-players" aria-label="networked objects should be sharable between players permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Networked objects should be sharable between players</h4><p>Lastly, we’ll want to be able to see (and share) objects in our multiplayer scene. For example, we’ll want to be able to pickup, drop and throw things. For most objects within a multiplayer environment there is one “owner” that determines the position and rotation of each object. Changes to the position and rotation are broadcast to all of the participants. In most cases physics simulations are handled on the local machine of the “owner”.</p><p>One thing we’re not covering in this post is anti-cheating. Because we are relying on the clients to broadcast changes to the position of objects (including their own player) we are trusting them to follow the rules. A cheater could, in theory, modify the game so they could run or move more quickly, go through walls, etc. For now we won’t worry about validating movements but in a public application you would need to implement a robust anti-cheating system.</p><h1 id="create-a-new-project" style="position:relative;"><a href="#create-a-new-project" aria-label="create a new project permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create a new project</h1><p>We’ll need to create a new Unity project for our multiplayer scene. We’ll assume you are starting with the project from the previous post. If you followed that post you can continue to use the same project you’ve already started.</p></section>
<section><h2 id="getting-started-with-normcore" style="position:relative;"><a href="#getting-started-with-normcore" aria-label="getting started with normcore permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Getting started with Normcore</h2><p><a href="https://normcore.io/documentation/essentials/getting-started.html">https://normcore.io/documentation/essentials/getting-started.html</a></p><p>Sign up for an account.</p><p>Download the package.</p><p>Open the package.</p><p>Import the package <img src="https://rpl.cat/uploads/8E-WEWIob3jKUXnQKRYTW4FOYneniX3PZ-VAxP4yKEo/public.png"></p><p>Create a new Game Object called <code class="language-text">Realtime</code></p><p>Add a <code class="language-text">Realtime</code> component and set the <code class="language-text">App Key</code> (you may need to create an application first: <a href="https://normcore.io/dashboard/app/applications">https://normcore.io/dashboard/app/applications</a>). For now you can leave the room as <code class="language-text">Test Room</code>.</p><p>Add a <code class="language-text">Realtime Avatar Manager</code> component.</p><p><img src="https://rpl.cat/uploads/y0NhpxJbD243Msrpnw2V-dlHNxsNAib3QFOxx1-TLrk/public.png"></p></section>
<section><h2 id="creating-a-custom-avatar" style="position:relative;"><a href="#creating-a-custom-avatar" aria-label="creating a custom avatar permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating a Custom Avatar</h2><p><a href="https://normcore.io/documentation/guides/xr-avatars-and-voice-chat.html#creating-custom-avatars">https://normcore.io/documentation/guides/xr-avatars-and-voice-chat.html#creating-custom-avatars</a></p><p>Create a new empty game object and call it <code class="language-text">Avatar</code></p><p>Add a <code class="language-text">Realtime Avatar</code> component to the object. Notice that it added a <code class="language-text">Realtime View</code> automatically for you. This will help track and broadcast the position of this object across players. Click <code class="language-text">Create Avatar Prefab</code>. This will add a <code class="language-text">Realtime Transform</code> and three new child objects: <code class="language-text">Head</code>, <code class="language-text">Left Hand</code>, <code class="language-text">Right Hand</code>. Each of these objects have <code class="language-text">Realtime View</code> and <code class="language-text">Realtime Transform</code> components and will be tracked accordingly. The <code class="language-text">Head</code> object also has components for syncing the voice and changing the scale of the head proportionally.</p><p>We need to turn this into a prefab. Create a new folder in your <code class="language-text">Assets</code> called <code class="language-text">Resources</code> (it must be called <code class="language-text">Resources</code> for the object to be instantiated at runtime). Drag the <code class="language-text">Avatar</code> object into the <code class="language-text">Resources</code> folder. Next, delete the object from the scene hierarchy.</p><p>Select the <code class="language-text">Realtime</code> game object. Drag the <code class="language-text">Avatar</code> prefab from the <code class="language-text">Assets/Resources</code> into the <code class="language-text">Local Avatar Prefab</code> property.</p><p>You should be able to run the game and all of the players that join will have their own avatar (made out of cubes).</p></section>
<section><h2 id="keyboard-controller" style="position:relative;"><a href="#keyboard-controller" aria-label="keyboard controller permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Keyboard controller</h2><p>Adding the ability to control things with the keyboard will make it easier to test and debug the game. Also, it will make it easier to get multiple players in the game.</p><p>Add a new empty game object called <code class="language-text">Keyboard</code> to the <code class="language-text">Controller</code> game object. Then add a <code class="language-text">Camera</code> object to the <code class="language-text">Keyboard</code> object. Change the tag to <code class="language-text">MainCamera</code>. Then add a <code class="language-text">Simple Camera Controller</code> component to the <code class="language-text">Camera</code> object:</p><p><img src="https://rpl.cat/uploads/WCXLFh7UfDbevVn7uW7L3cyO6Ej0yAaDgBmh3N7x5T4/public.png"></p><p>You may want to adjust the sensitivity of the camera controller:</p><p><img src="https://rpl.cat/uploads/cr1BKq8OC_cL4L5MesXjRaXYjTWzxBFPmBY6n_xfYrs/public.png"></p><p>Also, you can check the <code class="language-text">Invert Y</code> checkbox.</p><p>Uncheck the <code class="language-text">Keyboard</code> object in the hierarchy so that it is not active when the game starts.</p><p><img src="https://rpl.cat/uploads/wQhwTBTNLfzgoitMiN77MymW-XFiajz5osWJ1bcu2cM/public.png"></p><p>We now have two controllers in the scene: the keyboard and the XR rig. We’ll want to make it so that the game auto-switches to the keyboard controller when the XR rig is not available. In the <code class="language-text">Controller</code> object create a new script called <code class="language-text">ControllerSwitcher</code>.</p><div class="gatsby-highlight" data-language="cs"><pre class="language-cs"><code class="language-cs"><span class="token preprocessor property">#<span class="token directive keyword">if</span> !(UNITY_EDITOR_WIN || UNITY_STANDALONE_WIN || (UNITY_ANDROID &amp;&amp; !UNITY_EDITOR))</span>
<span class="token preprocessor property">#<span class="token directive keyword">define</span> OVRPLUGIN_UNSUPPORTED_PLATFORM</span>
<span class="token preprocessor property">#<span class="token directive keyword">endif</span></span>

<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Normal<span class="token punctuation">.</span>Realtime</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ControllerSwitcher</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name">GameObject</span> keyboardController<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">Transform</span> keyboardHead<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">GameObject</span> XRRig<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">Transform</span> XRHead<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">Transform</span> XRLeftHand<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">Transform</span> XRRightHand<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">Transform</span> realtime<span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token class-name">RealtimeAvatarManager</span> realtimeAvatarManager<span class="token punctuation">;</span>

  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    realtimeAvatarManager <span class="token operator">=</span> realtime<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RealtimeAvatarManager<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    realtimeAvatarManager<span class="token punctuation">.</span>avatarCreated <span class="token operator">+=</span> OnAvatarCreated<span class="token punctuation">;</span>

<span class="token preprocessor property">#<span class="token directive keyword">if</span> </span><span class="token return-type class-name">OVRPLUGIN_UNSUPPORTED_PLATFORM</span>
    XRRig<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    keyboardController<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">else</span></span>
    XRRig<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">endif</span></span>
  <span class="token punctuation">}</span>

  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnAvatarCreated</span><span class="token punctuation">(</span><span class="token class-name">RealtimeAvatarManager</span> avatarManager<span class="token punctuation">,</span> <span class="token class-name">RealtimeAvatar</span> avatar<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> isLocalAvatar<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLocalAvatar<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

<span class="token preprocessor property">#<span class="token directive keyword">if</span> OVRPLUGIN_UNSUPPORTED_PLATFORM</span>
    avatar<span class="token punctuation">.</span>localPlayer<span class="token punctuation">.</span>head <span class="token operator">=</span> keyboardHead<span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">else</span></span>
    avatar<span class="token punctuation">.</span>localPlayer<span class="token punctuation">.</span>root <span class="token operator">=</span> XRRig<span class="token punctuation">.</span>transform<span class="token punctuation">;</span>
    avatar<span class="token punctuation">.</span>localPlayer<span class="token punctuation">.</span>head <span class="token operator">=</span> XRHead<span class="token punctuation">;</span>
    avatar<span class="token punctuation">.</span>localPlayer<span class="token punctuation">.</span>leftHand <span class="token operator">=</span> XRLeftHand<span class="token punctuation">;</span>
    avatar<span class="token punctuation">.</span>localPlayer<span class="token punctuation">.</span>rightHand <span class="token operator">=</span> XRRightHand<span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">endif</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p><img src="https://rpl.cat/uploads/ESJ4FZWK6_k8ZgadmInOKwa5uCp4EJiflqUpSB7mEuQ/public.png"></p><p>If you are running on a Mac M1, you may encounter an error when Normcore attempts to connect to your Microphone. To fix this, you can try the following: open the Avatar prefab (double-click), open the <code class="language-text">Head</code> object and uncheck the <code class="language-text">Realtime Avatar Voice</code> component. This completely disables voices, but will allow the game to run without crashing.</p><p>You’ll notice that you head moves with the keyboard controller, but your hands are stuck in the ground. We’ll need to fix this later when we setup our inverse kinematics.</p></section>
<section><h2 id="locomotion" style="position:relative;"><a href="#locomotion" aria-label="locomotion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Locomotion</h2><p>Now that we have bodies and hands we can start implementing the locomotion controls. In the scene hierarchy, add a new <code class="language-text">Locomotion System (Action Based)</code>. By default this will give you a <code class="language-text">Locomotion System</code> component, a <code class="language-text">Teleportation Provider</code> component, and a <code class="language-text">Snap Turn Provider</code> component. Connect the <code class="language-text">XR Rig</code> to the <code class="language-text">XR Rig</code> property. This should allow you to snap turn using the thumbsticks.</p><p><img src="https://rpl.cat/uploads/F-MA3KQHMu9u8zfHDMHXePCOzPAwtMIdgGXnxXB8eXs/public.png"></p></section>
<section><h2 id="teleporting-around" style="position:relative;"><a href="#teleporting-around" aria-label="teleporting around permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Teleporting around</h2><p>Let’s make it so you can teleport around. In order to teleport, we’ll need to have a place we can teleport to. Click on the <code class="language-text">Floor</code> object in the <code class="language-text">Environment</code> object. Add a <code class="language-text">Teleportation Area</code> component:</p><p><img src="https://rpl.cat/uploads/9V7Kjcgjzywt09UGC7Qa6s2djdGwpFsIXFAvMPnjKpc/public.png"></p><p>Run the game. You should be able to use the grip buttons to teleport.</p><p>This is pretty simple teleportation. Let’s improve it by using the thumbsticks to teleport instead. We’ll also add a “reticle” that allows us to see where we’re going.</p><h3 id="reticles" style="position:relative;"><a href="#reticles" aria-label="reticles permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reticles</h3><p>We’ll make a basic reticle. Create a new Cylinder in the environment and name it <code class="language-text">Reticle</code>. Remove the collider, reset the transform and scale the X and Z down to 0.6 and scale the Y down to 0.1:</p><p><img src="https://rpl.cat/uploads/EsTVD4jdyH1-YjSq34LruleKPK4Bbgjez4fAp6TxGZ8/public.png"></p><p>Make a new material for the reticle and call it <code class="language-text">Reticle</code>. Set the base color to blue, the opactity to 0.5, change the <code class="language-text">Surface Type</code> to <code class="language-text">Transparent</code>:</p><p><img src="https://rpl.cat/uploads/n3QtnCVCF4X79u1kl6J4C15X7K44xFuLGCTPAxKeJ6k/public.png"></p><p>Drag the material onto the <code class="language-text">Reticle</code> object.</p><p>Within the <code class="language-text">RightHand Controller</code> object, change the <code class="language-text">XR Ray Interactor</code>’s <code class="language-text">Line Type</code> to <code class="language-text">Projectile Curve</code> and change the <code class="language-text">Velocity</code> to <code class="language-text">8</code>. Set the <code class="language-text">Select Action Trigger</code> property to <code class="language-text">State Change</code>. Uncheck <code class="language-text">Enable Interaction with UI GameObjects</code> and set the <code class="language-text">Haptic Events</code> as follows:</p><ul>
<li><code class="language-text">On Select Enter</code>: Haptic Intensity: <code class="language-text">0.3</code>, Duration: <code class="language-text">0.1</code></li>
<li><code class="language-text">On Hover Enter</code>: Haptic Intensity: <code class="language-text">0.1</code>, Duration: <code class="language-text">0.1</code></li>
</ul><p><img src="https://rpl.cat/uploads/FD-REpbi7XqXpL2g2poM0Hr-7N-y0YBfl4hOBD6lN4s/public.png"></p><p>Then drag the <code class="language-text">Reticle</code> object from the hierarchy to the <code class="language-text">XR Interactor Line Visual</code>’s <code class="language-text">Reticle</code> property:</p><p><img src="https://rpl.cat/uploads/k8VyJ7cw26eXvwI4d7v6WbexU-G5ztdT8En7LHUqbrM/public.png"></p><p><a href="https://www.youtube.com/watch?v=siFRhXNVIcY">https://www.youtube.com/watch?v=siFRhXNVIcY</a></p></section>
<section><h2 id="adding-a-ball-to-throw" style="position:relative;"><a href="#adding-a-ball-to-throw" aria-label="adding a ball to throw permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding a ball to throw</h2><p>Create a new sphere object.</p><p><img src="https://rpl.cat/uploads/MisQlp5KkPmYXRpcDgRhkrGGcJAlM7_Fo5evyGf0-yE/public.png"></p><p>Position it above the table. You can set the transform as follows:</p><p><img src="https://rpl.cat/uploads/sLSuKU8M7daKXkezRlnes-KlExQFpHbaBRifqxSNKRo/public.png"></p><p>Add a RigidBody to the sphere and add an <code class="language-text">XR Grab Interactable</code>. Set the <code class="language-text">XR Grab Interactable</code> movement type to <code class="language-text">Velocity Tracking</code> and check the <code class="language-text">Force Gravity on Detach</code> checkbox. At this point you should be able to run the game and grab the sphere. You can even throw it! Unfortunately you’ll find it hard to get any momentum from the throw. Run the game and try to throw the sphere.</p><p>The reason you can’t throw it well is because the ball is colliding with your hands. When you let go of the grip button, the ball will start to collide and immediately fall down. If you don’t want interactors to work with it change the Layer of the ball to a new layer called <code class="language-text">Grab</code>.</p><p><img src="https://rpl.cat/uploads/KnkPfTbU3gOzTVukP-gE68L_5PxBF_KkfD0-X4A4nKQ/public.png"></p><p>We’ll also create a new layer called <code class="language-text">Avatar</code>. Open the <code class="language-text">Avatar</code> prefab and change the layer of the <code class="language-text">Avatar</code> object to <code class="language-text">Avatar</code> (including all of the children).</p><p><img src="https://rpl.cat/uploads/afw9XuGnV_BYh5Hh5fIYLX-qtXxeTKw3yYkAUkIJeiI/public.png"></p><p>Go to <code class="language-text">Edit</code> | <code class="language-text">Project Settings</code> | <code class="language-text">Physics</code> and go to the Layer Collision Matrix. Uncheck the box that is the intersection between <code class="language-text">Avatar</code> and <code class="language-text">Grab</code>.</p><p><img src="https://rpl.cat/uploads/FlrMZIhG-X00H6wYCrtXjardpPL3dSM2_qcVoIj2aUE/public.png"></p><p>Unfortunately the ball is not shared between all of the players. Each player sees the ball only for themselves.</p><p>To fix this we’ll need to add a <code class="language-text">Realtime Transform</code> component to the ball. This will automatically add a <code class="language-text">Realtime View</code> component to it as well. In order manage the ownership of these objects we’ll need each player to request ownership of the ball when it is grabbed. Create a new script component on the ball called <code class="language-text">Grabbable</code>. Use the following code:</p><div class="gatsby-highlight" data-language="cs"><pre class="language-cs"><code class="language-cs"><span class="token keyword">using</span> <span class="token namespace">Normal<span class="token punctuation">.</span>Realtime</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>XR<span class="token punctuation">.</span>Interaction<span class="token punctuation">.</span>Toolkit</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Grabbable</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">RealtimeTransform</span> realtimeTransform<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">XRGrabInteractable</span> interactable<span class="token punctuation">;</span>

  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    realtimeTransform <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RealtimeTransform<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Check to see if we think we're holding it, but no longer the owner of it.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>interactable<span class="token punctuation">.</span>isSelected <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>realtimeTransform<span class="token punctuation">.</span>isOwnedLocallySelf<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Drop it like it's hot!</span>
      interactable<span class="token punctuation">.</span>interactionManager<span class="token punctuation">.</span><span class="token function">CancelInteractableSelection</span><span class="token punctuation">(</span>interactable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnEnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    interactable <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>XRGrabInteractable<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>interactable <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      interactable<span class="token punctuation">.</span>selectEntered<span class="token punctuation">.</span><span class="token function">AddListener</span><span class="token punctuation">(</span>OnSelectEntered<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDisable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>interactable <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      interactable<span class="token punctuation">.</span>selectEntered<span class="token punctuation">.</span><span class="token function">RemoveListener</span><span class="token punctuation">(</span>OnSelectEntered<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnSelectEntered</span><span class="token punctuation">(</span><span class="token class-name">SelectEnterEventArgs</span> args<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Once we grab it, we're the owner of it - this will force everyone else to drop it.</span>
    realtimeTransform<span class="token punctuation">.</span><span class="token function">RequestOwnership</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre></div><h3 id="ownership-physics-and-gravity" style="position:relative;"><a href="#ownership-physics-and-gravity" aria-label="ownership physics and gravity permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ownership, physics, and gravity</h3><p>It might feel like we are doing a lot of work to figure out the “ownership” of the ball. An object can only have one owner at a time. The owner is responsible for the physics and gravity of the object. If you don’t own the ball, you can’t move it. This tends to be a problem when you have multiple players trying to grab the ball.</p><p>A common bug happens when one player is holding the ball and another grabs it out of their hand. According to the <code class="language-text">XRGrabInteractable</code> both players think they are holding the ball and controlling the movement. This results in the ball’s position being out of sync. When the player releases the ball, the ball should fall down, but instead loses its gravity because no owner is simulating its physics.</p><p>The above code fixes this by repeatedly checking if the ball is owned by the player during <code class="language-text">Update</code>. If it is not owned by the player but is being “held” according the <code class="language-text">XRGrabInteractable</code> then the ball should be immediately dropped.</p><blockquote>
<p>For more information, see <a href="https://www.youtube.com/watch?v=j2ldiEUxegs">https://www.youtube.com/watch?v=j2ldiEUxegs</a> (but note that we are accomplishing a lot of the tasks differently).</p>
</blockquote></section>
<section><h2 id="shooting-a-gun" style="position:relative;"><a href="#shooting-a-gun" aria-label="shooting a gun permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Shooting a gun</h2><p>Add a new empty game object called <code class="language-text">Gun</code>. Reset the transform. Add a <code class="language-text">RigidBody</code> component and an <code class="language-text">XR Grab Interactable</code> component to the <code class="language-text">Gun</code>. Set the <code class="language-text">XR Grab Interactable</code> movement type to <code class="language-text">Velocity Tracking</code> and check the <code class="language-text">Force Gravity on Detach</code> checkbox. We’ll also want to add the <code class="language-text">Grabbable</code> script from earlier to the <code class="language-text">Gun</code>.</p><p>Add two child cubes. Make the first cube scale x: 0.1, y: 0.2, z: 0.1</p><p><img src="https://rpl.cat/uploads/mI_OgLcqVXXuJSj_mbenY3Ni5bqnytQiN29ka2mTc14/public.png"></p><p>Make the cube scale x: 0.1, y: 0.1, z: 0.4 and position: x: 0, y: 0.1, z: 0.15.</p><p><img src="https://rpl.cat/uploads/laLPiKogTP1uV9qaaCoQ3OPLMrIbTZt7lGTwXO6rJT0/public.png"></p><p>Add another empty game object called <code class="language-text">Fire point</code> as a child of the <code class="language-text">Gun</code> object. Reset the transform. Set the position to x: 0, y: 0.1, z: 0.5.</p><h3 id="making-the-gun-shoot" style="position:relative;"><a href="#making-the-gun-shoot" aria-label="making the gun shoot permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Making the gun shoot</h3><p>Add a new script component to the <code class="language-text">Gun</code> object called <code class="language-text">Fire</code> with the code:</p><div class="gatsby-highlight" data-language="cs"><pre class="language-cs"><code class="language-cs"><span class="token keyword">using</span> <span class="token namespace">Normal<span class="token punctuation">.</span>Realtime</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Fire</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name">Transform</span> firePoint<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> bulletPrefab<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> firePower <span class="token operator">=</span> <span class="token number">1000f</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">FireBullet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name">GameObject</span> bullet <span class="token operator">=</span> Realtime<span class="token punctuation">.</span><span class="token function">Instantiate</span><span class="token punctuation">(</span>bulletPrefab<span class="token punctuation">,</span> firePoint<span class="token punctuation">.</span>position<span class="token punctuation">,</span> firePoint<span class="token punctuation">.</span>rotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bullet<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddForce</span><span class="token punctuation">(</span>firePoint<span class="token punctuation">.</span>forward <span class="token operator">*</span> firePower<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>Notice that we are instantiating the bullet by name, not by reference. Additionally, we are using the <code class="language-text">Realtime</code> instance to control the instantiation. This is because we want to make sure that the bullet is instantiated on all of the clients even though it is owned by the player who is shooting it. The player who is shooting the bullet will be in charge of simulating the physics (including gravity) of the bullet. Because of this, the controlling player can immediately add force to the bullet.</p><p>In Unity, drag the <code class="language-text">Fire Point</code> object onto the <code class="language-text">Fire Point</code> field in the <code class="language-text">Fire</code> script component. Set the <code class="language-text">Bullet Prefab</code> field to <code class="language-text">Bullet</code>:</p><p><img src="https://rpl.cat/uploads/KIg9jmE8aUR_I--FpQF3LAMiDLBn1Srgu1-U2QEpa0I/public.png"></p><p>On the <code class="language-text">Gun</code> object, create a new <code class="language-text">Activate</code> event on the <code class="language-text">XR Grab Interactable</code> component. Drag the <code class="language-text">Fire</code> script component onto the <code class="language-text">Activate</code> field. Then set the method to <code class="language-text">Fire.FireBullet</code>.</p><p><img src="https://rpl.cat/uploads/xaZrk0X21chzE-MqfM_qaSaq0ZbJ-aM37QjK0MT1-IY/public.png"></p><p>Move the gun above the table and then duplicate it so that there is one for you and your friend.</p><blockquote>
<p>You may have noticed that you can’t throw the gun, just like the ball. This is because the gun is colliding with your hands. Select both of the <code class="language-text">Gun</code> objects and change the layer to <code class="language-text">Grab</code>. Apply this to all of the children of the <code class="language-text">Gun</code> objects as well.</p>
<p><img src="https://rpl.cat/uploads/ZYY0t6zTizMk6u92KI6Rn-7_Vai7K7V4kIUI-_nAuVY/public.png"></p>
</blockquote><p>Lastly, we’ll need to create the prefab for the bullets. Add a new Sphere to the scene and call it <code class="language-text">Bullet</code>. Set the position to x: 0, y: 0, z: 0 and the scale to x: 0.1, y: 0.1, z: 0.1. Add a <code class="language-text">Realtime Transform</code> component so that all players can see it. Add a <code class="language-text">RigidBody</code> component then drag it into the <code class="language-text">Resources</code> folder to create a prefab and then delete it from the scene.</p><blockquote>
<p>For more information, see <a href="https://www.youtube.com/watch?v=44SEReNPSx4">https://www.youtube.com/watch?v=44SEReNPSx4</a>, (but note that we are accomplishing a lot of the tasks differently).</p>
</blockquote><h3 id="destroying-the-bullets" style="position:relative;"><a href="#destroying-the-bullets" aria-label="destroying the bullets permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Destroying the bullets</h3><p>When we shoot the bullet, we’ll want to destroy it after a certain amount of time. Open the <code class="language-text">Bullet</code> prefab and create a new script component called <code class="language-text">Destruct</code> with the following code:</p><div class="gatsby-highlight" data-language="cs"><pre class="language-cs"><code class="language-cs"><span class="token keyword">using</span> <span class="token namespace">Normal<span class="token punctuation">.</span>Realtime</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Destruct</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">SelfDestruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token return-type class-name">IEnumerator</span> <span class="token function">SelfDestruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WaitForSeconds</span><span class="token punctuation">(</span><span class="token number">5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Realtime<span class="token punctuation">.</span><span class="token function">Destroy</span><span class="token punctuation">(</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>This will automatically destroy the bullet after 5 seconds.</p><h1 id="something-fun-adding-some-color" style="position:relative;"><a href="#something-fun-adding-some-color" aria-label="something fun adding some color permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Something fun: adding some color</h1><p>Duplicate one of the guns so you have three guns. You need to do this because your game is so cool now you’ll probably have another friend wanting to play with you.</p><p>Create three new materials. Name them <code class="language-text">Yellow</code>, <code class="language-text">Green</code>, and <code class="language-text">Blue</code>. Set the <code class="language-text">Yellow</code> material to yellow, <code class="language-text">Green</code> to green, and <code class="language-text">Purple</code> to purple.</p><p><img src="https://rpl.cat/uploads/D6L0kkOGCTyYMgP7hzwBjApuLe_drdw-ptXCMNhrVUA/public.png"></p><p>Drag those onto the guns.</p><p><img src="https://rpl.cat/uploads/f_m9QfY_ldvBUZQtRTbIC6LnINVYR9DGCZY_x80usmI/public.png"></p><p>Let’s also make the bullets white. Make another material called <code class="language-text">White</code> and set it to white:</p><p><img src="https://rpl.cat/uploads/2jwJtwUN5olocfnvuDpSswylMOr37KDhTDtc0TWJk1Y/public.png"></p><p>Open the <code class="language-text">Bullet</code> prefab and drag the white material onto it.</p><h1 id="player-names" style="position:relative;"><a href="#player-names" aria-label="player names permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Player names</h1><p>Now that we have so many players it would be nice to have a way to name them. We can do this by adding a UI text component above the player’s head. Open the <code class="language-text">Avatar</code> prefab and add a new <code class="language-text">UI</code>, <code class="language-text">Text - TextMesh Pro</code> component called <code class="language-text">Player Name</code>. When you add this, it will ask if you want to import <code class="language-text">TMP Essentials</code>. Click the button to import them - for now we won’t need the <code class="language-text">TMP Examples &amp; Extras</code>:</p><p><img src="https://rpl.cat/uploads/1mXW8lkzIxgWFxGaQtzgKE0FOE4kLw651V9X5e1kCW4/public.png"></p><p>Unity automatically created a <code class="language-text">Canvas</code> object as well. Unfortunately, it’s gigantic. Let’s make it smaller. Open the <code class="language-text">Canvas</code> object, and set the <code class="language-text">Render Mode</code> to <code class="language-text">World Space</code>.</p><p>Then reset the transform, and set the scale to <code class="language-text">Pos X</code>: 0, <code class="language-text">Pos Y</code>: 0.3, <code class="language-text">Pos Z</code>: 0. Set the <code class="language-text">Width</code>: 1 and the <code class="language-text">Height</code>: 1.</p><p><img src="https://rpl.cat/uploads/1xQMSZu4jUYdxtxBzF8mOp0hQd4VtR8kwMW4mzD8Di8/public.png"></p><p>Select the actual TextMeshPro component and set the <code class="language-text">Text</code> to <code class="language-text">Player Name</code>. Then reset the transform, and set the scale to <code class="language-text">Pos X</code>: 0, <code class="language-text">Pos Y</code>: 0, <code class="language-text">Pos Z</code>: 0. Set the <code class="language-text">Width</code>: 1 and the <code class="language-text">Height</code>: 1. Set the <code class="language-text">Y</code> rotation to <code class="language-text">180</code>. Set the <code class="language-text">Font Size</code> to 0.1. Lastly, set the <code class="language-text">Alignment</code> to center and the vertical alignment to middle:</p><p><img src="https://rpl.cat/uploads/OGClX1pw2MlHUFtS7IY5H7kfQEWJFGc4D6wFUv1D6RI/public.png"></p></section>
<section><h2 id="multiplayer-names" style="position:relative;"><a href="#multiplayer-names" aria-label="multiplayer names permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Multiplayer names</h2><p>If you run the game, everyone will have the same name: <code class="language-text">Player Name</code>. Let’s change that. In order for everyone to see each player’s name, we’ll need to sync the player attributes through Normcore.</p><p>Create a new script called <code class="language-text">AvatarAttributesModel.cs</code> with the following code:</p><div class="gatsby-highlight" data-language="cs"><pre class="language-cs"><code class="language-cs"><span class="token keyword">using</span> <span class="token namespace">Normal<span class="token punctuation">.</span>Realtime</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Normal<span class="token punctuation">.</span>Realtime<span class="token punctuation">.</span>Serialization</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RealtimeModel</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">AvatarAttributesModel</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RealtimeProperty</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
  <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> _nickname<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><p>This model has a single synchronized property called <code class="language-text">_nickname</code>. We’ve indicated that the property should be <code class="language-text">reliable</code> meaning that it is guaranteed to be sent to all clients (it won’t be lost due to packets not being delivered). We’ve also indicated we want an on-change callback for this property.</p><p>Return to Unity and let the script compile. Then click on the script in the assets folder:</p><p><img src="https://rpl.cat/uploads/eJrBL7EmLQ8LMGxoSVeiJ7kmdLaGAd1ygoaoMN2xqfg/public.png"></p><p>Click <code class="language-text">Compile Model</code>. This will auto-generate most of the code we’ll need to record the model properties. We’ll also need to handle the changes to this model. To do this, we’ll create a corresponding sync class. Create a new script called <code class="language-text">AvatarAttributesSync.cs</code> with the following code:</p><div class="gatsby-highlight" data-language="cs"><pre class="language-cs"><code class="language-cs"><span class="token keyword">using</span> <span class="token namespace">Normal<span class="token punctuation">.</span>Realtime</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">TMPro</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AvatarAttributesSync</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RealtimeComponent<span class="token punctuation">&lt;</span>AvatarAttributesModel<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name">TextMeshProUGUI</span> playerNameText<span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> playerName<span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> adjectives <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token string">"Magical"</span><span class="token punctuation">,</span> <span class="token string">"Cool"</span><span class="token punctuation">,</span> <span class="token string">"Nice"</span><span class="token punctuation">,</span> <span class="token string">"Funny"</span><span class="token punctuation">,</span> <span class="token string">"Fancy"</span><span class="token punctuation">,</span> <span class="token string">"Glorious"</span><span class="token punctuation">,</span> <span class="token string">"Weird"</span><span class="token punctuation">,</span> <span class="token string">"Awesome"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> nouns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token string">"Weirdo"</span><span class="token punctuation">,</span> <span class="token string">"Guy"</span><span class="token punctuation">,</span> <span class="token string">"Santa Claus"</span><span class="token punctuation">,</span> <span class="token string">"Dude"</span><span class="token punctuation">,</span> <span class="token string">"Mr. Nice Guy"</span><span class="token punctuation">,</span> <span class="token string">"Dumbo"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> _isSelf<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Nickname <span class="token operator">=></span> model<span class="token punctuation">.</span>nickname<span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RealtimeAvatar<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isOwnedLocallyInHierarchy<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      _isSelf <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

      <span class="token comment">// Generate a funny random name</span>
      playerName <span class="token operator">=</span> adjectives<span class="token punctuation">[</span>UnityEngine<span class="token punctuation">.</span>Random<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> adjectives<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> nouns<span class="token punctuation">[</span>UnityEngine<span class="token punctuation">.</span>Random<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> nouns<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token comment">// Assign the nickname to the model which will automatically be sent to the server and broadcast to other clients</span>
      model<span class="token punctuation">.</span>nickname <span class="token operator">=</span> playerName<span class="token punctuation">;</span>

      <span class="token comment">// We don't need to see our own nickname</span>
      playerNameText<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnRealtimeModelReplaced</span><span class="token punctuation">(</span><span class="token class-name">AvatarAttributesModel</span> previousModel<span class="token punctuation">,</span> <span class="token class-name">AvatarAttributesModel</span> currentModel<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>previousModel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Unregister from events</span>
      previousModel<span class="token punctuation">.</span>nicknameDidChange <span class="token operator">-=</span> NicknameDidChange<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentModel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>currentModel<span class="token punctuation">.</span>isFreshModel<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        currentModel<span class="token punctuation">.</span>nickname <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">UpdatePlayerName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      currentModel<span class="token punctuation">.</span>nicknameDidChange <span class="token operator">+=</span> NicknameDidChange<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">NicknameDidChange</span><span class="token punctuation">(</span><span class="token class-name">AvatarAttributesModel</span> model<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> nickname<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">UpdatePlayerName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">UpdatePlayerName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Update the UI</span>
    playerNameText<span class="token punctuation">.</span>text <span class="token operator">=</span> model<span class="token punctuation">.</span>nickname<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>There is a lot going on in this script, but it is mostly boilerplate change handlers. The most interesting thing is that we are generating random funny names for the players and syncing them to everyone.</p><p>Back in Unity, open the Avatar prefab. Add the <code class="language-text">AvatarAttributesSync</code> script to the <code class="language-text">Avatar</code> object. Then drag the <code class="language-text">Player Name</code> TextMeshPro component to the <code class="language-text">Player Name Text</code> field:</p><p><img src="https://rpl.cat/uploads/uaZCpuzMSk4QaH1lv_AXIASohBNZMzS9iU_7TC0YaFE/public.png"></p><h1 id="inverse-kinematics" style="position:relative;"><a href="#inverse-kinematics" aria-label="inverse kinematics permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Inverse kinematics</h1><p>Right now, our head and hands are just cubes. We don’t even have a body. We could add a body, and attach our hands to the character hands and the head to the character head, but when we move our hands and heads the body will just deform. Instead, we’ll use the <code class="language-text">Inverse Kinematics</code> feature to make our avatar’s head and hands look like they are attached to the body and let the body solve the natural position automatically.</p><p>We’ll need a good looking body. Go to the Unity Asset Store and get the free <a href="https://assetstore.unity.com/packages/3d/props/polygon-starter-pack-low-poly-3d-art-by-synty-156819">POLYGON Starter Pack - Low Poly 3D Art by Synty</a><label for="sd-why-are-we-using-the" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-why-are-we-using-the" class="margin-toggle" /><span class="sidenote">Why are we using the <code>Polygon Starter Pack</code>? Because it has a nice low poly body, and it's free. But more importantly the Synty assets are amazing for virtual reality. They have a large number of packages available from their store: <a href="https://syntystore.com/">https://syntystore.com/</a></span>.</p><p>Back in Unity, open the <code class="language-text">Package Manager</code> and switch to <code class="language-text">My Assets</code>:</p><p><img src="https://rpl.cat/uploads/8hm5kOtxB_ae4DXMH_XAOcE2hU1uXI8TWE9jpVuJhUo/public.png"></p><p>Then search for the <code class="language-text">POLYGON Starter Pack - Low Poly 3D Art by Synty</code> package:</p><p><img src="https://rpl.cat/uploads/T1uuMGvOgXH4rRtLY-iMQIdgiuI7YcRvRSI3WkQoz1o/public.png"></p><p>Click <code class="language-text">Download</code>. Then click <code class="language-text">Import</code>:</p><p><img src="https://rpl.cat/uploads/h8XuYopink_A6P5iDLreVdOZQh0tcbOceQ_NAG44Knk/public.png"></p><p>Import the entire package.</p><p>Once installed, you can look at the imported assets. You may notice that all of the materials and prefabs in the <code class="language-text">Assets/PolygonStarterPack</code> folder are pink:</p><p><img src="https://rpl.cat/uploads/th2fHBMfRRU2xe2Mtxs137I8gqdNVSnr1nWdbQGp-Tg/public.png"></p><p>This is because we are using the Universal Render Pipeline but the assets were prepared without that pipeline. Open the <code class="language-text">Edit</code> menu, then <code class="language-text">Render Pipeline</code>, <code class="language-text">Universal Render Pipeline</code>, then click <code class="language-text">Upgrade Project Materials to UniversalRP Materials</code>. This will upgrade all of the materials in the <code class="language-text">Assets/PolygonStarterPack</code> folder to use the Universal Render Pipeline:</p><p><img src="https://rpl.cat/uploads/qxsa4HSMgir374frzHsuAkKPeKFT6H4ywpL_YeqyA1w/public.png"></p><p>Click <code class="language-text">Proceed</code> to continue. Within the Assets preview some of the assets may still appear pink, but when you use them in the scene they will be the correct color.</p><p>This is a good point to save your work.</p></section>
<section><h2 id="add-a-character-to-the-scene" style="position:relative;"><a href="#add-a-character-to-the-scene" aria-label="add a character to the scene permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add a character to the scene</h2><p>Let’s add a character to the scene. Find the <code class="language-text">SM_Character_Male_01</code> prefab asset and drag it into the scene. Reset the transform and rename <code class="language-text">SM_Character_Male_01</code> to <code class="language-text">Character</code>. Right click the object in the hierarchy and in the <code class="language-text">Prefab</code> menu, click <code class="language-text">Unpack completely</code>.</p><p>Hold option and click the arrow next to it to fully expand all of the children.</p><p><img src="https://rpl.cat/uploads/393kf_6_2kq7cCKnOcFkAt0AxQMF_KQDSi8TdzodfaI/public.png"></p><p>Notice that the character comes with the geometry of both the Male and Female character, we’ll use this later:</p><p><img src="https://rpl.cat/uploads/tNqcUcJBr_VI7kBootT7sFei8xyCDp_jFAzGk1OG3hA/public.png"></p><p>Now that we have a character, re-open the Package Manager, and change the filter to <code class="language-text">Unity Registry</code>. Search for the <code class="language-text">Animation Rigging</code> package:</p><p><img src="https://rpl.cat/uploads/ba_7xECxdsehcvUh3ltO9pMz3mVjJKLJcwu_aW21YBU/public.png"></p><p>Click <code class="language-text">Install</code>. This will give us a set of useful tools for rigging our character.</p></section>
<section><h2 id="rigging-the-upper-body" style="position:relative;"><a href="#rigging-the-upper-body" aria-label="rigging the upper body permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rigging the upper body</h2><p>Select the <code class="language-text">Character</code> game object then, in the <code class="language-text">Animation Rigging</code> menu, click <code class="language-text">Bone Renderer Setup</code>. Now you should see the bones in the scene:</p><p><img src="https://rpl.cat/uploads/E1G3CmyHqJxBpVkFJ6HXcyEZJxDqVaJHh3RZl5fHN3o/public.png"></p><p>With the <code class="language-text">Character</code> still selected, go to the <code class="language-text">Animation Rigging</code> menu again and click <code class="language-text">Rig Setup</code>. This will create a child rig named <code class="language-text">Rig 1</code>. Rename the newly created rig to <code class="language-text">Upper Body</code>.</p><p>We’ll need to create “constraints” our hands and head. Add an empty object called <code class="language-text">IK_Hand_R</code> and add a <code class="language-text">Two Bone IK Constraint</code> component to it.</p><blockquote>
<p>We’ll be selecting and dragging several objects at a time which can get confusing. To simplify this we’ll lock the inspector to the current object (<code class="language-text">IK_Hand_R</code>)</p>
<p><img src="https://rpl.cat/uploads/gNoxqLkFUjupNTij7ioRs_QQaA_lPVyoth3ZuGTbYEo/public.png"></p>
</blockquote><p>Lock the inspector, then click on the right hand in the scene and drag it to the <code class="language-text">IK_Hand_R</code> object <code class="language-text">Tip</code> property. This is the far end of our constraint. Right click on the <code class="language-text">Two Bone IK Constraint</code> component title and click <code class="language-text">Auto Setup from Tip Transform</code>:</p><p><img src="https://rpl.cat/uploads/1H80M-3FR77F4mwpaQAW9sjhe07QT0oygOJqyEg8-Ak/public.png"></p><p>This will create a target called <code class="language-text">IK_Hand_R_target</code> and a <em>hint</em><label for="sd-when-working-with" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-when-working-with" class="margin-toggle" /><span class="sidenote">When working with inverse kinematics, the "hint" is used to help the solver find the correct position of the target. The "target" is the end of the constraint. The solver can bend the bones at the joint in any number of ways when trying to solve the position, but uses the hint to help it know how to bend the bones at the joint.</span> called <code class="language-text">IK_Hand_R_hint</code>. We’ll need to align the target and the to the hand. Select the <code class="language-text">IK_Hand_R_target</code> in the hierarchy and then select the <code class="language-text">Hand_R</code> object simultaneously<label for="sd-selecting-multiple" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-selecting-multiple" class="margin-toggle" /><span class="sidenote">Selecting multiple objects in Unity is a bit tricky. You can select multiple objects by holding down the command key on Mac or the control key on Windows and clicking each of the objects in the hierarchy. Note: the order that you select the objects matters.</span> (the <code class="language-text">Hand_R</code> is nested inside the <code class="language-text">Root</code> object, but you can jump to it quickly by command clicking on the property value in the inspector). In the <code class="language-text">Animation Rigging</code> menu, click <code class="language-text">Align Transform</code>.</p><p>We’ll also need to align the hint to the elbow. Select the <code class="language-text">IK_Hand_R_hint</code> and the <code class="language-text">Elbow_R</code> object (used for the <code class="language-text">Mid</code> property) and again click <code class="language-text">Align Transform</code> in the <code class="language-text">Animation Rigging</code> menu. Unlock the inspector.</p><p>Human elbows tend to bend in very specific angles. Because of this, we’ll want to move the hint slightly behind the elbow. Select the <code class="language-text">IK_Hand_R_hint</code> and move it back. This will vary for each humanoid model, but in our case we’ll set the position to: <code class="language-text">X</code>: 0.8, <code class="language-text">Y</code>: 0.06, <code class="language-text">Z</code>: -0.5.</p><p>We’ll need to repeat this process for the left hand. The only difference is the the <code class="language-text">IK_Hand_L_hint</code> position is reversed: <code class="language-text">X</code>: -0.8, <code class="language-text">Y</code>: 0.06, <code class="language-text">Z</code>: -0.5.</p><p>With the hands aligned, we can now create a “constraint” for the head. Add an empty object called <code class="language-text">IK_Head</code> and add a <code class="language-text">Multi-Parent Constraint</code> to it. Drag the <code class="language-text">Head</code> object from the <code class="language-text">Root</code> to the <code class="language-text">IK_Head</code> object <code class="language-text">Constrained Object</code> property. Lock the inspector again.</p><p>There isn’t a way to automatically generate a target for this constraint. Instead, create a new child empty object called <code class="language-text">IK_Head_target</code>. Select it, then simultaneously select the <code class="language-text">Head</code> object (under the root). In the <code class="language-text">Animation Rigging</code> menu, click <code class="language-text">Align Transform</code>. Unlock the inspector.</p><p>Finally, drag the <code class="language-text">IK_Head_target</code> to the <code class="language-text">Source Objects</code> property of the <code class="language-text">IK_Head</code> object.</p></section>
<section><h2 id="attaching-the-character-to-the-avatar" style="position:relative;"><a href="#attaching-the-character-to-the-avatar" aria-label="attaching the character to the avatar permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Attaching the character to the avatar</h2><p>At this point we have a rigged character with all of the bones we need and all of the inverse kinematics and constraints we need to move the bones correctly. Next, we’ll need to connect the character to the avatar so that there is a character controlled by every player that joins the game. To do this we’ll move what we’ve built into the <code class="language-text">Avatar</code> prefab.</p><ul>
<li>Right click the <code class="language-text">Character</code> object and choose <code class="language-text">Copy</code></li>
<li>Open the <code class="language-text">Avatar</code> prefab from the <code class="language-text">Resources</code> folder; right click the <code class="language-text">Avatar</code> object and choose <code class="language-text">Paste</code></li>
<li>Close the <code class="language-text">Avatar</code> prefab and delete the <code class="language-text">Character</code> object from the scene (but not from the prefab)</li>
</ul><p>Save the scene.</p><p>Even though each <code class="language-text">Avatar</code> has a <code class="language-text">Character</code>, it will not follow the movement of the controllers yet. Open the <code class="language-text">Avatar</code> prefab again. On the <code class="language-text">Character</code> object, create a new script called <code class="language-text">Follow</code> with the following code:</p><div class="gatsby-highlight" data-language="cs"><pre class="language-cs"><code class="language-cs"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">System<span class="token punctuation">.</span>Serializable</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FollowOffset</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name">Transform</span> follow<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">Transform</span> target<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">Vector3</span> position<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">Vector3</span> rotation<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    target<span class="token punctuation">.</span>position <span class="token operator">=</span> follow<span class="token punctuation">.</span><span class="token function">TransformPoint</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    target<span class="token punctuation">.</span>rotation <span class="token operator">=</span> follow<span class="token punctuation">.</span>rotation <span class="token operator">*</span> Quaternion<span class="token punctuation">.</span><span class="token function">Euler</span><span class="token punctuation">(</span>rotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Follow</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name">FollowOffset</span> head<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">FollowOffset</span> leftHand<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">FollowOffset</span> rightHand<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token class-name">Transform</span> headConstraint<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">Vector3</span> headBodyOffset<span class="token punctuation">;</span>

  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    transform<span class="token punctuation">.</span>forward <span class="token operator">=</span> Vector3<span class="token punctuation">.</span><span class="token function">ProjectOnPlane</span><span class="token punctuation">(</span>headConstraint<span class="token punctuation">.</span>forward<span class="token punctuation">,</span> Vector3<span class="token punctuation">.</span>up<span class="token punctuation">)</span><span class="token punctuation">.</span>normalized<span class="token punctuation">;</span>
    transform<span class="token punctuation">.</span>position <span class="token operator">=</span> headConstraint<span class="token punctuation">.</span>position <span class="token operator">+</span> headBodyOffset<span class="token punctuation">;</span>

    head<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    leftHand<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rightHand<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>The <code class="language-text">Follow</code> script has three main properties:</p><ul>
<li>Head</li>
<li>Left Hand</li>
<li>Right Hand</li>
</ul><p>Each of these has a <em>target</em> which is the constraint that will be used to move the bone and a <em>follow</em> object that we want the track - in our case the <code class="language-text">Head</code>, <code class="language-text">Left Hand</code> and <code class="language-text">Right Hand</code> objects of our <code class="language-text">Avatar</code>. Save the script and return to Unity. Connect all of the <code class="language-text">Follow</code> and <code class="language-text">Target</code> properties:</p><p><img src="https://rpl.cat/uploads/DViooK3-Nh3lwAQjj-LuAhfU0sfFIaQoEEHGcKIX-qM/public.png"></p><p>Notice that we’ve setup a number of offsets for each of the tracked objects. These will vary for each model you use. The reason you need to have an offset is that all of our alignments are based off of the bones themselves. If we didn’t have an offset, then the hand would be aligned to the center of the joint where the hand meets the forearm bone. This might be right, but for many models (espcially those with large chunky hands) that point looks and feels wrong. Adjusting the offset so it is aligned with the palm of the hand feels more natural when playing.</p><p>Similarly, the center of the head is almost never aligned with the eye-line. Adjusting the head position to align with the eye-line feels more natural when playing.</p><p>Lastly, we want to move the avatar slightly behind the where the headset is (<code class="language-text">-0.65</code>). We do this for a couple of reasons:</p><ul>
<li>We don’t want to see the avatar in front of the camera.</li>
<li>Moving the headset forward helps the inverse kinematics solver account for the shape of the body.</li>
</ul><p>Depending on the shape and size of your avatar you might want to adjust this value.</p></section>
<section><h2 id="legs" style="position:relative;"><a href="#legs" aria-label="legs permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Legs</h2><p>At this point we haven’t done anything with the legs. There are some additional tutorials below on how to do this. For now we’ll simply hide the legs. To do this, open the <code class="language-text">Root</code> node and find the <code class="language-text">UpperLeg_L</code> and <code class="language-text">UpperLeg_R</code> objects and change the scale to <code class="language-text">0, 0, 0</code>:</p><p><img src="https://rpl.cat/uploads/BsxDUAinC_35ABVQjqNQuZhuFgsAeF71ttlTeFss2bg/public.png"></p><h3 id="physics-and-animations" style="position:relative;"><a href="#physics-and-animations" aria-label="physics and animations permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Physics and animations</h3><p>One thing we should note is that the <code class="language-text">Follow</code> script is performing instantaneous updates. There are several other models for tracking positions and rotations including physics and animation.</p><p>If you are looking to include more animations (for example, running, walking, and idling) you might want to explore the following videos from Valem:</p><ul>
<li>Inverse Kinematics - Part 1 - <a href="https://www.youtube.com/watch?v=tBYl-aSxUe0&#x26;list=RDCMUCPJlesN59MzHPPCp0Lg8sLw&#x26;index=1">https://www.youtube.com/watch?v=tBYl-aSxUe0&#x26;list=RDCMUCPJlesN59MzHPPCp0Lg8sLw&#x26;index=1</a></li>
<li>Inverse Kinematics - Part 2 - <a href="https://www.youtube.com/watch?v=Wk2_MtYSPaM&#x26;list=RDCMUCPJlesN59MzHPPCp0Lg8sLw&#x26;index=2">https://www.youtube.com/watch?v=Wk2_MtYSPaM&#x26;list=RDCMUCPJlesN59MzHPPCp0Lg8sLw&#x26;index=2</a></li>
<li>Inverse Kinematics - Part 3 - <a href="https://www.youtube.com/watch?v=8REDoRu7Tsw&#x26;list=RDCMUCPJlesN59MzHPPCp0Lg8sLw&#x26;index=3">https://www.youtube.com/watch?v=8REDoRu7Tsw&#x26;list=RDCMUCPJlesN59MzHPPCp0Lg8sLw&#x26;index=3</a></li>
</ul><p>If you are looking to have your character’s hands interact with the world based on physics, you might want to explore the following videos from Justin P. Barnett:</p><ul>
<li>Inverse Kinematics in Virtual Reality | VR Upper Body IK Unity Tutorial - <a href="https://www.youtube.com/watch?v=MYOjQICbd8I">https://www.youtube.com/watch?v=MYOjQICbd8I</a></li>
<li>Inverse Kinematics in Virtual Reality | VR Lower Body IK Unity Tutorial - <a href="https://www.youtube.com/watch?v=1Xr3jB8ik1g">https://www.youtube.com/watch?v=1Xr3jB8ik1g</a></li>
</ul><p>In both cases, you’ll find the approaches very similar.</p></section>
<section><h2 id="hiding-our-placeholder-avatar-cubes" style="position:relative;"><a href="#hiding-our-placeholder-avatar-cubes" aria-label="hiding our placeholder avatar cubes permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hiding our placeholder avatar cubes</h2><p>Throughout this process we’ve left the gray cubes we originally used for our avatar visible. These can be really helpful when trying to adjust the offsets of the hands and head. Build and run the game on the headset, then join the game within Unity. Looking at the alignment of the cubes and hands you can quickly figure out how to adjust the offsets.</p><p>Once you’re satisfied with the offsets, you can hide the cubes by going to the <code class="language-text">Avatar</code> prefab going to each of the <code class="language-text">Geometry</code> objects and unchecking the main checkbox:</p><p><img src="https://rpl.cat/uploads/fCCEfQ4lAKqf1AIZw93p-ieSSMb2CaY5CQ-NSHAaLgs/public.png"></p></section>
<section><h2 id="future-directions" style="position:relative;"><a href="#future-directions" aria-label="future directions permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Future directions</h2><p>Some additional things we could explore:</p><ul>
<li>Animating the legs</li>
<li>Interacting with physics</li>
<li>Switching the body</li>
<li>Hiding your own head</li>
<li>Scaling for different body sizes</li>
<li>Ghost mode</li>
</ul></section>
<div class="footnotes">
<hr>
<ol>
<li id="fn-multiselect">
<p>Selecting multiple objects in Unity is a bit tricky. You can select multiple objects by holding down the command key on Mac or the control key on Windows and clicking each of the objects in the hierarchy. Note: the order that you select the objects matters.</p>
<a href="#fnref-multiselect" class="footnote-backref">↩</a>
</li>
</ol>
</div></div><hr/><h2>Comments</h2><div class="sc-ifAKCX ddlDEo github"><div><p>Thanks for reading ❤️ – comment by replying to the <a href="https://github.com/jeffrafter/jeffrafter.github.io/issues/42">issue for this post</a>.<!-- --> <!-- -->There’s no comments yet; you could be the first.<br/></p></div><div class="sc-gzVnrw bOnSNx"><a href="https://github.com/jeffrafter/jeffrafter.github.io/issues/42#new_comment_field" target="_blank" rel="noreferrer noopener" class="button btn">Add a comment →</a></div></div><hr/><h2>There’s more to read</h2><div><p><em>Looking for more long-form posts? Here ya go...</em></p></div><ul class="sc-htoDjs gXLbcD"><li><a rel="prev" href="/getting-started-with-unity-and-vr/">← <!-- -->Getting Started With Unity and Virtual Reality</a></li></ul></div></article></main><footer class="sc-bwzfXH aCPwf footer">© <!-- -->2021<!-- -->,<!-- --> <a href="https://jeffrafter.com">jeffrafter.com</a>. Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-61511214-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/unity-multiplayer-vr-with-normcore/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-3b271d6a60df7cd92087.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-6846fb06ec67c7df9104.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-06b4f92e6d6da3e7e748.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-62ade78c2e0e44b33fb5.js"],"component---src-pages-tags-tsx":["/component---src-pages-tags-tsx-85ba1002141d5ed31e60.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-30b85df3d8081f386f13.js"],"component---src-templates-tag-tsx":["/component---src-templates-tag-tsx-1289ad2b8e0e8d66d692.js"]};/*]]>*/</script><script src="/component---src-templates-post-tsx-30b85df3d8081f386f13.js" async=""></script><script src="/commons-52923487d36b93dc329d.js" async=""></script><script src="/app-3b271d6a60df7cd92087.js" async=""></script><script src="/styles-fa79fef4936efa84b233.js" async=""></script><script src="/framework-8dcecaaefd71e2213eb2.js" async=""></script><script src="/webpack-runtime-38c8a4ef93b968ef91ae.js" async=""></script></body></html>