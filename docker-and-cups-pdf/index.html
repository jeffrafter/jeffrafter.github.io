<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.237ba1bc08ffadef5a9e.css">html{box-sizing:border-box;margin:0;padding:0}*,:after,:before{box-sizing:inherit}body{margin:0!important;padding:0}a.anchor,a.anchor:hover,a.anchor:link{background:none!important}figure a.gatsby-resp-image-link{background:none}figure span.gatsby-resp-image-wrapper{max-width:100%!important}article .excerpt{display:none}.btn,.button{display:inline-block;background:none!important;border-radius:40px;line-height:40px;min-height:40px;min-width:80px;padding:0 12px;text-align:center;text-decoration:none;border:1px solid #666;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}@font-face{font-family:et-book;src:url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.eot);src:url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.woff) format("woff"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.ttf) format("truetype"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.svg#etbookromanosf) format("svg");font-weight:400;font-style:normal}@font-face{font-family:et-book;src:url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.eot);src:url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.woff) format("woff"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.ttf) format("truetype"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.svg#etbookromanosf) format("svg");font-weight:400;font-style:italic}@font-face{font-family:et-book;src:url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.eot);src:url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.woff) format("woff"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.ttf) format("truetype"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.svg#etbookromanosf) format("svg");font-weight:700;font-style:normal}@font-face{font-family:et-book-roman-old-style;src:url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.eot);src:url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.woff) format("woff"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.ttf) format("truetype"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.svg#etbookromanosf) format("svg");font-weight:400;font-style:normal}html{font-size:15px}body{width:87.5%;margin-left:auto;margin-right:auto;padding-left:12.5%;font-family:et-book,Palatino,Palatino Linotype,Palatino LT STD,Book Antiqua,Georgia,serif;background-color:#fffff8;color:#111;max-width:1400px;counter-reset:sidenote-counter}h1{font-weight:400;margin-top:4rem;margin-bottom:1.5rem;font-size:3.2rem;line-height:1}h2{margin-top:2.1rem;font-size:2.2rem}h2,h3{font-style:italic;font-weight:400;margin-bottom:1.4rem;line-height:1}h3{font-size:1.7rem;margin-top:2rem}hr{display:block;height:1px;width:55%;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}p.subtitle{font-style:italic;margin-top:1rem;margin-bottom:1rem;font-size:1.8rem;display:block;line-height:1}.numeral{font-family:et-book-roman-old-style}.danger{color:red}article{position:relative;padding:1rem 0}section{padding-top:1rem;padding-bottom:1rem}ol,p,ul{font-size:1.4rem;line-height:2rem}p{margin-top:1.4rem;margin-bottom:1.4rem;padding-right:0;vertical-align:baseline}div.epigraph{margin:5em 0}div.epigraph>blockquote{margin-top:3em;margin-bottom:3em}div.epigraph>blockquote,div.epigraph>blockquote>p{font-style:italic}div.epigraph>blockquote>footer{font-style:normal}div.epigraph>blockquote>footer>cite{font-style:italic}blockquote{font-size:1.4rem}blockquote p{width:55%;margin-right:40px;font-style:italic;color:#999}blockquote footer{width:55%;font-size:1.1rem;text-align:right}section>footer,section>p,section>table{width:55%;clear:left}section>ol,section>ul{width:55%;-webkit-padding-start:5%}li:not(:first-child){margin-top:.25rem}figure{padding:0;border:0;font-size:100%;font:inherit;max-width:55%;-webkit-margin-start:0;-webkit-margin-end:0;-webkit-margin-before:0;margin-block-start:0;-webkit-margin-after:0;margin-block-end:0;margin:0 0 3em}figcaption,figure{vertical-align:baseline}figcaption{margin-top:-2em;margin-bottom:0;font-size:1.1rem;font-style:italic;line-height:1.6;position:relative;max-width:40%}figure.fullwidth figcaption{max-width:80%}a:link,a:visited{color:inherit}a:link{text-decoration:none;border-bottom:1px solid #000;padding-bottom:.05em;margin-bottom:.05em;word-break:break-word}a.anchor:link,nav.navigation a{border-bottom:0;padding-bottom:0;margin-bottom:0}@media screen and (-webkit-min-device-pixel-ratio:0){a:link{background-position-y:101%,101%,101%}}img{max-width:100%}.sidenote{margin-bottom:2em!important}.marginnote,.sidenote{float:right;clear:right;width:45%;margin:0 -75% 0 5%;font-size:1.1rem;line-height:1.3;vertical-align:baseline;position:relative}.sidenote-number{counter-increment:sidenote-counter}.sidenote-number:after,.sidenote:before{font-family:et-book-roman-old-style;position:relative;vertical-align:baseline}.sidenote-number:after{content:counter(sidenote-counter);font-size:1rem;top:-.5rem;left:.1rem}.sidenote:before{content:counter(sidenote-counter) " ";font-size:1rem;top:-.5rem}blockquote .marginnote,blockquote .sidenote{margin-right:-82%;min-width:59%;text-align:left}div.fullwidth,table.fullwidth{width:100%}div.table-wrapper{overflow-x:auto}.sans,div.table-wrapper{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}.sans{letter-spacing:.03em}code{font-family:Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:1rem;line-height:1.42}.sans>code{font-size:1.2rem}h1>code,h2>code,h3>code{font-size:.8em}.marginnote>code,.sidenote>code{font-size:1rem}pre.code{font-size:.9rem;width:52.5%;margin-left:2.5%;overflow-x:auto}pre.code.fullwidth{width:90%}.fullwidth{max-width:100%;clear:both}span.newthought{font-variant:small-caps;font-size:1.2em}input.margin-toggle{display:none}label.sidenote-number{display:inline}label.margin-toggle:not(.sidenote-number){display:none}.iframe-wrapper{position:relative;padding-bottom:56.25%;padding-top:25px;height:0}.iframe-wrapper iframe{position:absolute;top:0;left:0;width:100%;height:100%}@media (max-width:760px){body{padding-left:8%;padding-right:8%}body,hr,section>footer,section>p,section>table{width:100%}pre.code{width:97%}section>ol,section>ul{width:90%}figure{max-width:90%}figcaption,figure.fullwidth figcaption{margin-right:0;max-width:none}blockquote{margin-left:1.5em;margin-right:0}blockquote footer,blockquote p{width:100%}label.margin-toggle:not(.sidenote-number){display:inline}.marginnote,.sidenote{display:none}.margin-toggle:checked+.marginnote,.margin-toggle:checked+.sidenote{display:block;float:left;left:1rem;clear:both;width:95%;margin:1rem 2.5%;vertical-align:baseline;position:relative}label{cursor:pointer}div.table-wrapper,table{width:85%}img{width:100%}}:not(pre)>code[class*=language-]{font-size:.9em!important}.gatsby-highlight:after{content:"";display:block;clear:both}.gatsby-highlight{clear:both}h4{font-size:1.3em}.markdown-body ol,.markdown-body p,.markdown-body ul{font-size:inherit;line-height:inherit}.markdown-body blockquote{font-size:inherit}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:24px;letter-spacing:normal;border-bottom:1px solid #efefef}@media (max-width:767px){.markdown-body{padding:15px}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;-o-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;-o-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;-o-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;-o-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;-o-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;-o-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;-o-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;-o-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;-o-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;-o-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;-o-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;-o-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><meta name="generator" content="Gatsby 2.23.4"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://jeffrafter.com/docker-and-cups-pdf/" data-baseprotocol="https:" data-basehost="jeffrafter.com"/><link rel="icon" href="/favicon-32x32.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><title data-react-helmet="true">Docker, CUPS-PDF, Avahi and AirPrint | Jeff Rafter</title><meta data-react-helmet="true" name="description" content="Just use docker to print to a PDF from your iPad ™️"/><meta data-react-helmet="true" property="og:title" content="Docker, CUPS-PDF, Avahi and AirPrint"/><meta data-react-helmet="true" property="og:description" content="Just use docker to print to a PDF from your iPad ™️"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://jeffrafter.com//static/4bebf8f1c549ca09cb717d1bb2d3fdb2/10e03/docker-and-cups-pdf.png"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Jeff Rafter"/><meta data-react-helmet="true" name="twitter:title" content="Docker, CUPS-PDF, Avahi and AirPrint"/><meta data-react-helmet="true" name="twitter:description" content="Just use docker to print to a PDF from your iPad ™️"/><meta data-react-helmet="true" name="keywords" content="markdown"/><style data-styled="coseIW ddlDEo bOnSNx gXLbcD aCPwf" data-styled-version="4.4.1">
/* sc-component-id: sc-global-3268680936 */
::selection{background-color:#dad9d9;color:rgba(0,0,0,0.70);}
/* sc-component-id: sc-bdVaJa */
.coseIW ul{list-style-type:none;margin:1rem 0;padding:0;margin-left:-16px;} .coseIW li{display:inline-block;margin:16px;} .coseIW li a{background:none;}
/* sc-component-id: sc-bwzfXH */
.aCPwf{padding-bottom:36px;}
/* sc-component-id: sc-ifAKCX */
.ddlDEo{width:55%;}
/* sc-component-id: sc-gzVnrw */
.bOnSNx{margin-top:40px;margin-bottom:40px;float:right;}
/* sc-component-id: sc-htoDjs */
.gXLbcD{list-style-type:none;} .gXLbcD li::before{content:'' !important;padding-right:0 !important;}</style><link as="script" rel="preload" href="/webpack-runtime-38c8a4ef93b968ef91ae.js"/><link as="script" rel="preload" href="/framework-8dcecaaefd71e2213eb2.js"/><link as="script" rel="preload" href="/styles-fa79fef4936efa84b233.js"/><link as="script" rel="preload" href="/app-3b271d6a60df7cd92087.js"/><link as="script" rel="preload" href="/commons-52923487d36b93dc329d.js"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-30b85df3d8081f386f13.js"/><link as="fetch" rel="preload" href="/page-data/docker-and-cups-pdf/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav class="sc-bdVaJa coseIW navigation"><ul><li><a href="/">&amp;</a></li><li><a href="/tags">Tags</a></li><li><a href="/about">About</a></li></ul></nav><main class="content" role="main"><article><header><h1>Docker, CUPS-PDF, Avahi and AirPrint</h1><p>February 17, 2024</p></header><div class="page-content"><div><section><figure class="fullwidth"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4bebf8f1c549ca09cb717d1bb2d3fdb2/de9fe/docker-and-cups-pdf.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 48.4375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4UlEQVQoz3WST2sTURTF5xu40rV2JVILaZLayUSlGxfqTrBfoHRX3Ev9U5C2qKnSpDOTSSQdKthQMKAo2lUxmygaqBIo2trMTKcJaBf9BD/fm+nkD8HF4d5337wz5957lJTpIqEaAqZDdA5r8uyE0ejGIO/cu926yJWoqEkyYx9V3xexSTrviFr/owB5P0RA6gzcK2qgxmHMOGCs+BetdETqxR9Gsh6JXM/HMlot1KWvAl9EfohmyLfeicKwK0VKlWTXzQY3Zm1uzRaYWd7g6eYOk688kitNUnkPLbeLeq+MemcO9a4tyDxiSzUu5X71K4xlHaYrPkftn+iZBd5Xymy+e8uxt83rHy1GV1wuWwdcnP/I+fsFhh8WBVa5kKkytPiB+JNaR2VAKNu6vX5IufqdB48WmX+cISuIrfUK11Z9xoUSTd9laHmLcy+3OW03OGXvcCb7icSzupi1378UOb+k7jLyfI/4wmdic1tMFapMlhokhDpVd7hacrhp15h5841hu85ZoW5irc5E6TfjeriDaOuKaoSFtJxToYVWbBM32yQNP9i8vA+2LdrS8i5XLOECfY+05fVYyx20TcqMPNYMiCKyfh+6YgQheTSzrgs6Lbv8HxHpyQ/NHqMP5OF3/wBGCxoF7U+4DAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Printer with continuous ink system"
        title="Printer with continuous ink system"
        src="/static/4bebf8f1c549ca09cb717d1bb2d3fdb2/21b4d/docker-and-cups-pdf.png"
        srcset="/static/4bebf8f1c549ca09cb717d1bb2d3fdb2/72799/docker-and-cups-pdf.png 320w,
/static/4bebf8f1c549ca09cb717d1bb2d3fdb2/6af66/docker-and-cups-pdf.png 640w,
/static/4bebf8f1c549ca09cb717d1bb2d3fdb2/21b4d/docker-and-cups-pdf.png 1280w,
/static/4bebf8f1c549ca09cb717d1bb2d3fdb2/29114/docker-and-cups-pdf.png 1920w,
/static/4bebf8f1c549ca09cb717d1bb2d3fdb2/de9fe/docker-and-cups-pdf.png 2146w"
        sizes="(max-width: 1280px) 100vw, 1280px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></figure><p>Just use docker, they said. It will be easy, they said.</p><p>I’ve been trying to get my iPad to print to a PDF for a while now. I’ve used PDFWriter but I wasn’t able to print from an iOS simulator on my localhost. Realized that I could use CUPS-PDF to print to a PDF and then use Avahi to broadcast it as an AirPrint printer and that this might help me workaround the DNS rebinding protection built into CUPS.</p><p>Spoiler: it didn’t.</p><p>But this was a fun little project and I learned a lot about Docker, CUPS-PDF and Avahi.</p><h1 id="getting-started" style="position:relative;"><a href="#getting-started" aria-label="getting started permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Getting started</h1><p><a href="https://www.cups-pdf.de">CUPS-PDF</a> is a virtual printer that allows you to print to a PDF. It’s a great way to create PDFs from any application that supports printing. You can use it to create PDFs from web pages, documents, images, etc. It runs in Linux and relies on the CUPS printing system.</p><p>In our previous article, <a href="./printers-fake-printers-and-airprint">Printers, Fake Printers, and AirPrint</a> we used the Mac-specific RWTS-PDFWriter as a virtual printer. The setup was simple and it worked well. Unfortunately, RWTS-PDFWriter relies on the underlying system installation of CUPS. Because of this it no longer supports PostScript (as of MacOS Sonoma) and isn’t using the latest version of CUPS based on the <a href="https://openprinting.github.io/">OpenPrinting</a> project.</p><p><a href="https://avahi.org">Avahi</a> is a zeroconf implementation that allows you to broadcast services on a local network. It’s a great way to discover services on your local network without having to configure DNS or DHCP. It’s used by Apple’s Bonjour protocol to broadcast services like AirPrint.</p><p><a href="https://www.docker.com">Docker</a> is a containerization platform that allows you to run applications in a consistent environment. It’s a great way to run applications without having to worry about dependencies or conflicts with other applications. On macOS, Docker runs in a hypervisor environment and you can use it to run Linux applications (note, it is not an actual virtual machine).</p><p>In order to run Docker on macOS, you need to install Docker Desktop. This will install the Docker CLI, Docker Compose and the Docker Engine. You can then use the Docker CLI to run containers, build images and manage your Docker environment.</p><p>Go to <a href="https://www.docker.com/products/docker-desktop/">https://www.docker.com/products/docker-desktop/</a> and download Docker Desktop for Mac.</p></section>
<section><h2 id="setting-up-the-docker-container" style="position:relative;"><a href="#setting-up-the-docker-container" aria-label="setting up the docker container permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting up the Docker container</h2><p>Docker containers rely on <code class="language-text">Dockerfile</code> files. Create a new folder and add a <code class="language-text">Dockerfile</code> with the following content:</p><div class="gatsby-highlight" data-language="dockerfile"><pre class="language-dockerfile"><code class="language-dockerfile"><span class="token comment"># Use a base image with necessary dependencies (e.g., Debian)</span>
<span class="token keyword">FROM</span> debian<span class="token punctuation">:</span>latest

<span class="token comment"># Install required packages (CUPS, CUPS-PDF)</span>
<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update &amp;&amp; \
    apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y \
        cups \
        printer<span class="token punctuation">-</span>driver<span class="token punctuation">-</span>cups<span class="token punctuation">-</span>pdf \
        &amp;&amp; \
    apt<span class="token punctuation">-</span>get clean &amp;&amp; \
    rm <span class="token punctuation">-</span>rf /var/lib/apt/lists/*

<span class="token comment"># Expose the CUPS port</span>
<span class="token keyword">EXPOSE</span> 631

<span class="token comment"># Copy printer configuration script</span>
<span class="token keyword">COPY</span> configure<span class="token punctuation">-</span>printer.sh /usr/local/bin/

<span class="token comment"># Make it executable</span>
<span class="token keyword">RUN</span> chmod +x /usr/local/bin/configure<span class="token punctuation">-</span>printer.sh

<span class="token comment"># Set entry point</span>
<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">"/usr/local/bin/configure-printer.sh"</span><span class="token punctuation">]</span></code></pre></div><p>Notice we are expecting a <code class="language-text">configure-printer.sh</code> script. Create a new file called <code class="language-text">configure-printer.sh</code> in the same folder as your <code class="language-text">Dockerfile</code> with the following content:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># Stop any service that auto-started</span>
<span class="token function">service</span> cups stop

<span class="token comment"># Start the CUPS daemon in the background</span>
/usr/sbin/cupsd

<span class="token comment"># Wait for CUPS to start</span>
<span class="token keyword">until</span> lpstat -H<span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Waiting for CUPS to start..."</span>
  <span class="token function">sleep</span> <span class="token number">1</span>
<span class="token keyword">done</span>
<span class="token builtin class-name">echo</span> <span class="token string">"CUPS started"</span>

<span class="token comment"># Share everything</span>
cupsctl --share-printers --remote-any --remote-admin --user-cancel-any <span class="token string">"WebInterface=Yes"</span>

<span class="token comment"># Configure CUPS-PDF</span>
<span class="token function">mkdir</span> -p /var/spool/cups-pdf/CUPS-PDF
<span class="token function">chmod</span> <span class="token number">1777</span> /var/spool/cups-pdf/CUPS-PDF
lpadmin -p CUPS-PDF -E -v cups-pdf:/ -P /usr/share/ppd/cups-pdf/CUPS-PDF_opt.ppd -D <span class="token string">"CUPS-PDF Printer"</span> -L <span class="token string">"PDF Printer"</span>

<span class="token comment"># Keep container running</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Printer configured. Container will keep running."</span>
<span class="token function">tail</span> -f /var/log/cups/error_log</code></pre></div><p>This script stops any service that auto-started, starts the CUPS daemon in the background, waits for CUPS to start, shares everything, configures CUPS-PDF and then keeps the container running.</p><p>Now build the Docker image:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ docker build -t cups-pdf <span class="token builtin class-name">.</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">0</span>.7s <span class="token punctuation">(</span><span class="token number">9</span>/9<span class="token punctuation">)</span> FINISHED
 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build definition from Dockerfile
 <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring dockerfile: 37B
 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load .dockerignore
 <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring context: 2B
 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/debian:latest
 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">1</span>/4<span class="token punctuation">]</span> FROM docker.io/library/debian:latest@sha256:4482958b4461ff7d9fabc24b3a9ab1e9a2c85ece07b2db1840c7cbc01d053e90
 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build context
 <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> transferring context: 720B
 <span class="token operator">=</span><span class="token operator">></span> CACHED <span class="token punctuation">[</span><span class="token number">2</span>/4<span class="token punctuation">]</span> RUN <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y cups printer-driver-cups-pdf <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> clean <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -rf /var/lib/apt/lists/*
 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">3</span>/4<span class="token punctuation">]</span> COPY configure-printer.sh /usr/local/bin/
 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">4</span>/4<span class="token punctuation">]</span> RUN <span class="token function">chmod</span> +x /usr/local/bin/configure-printer.sh
 <span class="token operator">=</span><span class="token operator">></span> exporting to image
 <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> exporting layers
 <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> writing image sha256:100089de8e3c91417db1e27897dda8d21f5ab0499ff20f31bb111e5ae2a014af
 <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">=</span><span class="token operator">></span> naming to docker.io/library/cups-pdf</code></pre></div><p>The first time you run this command it will take a while to download the base image and install the required packages. Subsequent builds will be faster because Docker will cache the layers.</p><p>Now you can run the Docker container:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ docker run -it cups-pdf
Stopping Common Unix Printing System: cupsd.
/run/cups/cups.sock
CUPS started
lpadmin: Printer drivers are deprecated and will stop working <span class="token keyword">in</span> a future version of CUPS.
Printer configured. Container will keep running.
E <span class="token punctuation">[</span><span class="token number">18</span>/Feb/2024:15:14:53 +0000<span class="token punctuation">]</span> Unable to <span class="token function">open</span> listen socket <span class="token keyword">for</span> address <span class="token punctuation">[</span>v1.::1<span class="token punctuation">]</span>:631 - Cannot assign requested address.
E <span class="token punctuation">[</span><span class="token number">18</span>/Feb/2024:15:14:53 +0000<span class="token punctuation">]</span> Unable to communicate with avahi-daemon: Daemon not running</code></pre></div><blockquote>
<p>Press <code class="language-text">Ctrl+C</code> to stop the container.</p>
</blockquote><p>This will start the CUPS-PDF container and configure the CUPS-PDF printer. Unfortunately there are a few errors. The first error is a warning about deprecated printer drivers. That error can be safely ignored for now. The second error is about not being able to open a listen socket for the address <code class="language-text">v1.::1</code>. This is because the container is running in a hypervisor environment and the host networking is not available.</p><p>In order to fix this error, you need to run the container in host networking mode. This will allow the container to use the host networking stack and access the host network interfaces. You can do this by adding the <code class="language-text">--network host</code> flag to the <code class="language-text">docker run</code> command:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ docker run -it --network <span class="token function">host</span> cups-pdf
Stopping Common Unix Printing System: cupsd.
/run/cups/cups.sock
CUPS started
lpadmin: Printer drivers are deprecated and will stop working <span class="token keyword">in</span> a future version of CUPS.
Printer configured. Container will keep running.
E <span class="token punctuation">[</span><span class="token number">18</span>/Feb/2024:15:17:46 +0000<span class="token punctuation">]</span> Unable to communicate with avahi-daemon: Daemon not running</code></pre></div><p>The last error is a warning about Avahi not running. We’ll fix these errors in the next section.</p><p>Unfortunately, we still can’t use this printer because we are not able to access the Docker container’s ports from the host. Although we are exposing port 631 we need to map the container’s port to the host’s port. We can do this by adding the <code class="language-text">-p 631:631</code> flag to the <code class="language-text">docker run</code> command:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ docker run -it --network <span class="token function">host</span> -p <span class="token number">631</span>:631 cups-pdf
WARNING: Published ports are discarded when using <span class="token function">host</span> network mode
docker: Error response from daemon: Ports are not available: exposing port TCP <span class="token number">0.0</span>.0.0:631 -<span class="token operator">></span> <span class="token number">0.0</span>.0.0:0: listen tcp <span class="token number">0.0</span>.0.0:631: bind: address already <span class="token keyword">in</span> use</code></pre></div><p>We immediately get an error because the host is already using port 631 - our local machine is running the CUPS service. We can fix this by stopping the CUPS service on the host:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ <span class="token function">sudo</span> launchctl unload /System/Library/LaunchDaemons/org.cups.cupsd.plist</code></pre></div><blockquote>
<p>You would think that you could just stop the CUPS service using <code class="language-text">sudo launchctl stop org.cups.cupsd</code> but that doesn’t work as it will automatically restart. You need to use <code class="language-text">launchctl unload</code> to stop the service. To restart the service, use <code class="language-text">sudo launchctl load /System/Library/LaunchDaemons/org.cups.cupsd.plist</code>.</p>
</blockquote><p>Run the container again:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ docker run -it -p <span class="token number">631</span>:631 cups-pdf
Stopping Common Unix Printing System: cupsd.
/run/cups/cups.sock
CUPS started
lpadmin: Printer drivers are deprecated and will stop working <span class="token keyword">in</span> a future version of CUPS.
Printer configured. Container will keep running.
E <span class="token punctuation">[</span><span class="token number">18</span>/Feb/2024:15:23:11 +0000<span class="token punctuation">]</span> Unable to <span class="token function">open</span> listen socket <span class="token keyword">for</span> address <span class="token punctuation">[</span>v1.::1<span class="token punctuation">]</span>:631 - Cannot assign requested address.
E <span class="token punctuation">[</span><span class="token number">18</span>/Feb/2024:15:23:11 +0000<span class="token punctuation">]</span> Unable to communicate with avahi-daemon: Daemon not running</code></pre></div><p>At this point, we have access to the CUPS-PDF printer on the host, but it is not being advertised as an AirPrint printer. To do this (in a separate terminal, with the Docker container still running) run the following command:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">dns-sd -R <span class="token string">"CUPS-PDF @ AirPrint"</span> _ipp._tcp,_universal <span class="token builtin class-name">.</span> <span class="token number">631</span> <span class="token punctuation">\</span>
        <span class="token assign-left variable">pdl</span><span class="token operator">=</span>application/octet-stream,application/pdf,image/jpeg,image/png,image/pwg-raster,image/urf <span class="token punctuation">\</span>
        <span class="token assign-left variable">adminurl</span><span class="token operator">=</span> <span class="token punctuation">\</span>
        <span class="token assign-left variable">rp</span><span class="token operator">=</span>printers/cups-pdf <span class="token punctuation">\</span>
        <span class="token assign-left variable">TLS</span><span class="token operator">=</span><span class="token number">1.2</span> <span class="token punctuation">\</span>
        <span class="token assign-left variable">Color</span><span class="token operator">=</span>T <span class="token punctuation">\</span>
        <span class="token assign-left variable">Copies</span><span class="token operator">=</span>T</code></pre></div><p>This will broadcast the CUPS-PDF printer as an AirPrint printer on the local network. You can now print to the CUPS-PDF printer from your iOS device.</p><p>But where do the PDFs go? The PDFs are saved in the <code class="language-text">/var/spool/cups-pdf/ANONYMOUS</code> folder inside the container. You can access the PDFs by running the following command:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ docker <span class="token builtin class-name">exec</span> -it <span class="token operator">&lt;</span>container-id<span class="token operator">></span> <span class="token function">ls</span> /var/spool/cups-pdf/ANONYMOUS</code></pre></div><blockquote>
<p>Replace <code class="language-text">&lt;container-id&gt;</code> with the ID of the running container. You can find this by running <code class="language-text">docker ps</code>. You can automate finding the container ID by using <code class="language-text">$(docker ps -a | grep -m 1 cups-pdf | awk &#39;{print $1}&#39;)</code>.</p>
</blockquote><p>If you want to save the PDFs to the host, you can copy them (see the <code class="language-text">docker cp</code> command) or you can mount a volume to the container.</p><p>First create a folder on the host:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">mkdir</span> -p ~/Documents/CUPS-PDF</code></pre></div><p>Then run the container with the volume mounted:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ docker run -it  -p <span class="token number">631</span>:631 -v ~/Documents/CUPS-PDF:/var/spool/cups-pdf/ANONYMOUS cups-pdf
Stopping Common Unix Printing System: cupsd.
/run/cups/cups.sock
CUPS started
lpadmin: Printer drivers are deprecated and will stop working <span class="token keyword">in</span> a future version of CUPS.
Printer configured. Container will keep running.
E <span class="token punctuation">[</span><span class="token number">18</span>/Feb/2024:15:42:50 +0000<span class="token punctuation">]</span> Unable to <span class="token function">open</span> listen socket <span class="token keyword">for</span> address <span class="token punctuation">[</span>v1.::1<span class="token punctuation">]</span>:631 - Cannot assign requested address.
E <span class="token punctuation">[</span><span class="token number">18</span>/Feb/2024:15:42:50 +0000<span class="token punctuation">]</span> Unable to communicate with avahi-daemon: Daemon not running</code></pre></div><p>When you run this (if you used the <code class="language-text">~/Documents</code> folder like I did) you’ll get a permissions dialog:</p><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 261px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/0fbf0365f402234d4b5411afee89acd5/edf96/docker-and-cups-pdf-documents.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 81.60919540229885%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAADOklEQVQ4y2WUSXMbRRTH/XU4UUXxAahwSJFbgmOt06MZzUgaW7uUyJZsOZIjR5ZiLRXLTqzIC8jxApFwYcq5UFBQ3LhxorhDzhSpHLD7z3sty7HJ4V/d/fr17y09PRPhcAimaUgzaPCoFAyaMElBM0DSIYJh6CTLFLQfUPtj6bpApfIQjx4ty8nJzzFhWcFzYwSShhGQhhmQpmmSeG7IGws/yZvt1/LT5l/yRvFnqYIrmWoUQpOrjVXZbDZw587tMwZK8x1wlCVHNwSEHcNHlTcY/AasfA98UPpXZcpZsw8FV/6UpWJMTd09Z+BlqdeBGjQrjg/zf+OP18Cvf57hk8Yb6E5KBRsDL85I27beAcegq0DulWEG8XHqd7jaEvd+/AcxyjRS3YDhc8O0rEsgt4o57wHHFxK0LppOpRlWBLfFfWipB3DKdVjRBGWok8+1yt4HMoBHarKSpvkh6Ab9nI3ugaG54XNNQvN5lH3sx7fMJV8DchSv14NsNoNGYxX1eg18a/PzBXQ6HTysVFBcXEStXkeD7LzXbrdQKj3A7GwOHo9bhkIXPeRmchTeKJdLWF/vqAN7e3totZrodjextFTGykpV2bvdrrJvbKwTtE0B1zgRyRVeAoUQWKQMKssVVKtVFAoFil5CiQJUCbRGh3Z2tlEsLigtkx8H4QRqtRXyz//vswkI6o0bfi/LBV3zQvg98LjuojifR+fJKJN4PAa32wW/36fk83m5XJ5f7aEphROHnsjBP52GFs1CxLLwz2SgkbxOGi4jTJfkg23biETCsEM2uDIWr0mSn7AC6nZEzrW3sP3iQL4Ynsidw5fof32M/W9OsHs0QK9/gNlmF+VqHTvbPTx99hRHR4cYDgfU5z42N5/Jra2efPy4DnrLBAw5WFjblf39Awy/eyW/Ov4Wh4Njmp9ieHKK/v4h8q3nWKo10P9yF73ecwwGL3H66lRBaS2/IHuz1Rj9HOjbO9Nj92BkFqRIzEFP5hFIFyCSc+A12SGiGYSozGh0BjMkZzqiSnWciLKR5PS0A5dr6u3ErVuf/TJ7P4t0Mn6eSSUkCVdF9tGYTiGVSirx/MpaJpOJ81wuB2L98B/f3O/jZq7BZwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Docker Desktop would like to access your Documents"
        title="Docker Desktop would like to access your Documents"
        src="/static/0fbf0365f402234d4b5411afee89acd5/edf96/docker-and-cups-pdf-documents.png"
        srcset="/static/0fbf0365f402234d4b5411afee89acd5/edf96/docker-and-cups-pdf-documents.png 261w"
        sizes="(max-width: 261px) 100vw, 261px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p><p>Choose <code class="language-text">Allow</code>. Now when you print to the CUPS-PDF printer, the PDFs will be saved to the <code class="language-text">~/Documents/CUPS-PDF</code> folder on the host.</p><h1 id="avahi" style="position:relative;"><a href="#avahi" aria-label="avahi permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Avahi</h1><p>If you are like me, you might be thinking: “This is great, but I don’t want to have to run the <code class="language-text">dns-sd</code> command every time I start the container, maybe I can use Avahi to broadcast the CUPS-PDF printer as an AirPrint printer automatically.”</p><p>Spoiler: you can’t.</p><p>On Mac, the container network is completely separate from the host network even when running in host networking mode. This means that the Avahi daemon running in the container is not able to communicate with the host. Because of this the Avahi daemon within the container cannot use multicast DNS to broadcast services on the local network.</p><p>For more information, see <a href="https://github.com/docker/for-mac/issues/3926#issuecomment-1760373163">Docker host networking</a>.</p><p>But it is still interesting to get Avahi to work in a container. If your host computer was Linux, or if you wanted to multicast broadcast between Docker containers (See Container Networks, <code class="language-text">--network container:&lt;name|id&gt;</code>, in <a href="https://docs.docker.com/network/">https://docs.docker.com/network/</a>), this would allow broadcasting on those networks.</p></section>
<section><h2 id="updating-the-code-classlanguage-textdockerfilecode" style="position:relative;"><a href="#updating-the-code-classlanguage-textdockerfilecode" aria-label="updating the code classlanguage textdockerfilecode permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Updating the <code class="language-text">Dockerfile</code></h2><p>In order to run Avahi we’ll need to update the <code class="language-text">Dockerfile</code> to install Avahi and its dependencies. Change  the <code class="language-text">Dockerfile</code>:</p><div class="gatsby-highlight" data-language="dockerfile"><pre class="language-dockerfile"><code class="language-dockerfile"><span class="token comment"># Use a base image with necessary dependencies (e.g., Debian)</span>
<span class="token keyword">FROM</span> debian<span class="token punctuation">:</span>latest

<span class="token comment"># Install required packages (CUPS, CUPS-PDF)</span>
<span class="token keyword">RUN</span> apt<span class="token punctuation">-</span>get update &amp;&amp; \
    apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>y \
        cups \
        printer<span class="token punctuation">-</span>driver<span class="token punctuation">-</span>cups<span class="token punctuation">-</span>pdf \
        avahi<span class="token punctuation">-</span>daemon avahi<span class="token punctuation">-</span>discover avahi<span class="token punctuation">-</span>utils libnss<span class="token punctuation">-</span>mdns mdns<span class="token punctuation">-</span>scan \
        dbus \
        &amp;&amp; \
    apt<span class="token punctuation">-</span>get clean &amp;&amp; \
    rm <span class="token punctuation">-</span>rf /var/lib/apt/lists/*

<span class="token comment"># Expose the CUPS and Avahi ports</span>
<span class="token keyword">EXPOSE</span> 631 5353/udp

<span class="token comment"># Copy printer configuration script</span>
<span class="token keyword">COPY</span> configure<span class="token punctuation">-</span>printer.sh /usr/local/bin/

<span class="token comment"># Make it executable</span>
<span class="token keyword">RUN</span> chmod +x /usr/local/bin/configure<span class="token punctuation">-</span>printer.sh

<span class="token comment"># Set entry point</span>
<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">"/usr/local/bin/configure-printer.sh"</span><span class="token punctuation">]</span></code></pre></div><p>The <code class="language-text">Dockerfile</code> is very similar to the previous one, but we’ve added the <code class="language-text">avahi-daemon avahi-discover avahi-utils libnss-mdns mdns-scan</code> packages to the <code class="language-text">apt-get install</code> command and we’ve exposed the Avahi port <code class="language-text">5353/udp</code>. We’ve also added the <code class="language-text">dbus</code> package which is required by Avahi.</p><p><code class="language-text">Dbus</code> is a message bus system that allows applications to communicate with each other. It is used by Avahi to communicate with the system bus. It works in most Linux and Unix systems, but it is not available by default on macOS. It is possible to install it on macOS using Homebrew, but it is not necessary for this project.<label for="sd-in-the-event-that" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-in-the-event-that" class="margin-toggle" /><span class="sidenote">In the event that your host <em>is</em> Linux, you can connect the container's <code>dbus</code> to the host's when you run the container. To do this, you need to mount the host's <code>dbus</code> to the container's <code>dbus</code> using the <code>-v</code> flag and connecting the local <code>/var/run/dbus/system_bus_socket</code> (found in <code>/opt/homebrew</code> on a Mac) with <code>system_bus_socket</code> in the container. This will allow the container to communicate with the host's <code>dbus</code> and use Avahi to broadcast services on the local network. I attempted to do this on my Mac but couldn't find the magic incantation to get it to work.</span></p></section>
<section><h2 id="updating-the-code-classlanguage-textconfigure-printershcode-script" style="position:relative;"><a href="#updating-the-code-classlanguage-textconfigure-printershcode-script" aria-label="updating the code classlanguage textconfigure printershcode script permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Updating the <code class="language-text">configure-printer.sh</code> script</h2><p>We also need to update the <code class="language-text">configure-printer.sh</code> script to start the Avahi daemon.</p><p>We’ll need to start the <code class="language-text">dbus-daemon</code>, start the <code class="language-text">avahi-daemon</code> and then broadcast the CUPS-PDF printer as an AirPrint printer. We’ll also include some error checking to make sure they all start properly:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># Stop any service that auto-started</span>
<span class="token function">service</span> cups stop

<span class="token comment"># Start the dbus daemon</span>
dbus-daemon --system --print-address

<span class="token comment"># Start Avahi daemon if it's not running</span>
<span class="token keyword">if</span> <span class="token operator">!</span> pgrep -x <span class="token string">"avahi-daemon"</span> <span class="token operator">></span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Avahi daemon is not running. Starting it..."</span>
    avahi-daemon --no-rlimits <span class="token operator">&amp;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Waiting for Avahi daemon to start..."</span>
    <span class="token function">sleep</span> <span class="token number">5</span>
<span class="token keyword">fi</span>

<span class="token comment"># Check if it really started</span>
<span class="token keyword">if</span> <span class="token operator">!</span> pgrep -x <span class="token string">"avahi-daemon"</span> <span class="token operator">></span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Avahi daemon failed to start"</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment"># Start the CUPS daemon in the background</span>
/usr/sbin/cupsd

<span class="token comment"># Wait for CUPS to start</span>
<span class="token keyword">until</span> lpstat -H<span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Waiting for CUPS to start..."</span>
  <span class="token function">sleep</span> <span class="token number">1</span>
<span class="token keyword">done</span>
<span class="token builtin class-name">echo</span> <span class="token string">"CUPS started"</span>

<span class="token comment"># Share everything</span>
cupsctl --share-printers --remote-any --remote-admin --user-cancel-any <span class="token string">"WebInterface=Yes"</span>

<span class="token comment"># Configure CUPS-PDF</span>
<span class="token function">mkdir</span> -p /var/spool/cups-pdf/CUPS-PDF
<span class="token function">chmod</span> <span class="token number">1777</span> /var/spool/cups-pdf/CUPS-PDF
lpadmin -p CUPS-PDF -E -v cups-pdf:/ -P /usr/share/ppd/cups-pdf/CUPS-PDF_opt.ppd -D <span class="token string">"CUPS-PDF Printer"</span> -L <span class="token string">"PDF Printer"</span>

<span class="token comment"># Register the printer service</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Registering the printer service..."</span>
avahi-publish-service <span class="token string">"DOCKER-CUPS-PDF @ AirPrint"</span> _ipp._tcp <span class="token number">631</span> <span class="token punctuation">\</span>
  <span class="token assign-left variable">pdl</span><span class="token operator">=</span>application/octet-stream,application/pdf,image/jpeg,image/png,image/pwg-raster,image/urf <span class="token punctuation">\</span>
  <span class="token assign-left variable">adminurl</span><span class="token operator">=</span> <span class="token punctuation">\</span>
  <span class="token assign-left variable">rp</span><span class="token operator">=</span>printers/CUPS-PDF <span class="token punctuation">\</span>
  <span class="token assign-left variable">TLS</span><span class="token operator">=</span><span class="token number">1.2</span> <span class="token punctuation">\</span>
  <span class="token assign-left variable">Color</span><span class="token operator">=</span>T <span class="token punctuation">\</span>
  <span class="token assign-left variable">Copies</span><span class="token operator">=</span>T <span class="token operator">&amp;</span>

<span class="token comment"># Keep container running</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Printer configured. Container will keep running."</span>
<span class="token function">tail</span> -f /var/log/cups/error_log</code></pre></div></section>
<section><h2 id="rebuilding-the-docker-image-and-running-the-container" style="position:relative;"><a href="#rebuilding-the-docker-image-and-running-the-container" aria-label="rebuilding the docker image and running the container permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rebuilding the Docker image and running the container</h2><p>Rebuild the Docker image:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ docker build -t cups-pdf <span class="token builtin class-name">.</span></code></pre></div><p>Then run the container:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ docker run -it -p <span class="token number">631</span>:631 -v ~/Documents/CUPS-PDF:/var/spool/cups-pdf/ANONYMOUS cups-pdf
Stopping Common Unix Printing System: cupsd.
unix:path<span class="token operator">=</span>/run/dbus/system_bus_socket,guid<span class="token operator">=</span>0ef70bef46dd361330a2c60e65d24c5f
Avahi daemon is not running. Starting it<span class="token punctuation">..</span>.
Waiting <span class="token keyword">for</span> Avahi daemon to start<span class="token punctuation">..</span>.
Found user <span class="token string">'avahi'</span> <span class="token punctuation">(</span><span class="token environment constant">UID</span> <span class="token number">101</span><span class="token punctuation">)</span> and group <span class="token string">'avahi'</span> <span class="token punctuation">(</span>GID <span class="token number">107</span><span class="token punctuation">)</span>.
Successfully dropped root privileges.
avahi-daemon <span class="token number">0.8</span> starting up.
Successfully called chroot<span class="token punctuation">(</span><span class="token punctuation">)</span>.
Successfully dropped remaining capabilities.
No <span class="token function">service</span> <span class="token function">file</span> found <span class="token keyword">in</span> /etc/avahi/services.
Joining mDNS multicast group on interface eth0.IPv4 with address <span class="token number">172.17</span>.0.2.
New relevant interface eth0.IPv4 <span class="token keyword">for</span> mDNS.
Joining mDNS multicast group on interface lo.IPv4 with address <span class="token number">127.0</span>.0.1.
New relevant interface lo.IPv4 <span class="token keyword">for</span> mDNS.
Network interface enumeration completed.
Registering new address record <span class="token keyword">for</span> <span class="token number">172.17</span>.0.2 on eth0.IPv4.
Registering new address record <span class="token keyword">for</span> <span class="token number">127.0</span>.0.1 on lo.IPv4.
Server startup complete. Host name is c1b0a29d5536.local. Local <span class="token function">service</span> cookie is <span class="token number">719581554</span>.
/run/cups/cups.sock
CUPS started
lpadmin: Printer drivers are deprecated and will stop working <span class="token keyword">in</span> a future version of CUPS.
Registering the printer service<span class="token punctuation">..</span>.
Printer configured. Container will keep running.
E <span class="token punctuation">[</span><span class="token number">18</span>/Feb/2024:18:28:52 +0000<span class="token punctuation">]</span> Unable to <span class="token function">open</span> listen socket <span class="token keyword">for</span> address <span class="token punctuation">[</span>v1.::1<span class="token punctuation">]</span>:631 - Cannot assign requested address.
Established under name <span class="token string">'DOCKER-CUPS-PDF @ AirPrint'</span></code></pre></div><p>It works, but again, this will not join your host network and will not broadcast the printer as an AirPrint printer.</p><h1 id="cleaning-up" style="position:relative;"><a href="#cleaning-up" aria-label="cleaning up permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cleaning up</h1><p>If you’ve made it this far you may want to clean up. Stop any running the containers and <code class="language-text">dns-sd</code> commands. Then remove the containers:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ docker <span class="token function">ps</span> -a
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
c1b0a29d5536   cups-pdf  <span class="token string">"/usr/local/bin/co…"</span>   <span class="token number">2</span> minutes ago   Up <span class="token number">2</span> minutes
❯ docker stop c1b0a29d5536
c1b0a29d5536
❯ docker <span class="token function">rm</span> c1b0a29d5536
c1b0a29d5536</code></pre></div><p>You can also remove the Docker image:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ docker images
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
cups-pdf     latest    100089de8e3c   <span class="token number">2</span> hours ago   <span class="token number">1</span>.03GB
❯ docker rmi 100089de8e3c
Untagged: cups-pdf:latest
Deleted: sha256:100089de8e3c91417db1e27897dda8d21f5ab0499ff20f31bb111e5ae2a014af</code></pre></div><p>Also, if you stopped your local CUPS service, you can restart it:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ <span class="token function">sudo</span> launchctl load /System/Library/LaunchDaemons/org.cups.cupsd.plist</code></pre></div></section></div><hr/><h2>Comments</h2><div class="sc-ifAKCX ddlDEo github"><div><p>Thanks for reading ❤️ – comment by replying to the <a href="https://github.com/jeffrafter/jeffrafter.github.io/issues/65">issue for this post</a>.<!-- --> <!-- -->There’s no comments yet; you could be the first.<br/></p></div><div class="sc-gzVnrw bOnSNx"><a href="https://github.com/jeffrafter/jeffrafter.github.io/issues/65#new_comment_field" target="_blank" rel="noreferrer noopener" class="button btn">Add a comment →</a></div></div><hr/><h2>There’s more to read</h2><div><p><em>Looking for more long-form posts? Here ya go...</em></p></div><ul class="sc-htoDjs gXLbcD"><li><a rel="prev" href="/printers-fake-printers-and-airprint/">← <!-- -->Printers, Fake Printers, and AirPrint</a></li></ul></div></article></main><footer class="sc-bwzfXH aCPwf footer">© <!-- -->2024<!-- -->,<!-- --> <a href="https://jeffrafter.com">jeffrafter.com</a>. Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-61511214-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/docker-and-cups-pdf/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-3b271d6a60df7cd92087.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-6846fb06ec67c7df9104.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-06b4f92e6d6da3e7e748.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-62ade78c2e0e44b33fb5.js"],"component---src-pages-tags-tsx":["/component---src-pages-tags-tsx-85ba1002141d5ed31e60.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-30b85df3d8081f386f13.js"],"component---src-templates-tag-tsx":["/component---src-templates-tag-tsx-1289ad2b8e0e8d66d692.js"]};/*]]>*/</script><script src="/component---src-templates-post-tsx-30b85df3d8081f386f13.js" async=""></script><script src="/commons-52923487d36b93dc329d.js" async=""></script><script src="/app-3b271d6a60df7cd92087.js" async=""></script><script src="/styles-fa79fef4936efa84b233.js" async=""></script><script src="/framework-8dcecaaefd71e2213eb2.js" async=""></script><script src="/webpack-runtime-38c8a4ef93b968ef91ae.js" async=""></script></body></html>