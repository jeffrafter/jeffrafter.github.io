{"componentChunkName":"component---src-templates-post-tsx","path":"/hits-and-damage-in-multiplayer-games-in-unity/","result":{"data":{"site":{"siteMetadata":{"title":"Jeff Rafter"}},"markdownRemark":{"id":"dd5aa932-34b5-5877-8d07-1422da66e463","excerpt":"After getting started with Unity and Virtual Reality, you now have a world. You’ve made it multiplayer with Normcore and are hanging out with your friends. To turn this into a game you need to introduce hits and damage. Preamble: The implementation of damage in this post is not perfect. There are a lot of tradeoffs in multiplayer games where you need to decide if you want to trust the client or the server. This post is a starting point for understanding how to implement hits and damage in Unity. In this post we will trust the client and skip validation on the server (which should be done in a real game). We will also attempt to allow the owner to control their own health (which is a security risk in a real game) and simulate the physics of projectiles. It feels the best and works well for a small group of friends playing together.  Ownership As we’ve mentioned before in Unity Multiplayer VR with Normcore, we need to understand ownership. In Normcore, all shared objects have a  and movable objects have a .Generally these objects have a single owner who is allowed to update their values. All other clients receive updates from the owner and interpolate between them. This is important because we want to allow the owner to control their own health. We’ll create an  model that will be owned by the player and will be responsible for updating their health. This model will be shared with all clients and will be responsible for updating the health of the player. The problem comes about when I try to shoot you. I create a projectile (like a bullet or arrow) and send it to you. I’ll be updating the Realtime Position of the projectile on my client and you’ll be receiving those updates and interpolating any gaps. If my projectile hits you, I am not allowed to update your health. I can only update my own health. So how do we handle this? One option is to allow you to check if the projectile hits you on each frame. Unfortunately this is not very efficient and can lead to a lot of false misses. Suppose for example that I shoot you and the projectile is moving very fast. If you only check once per frame, you might miss the projectile entirely. If you check more frequently, you might hit the projectile multiple times. This is not ideal. Instead we’ll use a  model that will be owned by the player that is hit, but created by the player that is shooting. This model will be responsible for hitting player and updating their health.  Attributes and synchronization  Firing…","html":"<section><figure class=\"fullwidth\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHUXUtpxgn/xAAYEAACAwAAAAAAAAAAAAAAAAAAAQIRIP/aAAgBAQABBQJlRWGf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAQUAAAAAAAAAAAAAAAAAAAERIDGB/9oACAEBAAY/AmLXY//EABsQAAIDAAMAAAAAAAAAAAAAAAABESExEFFh/9oACAEBAAE/IYNSlT0WGqdsN+cPTR//2gAMAwEAAgADAAAAEGMf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAQEBAQEAAAAAAAAAAAAAAREAgSEx/9oACAEBAAE/EApGF9I8dCpBUoncq0WhfmoUXrcbb67/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Oculus Quest with Controllers\"\n        title=\"Oculus Quest with Controllers\"\n        src=\"/static/29432bc29d931b884eea7ab75c8fb59e/eea4a/oculus-quest-2.jpg\"\n        srcset=\"/static/29432bc29d931b884eea7ab75c8fb59e/cb69c/oculus-quest-2.jpg 320w,\n/static/29432bc29d931b884eea7ab75c8fb59e/c08c5/oculus-quest-2.jpg 640w,\n/static/29432bc29d931b884eea7ab75c8fb59e/eea4a/oculus-quest-2.jpg 1280w\"\n        sizes=\"(max-width: 1280px) 100vw, 1280px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></figure><figcaption class=\"fullwidth\">\nImage credit: <a href=\"https://oculus.com\">Oculus Quest</a>\n</figcaption><p>After <a href=\"./getting-started-with-unity-and-vr\">getting started with Unity and Virtual Reality</a>, you now have a world. You’ve made it <a href=\"./unity-multiplayer-vr-with-normcore\">multiplayer with Normcore</a> and are hanging out with your friends. To turn this into a game you need to introduce hits and damage.</p><blockquote>\n<p>Preamble: The implementation of damage in this post is not perfect. There are a lot of tradeoffs in multiplayer games where you need to decide if you want to trust the client or the server. This post is a starting point for understanding how to implement hits and damage in Unity. In this post we will trust the client and skip validation on the server (which should be done in a real game). We will also attempt to allow the owner to control their own health (which is a security risk in a real game) and simulate the physics of projectiles. It feels the best and works well for a small group of friends playing together.</p>\n</blockquote></section>\n<section><h2 id=\"ownership\" style=\"position:relative;\"><a href=\"#ownership\" aria-label=\"ownership permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ownership</h2><p>As we’ve mentioned before in <a href=\"./unity-multiplayer-vr-with-normcore\">Unity Multiplayer VR with Normcore</a>, we need to understand ownership. In Normcore, all shared objects have a <code class=\"language-text\">Realtime View</code> and movable objects have a <code class=\"language-text\">Realtime Transform</code>.Generally these objects have a single owner who is allowed to update their values. All other clients receive updates from the owner and interpolate between them.</p><p>This is important because we want to allow the owner to control their own health. We’ll create an <code class=\"language-text\">AvatarAttributes</code> model that will be owned by the player and will be responsible for updating their health. This model will be shared with all clients and will be responsible for updating the health of the player.</p><p>The problem comes about when I try to shoot you. I create a projectile (like a bullet or arrow) and send it to you. I’ll be updating the Realtime Position of the projectile on my client and you’ll be receiving those updates and interpolating any gaps. If my projectile hits you, I am not allowed to update your health. I can only update my own health. So how do we handle this?</p><p>One option is to allow you to check if the projectile hits you on each frame. Unfortunately this is not very efficient and can lead to a lot of false misses. Suppose for example that I shoot you and the projectile is moving very fast. If you only check once per frame, you might miss the projectile entirely. If you check more frequently, you might hit the projectile multiple times. This is not ideal.</p><p>Instead we’ll use a <code class=\"language-text\">Hit</code> model that will be owned by the player that is hit, but created by the player that is shooting. This model will be responsible for hitting player and updating their health.</p></section>\n<section><h2 id=\"attributes-and-synchronization\" style=\"position:relative;\"><a href=\"#attributes-and-synchronization\" aria-label=\"attributes and synchronization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Attributes and synchronization</h2></section>\n<section><h2 id=\"firing\" style=\"position:relative;\"><a href=\"#firing\" aria-label=\"firing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Firing</h2><h3 id=\"projectiles\" style=\"position:relative;\"><a href=\"#projectiles\" aria-label=\"projectiles permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Projectiles</h3><h4 id=\"physics\" style=\"position:relative;\"><a href=\"#physics\" aria-label=\"physics permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Physics</h4><h3 id=\"hits\" style=\"position:relative;\"><a href=\"#hits\" aria-label=\"hits permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hits</h3><h4 id=\"tracking-impacts\" style=\"position:relative;\"><a href=\"#tracking-impacts\" aria-label=\"tracking impacts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tracking impacts</h4><h4 id=\"damage\" style=\"position:relative;\"><a href=\"#damage\" aria-label=\"damage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Damage</h4></section>\n<section><h2 id=\"shared-game-object\" style=\"position:relative;\"><a href=\"#shared-game-object\" aria-label=\"shared game object permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Shared game object</h2></section>","frontmatter":{"title":"Hits and Damage in Multiplayer Games in Unity","date":"October 04, 2024","tags":["hits","damage","oculus","quest","unity","development","vr","virtual-reality","multiplayer"],"excerpt":"After getting started with Unity and Virtual Reality, you now have a world. You've made it multiplayer with Normcore and are hanging out with your friends. To turn this into a game you need to introduce hits and damage.","comments":"https://github.com/jeffrafter/jeffrafter.github.io/issues/42","image":{"childImageSharp":{"resize":{"src":"/static/29432bc29d931b884eea7ab75c8fb59e/9d169/oculus-quest-2.jpg"}}}}}},"pageContext":{"slug":"/hits-and-damage-in-multiplayer-games-in-unity/","previous":{"fields":{"slug":"/docker-and-cups-pdf/"},"frontmatter":{"tags":["markdown"],"title":"Docker, CUPS-PDF, Avahi and AirPrint"}},"next":null}}}