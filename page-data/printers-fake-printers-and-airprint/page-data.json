{"componentChunkName":"component---src-templates-post-tsx","path":"/printers-fake-printers-and-airprint/","result":{"data":{"site":{"siteMetadata":{"title":"Jeff Rafter"}},"markdownRemark":{"id":"ea431329-47ff-5f74-aa27-9ffc86b8a484","excerpt":"When the economy crashes and the world ends you’ll find us all trading ink cartridges for currency. Until then, you probably want to make amazing prints of your favorite projects and if you are like me you are afraid to spend the ink. When I was working on my PhotoBooth project I found myself iterating on the print design. I’d done the math and figured out that each print on my photo printer would cost me just under $1.00. I was not going to print 1000 copies of my design to get it right. I needed a way to print to a PDF to test my designs. Instead of solving the problem in code (which I show at the end of this post) I found myself solving it in the printer. I had to figure out how to print to a PDF from an iPad. If I could start over, I would solve the problem in code and just render the PDF and send it to a file.  Fake printers are like real printers My real printer connects to my WiFi (after an incredible number of strange key-presses) and has a Bonjour name. I can print to it from my phone, my iPad, and my laptop. I can also print to it from my server. I can print to it from anywhere on my network. Bonjour is Apple’s implementation of Zeroconf or multicast DNS. It’s a way for devices to find each other on a network, including printers, and advertise their services. Now, all I needed was a fake printer I could install onto my Mac. It turns out PDFwriter is exactly that. It’s a printer driver that prints to a PDF. Download the package and install it.  Then run the PDFWriter Utility to create the destination folder for your PDFs. The utility will create a folder in . And then it will create a symlink to that folder at . It will also create a folder  (or  depending on your version). Technically, it will not create these immediately but on first use.    You’re done. You can now print to a PDF from any application on your Mac. Select  as your printer and you will see the PDF show up in the destination folder you created. But we want to be able to print to it from our iPad. Open your Printer Sharing settings and share the PDFwriter printer.  This makes the printer available to other computers on your network, but not on your iPad. It turns out this is exactly what would happen with a real printer. At this point you should restart your computer. This will ensure that the printer is properly shared and that the CUPS configuration is updated. It is possible that you don’t need to do this, but I couldn’t find the magic set of services that needed to be restarted…","html":"<section><figure class=\"fullwidth\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACqklEQVQozwGfAmD9AMDBw83NzM7S1s7S16enq4+Rk4yMkrGxu8rM0rm9wuPo8crP1pecoIiHiUU8LE9JP5aelmpob2xBXV5LVwDGzdG/x83Dy9CzuLtybWmGhoiAhIyOlJCWl5uel52fn6CSlJeGg4Z1bm9vWEFDYoVHbYpyenBYTl1NREsAq66vtbm8wsjMlpmcXFtdg4OMio6KoqqcqZWjgGlwfHp7j4iJcWttdGlhk4V2DiM+BiFFKSgwExISERASAFpZWGJgX3Vva1tXVlNQUTk3NjMxL0xJSlRQTzc3N5KMi3Jra2tlZmVWS0pCQBAPDg0MCQwHBxcNECgZFgBPTlJRUllVVVtVVVpsam1tbGo3NTQgHh8ICAkwMC+HgoFybG1hV1RPPzRCPUgGDRcREhQpKyU/KCZvUTkAg3JMdWdJY1lHWFFLWlVUoKCeqKenramon5uZhYGBiYKAdGpnVEU9ZlNHbmJnKCc7IyUuTUYrcF5CknpPAKSOUZuETI+CZJKLgo+IfpKOiV9dWWdmZ4B8fZeQkYmAfVxPTkU2M29eWGZXTIp6SZB/XYFuUKaRbK6VaAB2eXFQUk9udXNsc3uYlamNgIZpWTZnXEdnXVZ3b2l4bW07Ly9wYFK3qJqyoZOvnlrCskOzpXiwoYiwnoEAh46ccn2KZ29vWkNNhlx7Nyk9Ykwvh25JlHlOknpTVkg+alY8vaiL2Nzk2uHu1tzs0tjV0djY0Njjw8PGAL+qgJKWmnFxgJRrgVI8WzstLKmUg8CpjbWZbpF3VF9LPaWPa8u2lqybgbWwqdzm9MDFzoV3Zox+anxwZQDHrWq9q4F+fYl0bnMpHS2CbV7Qu6Xaw6jp07iTfXWUfW3Qu5zFr5G9p4bCvLPT2ubDxsyWgFuSdEKKd1wWeDXfUfcRPAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Printer with continuous ink system\"\n        title=\"Printer with continuous ink system\"\n        src=\"/static/db80922f2b85f50bf0a0e9765e17c077/5a190/printers-continuous-ink.png\"\n        srcset=\"/static/db80922f2b85f50bf0a0e9765e17c077/72799/printers-continuous-ink.png 320w,\n/static/db80922f2b85f50bf0a0e9765e17c077/6af66/printers-continuous-ink.png 640w,\n/static/db80922f2b85f50bf0a0e9765e17c077/5a190/printers-continuous-ink.png 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></figure><figcaption class=\"fullwidth\">\nImage credit: <a href=\"https://hackaday.com/2019/12/06/inkjet-printing-on-the-cheap-with-a-continuous-ink-system/\">INKJET PRINTING ON THE CHEAP WITH A CONTINUOUS INK SYSTEM</a>\n</figcaption><p>When the economy crashes and the world ends you’ll find us all trading ink cartridges for currency. Until then, you probably want to make amazing prints of your favorite projects and if you are like me you are afraid to spend the ink.</p><p>When I was working on my PhotoBooth project I found myself iterating on the print design. I’d done the math and figured out that each print on my photo printer would cost me just under $1.00. I was not going to print 1000 copies of my design to get it right. I needed a way to print to a PDF to test my designs.</p><p>Instead of solving the problem in code (which I show at the end of this post) I found myself solving it in the printer. I had to figure out how to print to a PDF from an iPad. If I could start over, I would solve the problem in code and just render the PDF and send it to a file.</p></section>\n<section><h2 id=\"fake-printers-are-like-real-printers\" style=\"position:relative;\"><a href=\"#fake-printers-are-like-real-printers\" aria-label=\"fake printers are like real printers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fake printers are like real printers</h2><p>My real printer connects to my WiFi (after an incredible number of strange key-presses) and has a Bonjour name. I can print to it from my phone, my iPad, and my laptop. I can also print to it from my server. I can print to it from anywhere on my network.</p><p><a href=\"https://developer.apple.com/bonjour/\">Bonjour</a> is Apple’s implementation of Zeroconf or multicast DNS. It’s a way for devices to find each other on a network, including printers, and advertise their services.</p><p>Now, all I needed was a fake printer I could install onto my Mac. It turns out <a href=\"https://github.com/rodyager/RWTS-PDFwriter\">PDFwriter</a> is exactly that. It’s a printer driver that prints to a PDF.</p><p><a href=\"https://github.com/rodyager/RWTS-PDFwriter/releases/download/v3.1/RWTS-PDFwriter.pkg\">Download</a> the package and install it.</p><p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 471px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9930e6ae74d5426969d1350035f46c22/1f09d/printers-PDFwriter.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 103.75000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAADDUlEQVQ4y41U6VITQRDeZ7BKDdl7djf3ZklCEhIMNwlJFrCwYiDkAP9ZpQ9m+Ug+gVhqeRaCTNs9m11EAvjjq970ZL7p/vqQGNPeyfFHp7L8+FTX5Q+aFv9oGMonxvTPlqV/QXxFfJ/iB+LnFGeIX/i/c+S4sJh+ifa9pKpzMDg8gOHwEGq1MmxtrsFitQy2ZdwN2wTnGhgwU+OSosQuTyYTfvJizDNeglfKJb5Qmueum+H4KsfLN4F+XY1zVY5xVYkJa2gyZ6bKJds2wNAV0DWZXhBAotsjwzPm2LDm78NOfwjd3kDYFX+fm+iXUAcwDRVMU40uWQL6DEwJbQsa7V3oPj+Crac9aO33eb3pg2kzLqGQUCzkoVT0gKJ1bmgzC0FWqjIH2UwS5r0c9/IZECnTy4V5V5BSuvcWQ+CKnAKpLZahUi4CBSdRGl4+B41GnV66l5T0pehCUJSKHAMsCsqmBRqmUw7k3QykkjZe0u8kSzhMRIPdAOWFwFarC1DADCNCKgg2c1ThWSBCOs9lUzAaHQkMDvswRns8GUK7tSmKKwgpslRqCvxOJq3AN/1OJqyrgjhm1F6kGRYCTGZCxvXwNxKSk0RdWV6CpXpVaEmWpoUs+ek8TFlT439BBk1+CIrtwfqz15Cwpyn/T2VD/ZpbG9BptwTa203odrYRLb78pEbS8aixb6tu+GBISAQ7fgf8bht8vy2+93Z9WF1tcKEhpexhu+Ry6aCxnUAr+x8EPkOkSg+Q3smp9niHk85iOVAE1JxUPZpneuXOWUa4+DjdoYEgWyx6nHwRIW4XFL4iilCvVYJo8KJjmbfqGVVatJrB824Wq6xfipSpsSnCrEAyWARsxnJgs/04DJgyo6L8JkKOOxEQoQXc3AK4va+BfDQA4Xn4W9MVrtEoGsqFRI170O/x0XAgOn8yHuLWXodN3NzHkxGMx0eRv9XcANrwRGJgqrryAMzKHtReveWVl2/ALHXOSMPzXC4FrpvmVGnc1JBOO6J6NN/oh8iP0oRRBZEiuZMCq7DKEfT97Q+rGW1FY4AFzwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PDFWriter Printer\"\n        title=\"PDFWriter Printer\"\n        src=\"/static/9930e6ae74d5426969d1350035f46c22/1f09d/printers-PDFwriter.png\"\n        srcset=\"/static/9930e6ae74d5426969d1350035f46c22/72799/printers-PDFwriter.png 320w,\n/static/9930e6ae74d5426969d1350035f46c22/1f09d/printers-PDFwriter.png 471w\"\n        sizes=\"(max-width: 471px) 100vw, 471px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p><p>Then run the PDFWriter Utility to create the destination folder for your PDFs. The utility will create a folder in <code class=\"language-text\">/private/var/spool/pdfwriter/[username]</code>. And then it will create a symlink to that folder at <code class=\"language-text\">~/Documents/PDFWriter</code>. It will also create a folder <code class=\"language-text\">/private/var/spool/pdfwriter/anonaymous</code> (or <code class=\"language-text\">anonymous</code> depending on your version). Technically, it will not create these immediately but on first use.  <label for=\"sd-if-you-get-an-error\" class=\"margin-toggle sidenote-number\"></label><input type=\"checkbox\" id=\"sd-if-you-get-an-error\" class=\"margin-toggle\" /><span class=\"sidenote\">If you get an error creating the destination folder because it already exists you can probably safely ignore it. If you are a purist you can delete the folders and symlinks and try again.</span></p><p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1012px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/17ae45a6397be1e00f33a569083a63bb/ad997/printers-Utility.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABsklEQVQoz6WR7UrCcBTGh33RNEkyKs2X6d6c08ptGlTmHH4dSHUVZXQdgZCXkgpdRfWlK4iyPgRdQGunc9ZWU4iCBj92dp7nPP8/O4zB8HOWqbXrTbWrqaql6QG0mtVo1K1Ox7RM07Dqdd3tTXtUS9dxVqu1k8mlOWY1nFhubMnPW6oCVaUM1co0G1UFthu6C9WzOrG5UQFFLk0SicU0Mx+bT/FccSKLApRE3kacILIkONn0mpNB5BnNw0YPiHzxIb6wwDKxaDQlCdykXBIBhXcK8MGew+azTu/k2Dk77TlFNuf2gh7EplnMoMC8H/hETTyNAukN9M0XC2DsbMPV8BKGozF0TAM4NgeeFzzv+6+BPgJXgFZzFy4GAzjv96FttLDHQtDz50D/Bm2jCYcHXTg67ILRak7d7sdAUeAePfHNWwz9aFviOVurbdp4S9vY37NVrHHQ1XwfzbhLEbj7z8BYNC0J/GulXHJPV2RC+nqTGUNcqP7WPqEZmkX9JR7HLYfD4SU2lx0X8tk73OgNchukkM/d4nZdqJ7VkWvs32HGKBKJrDD4hJAkkkHW/wFlhD4Ajz8JQeA3zuoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PDFWriter Utility\"\n        title=\"PDFWriter Utility\"\n        src=\"/static/17ae45a6397be1e00f33a569083a63bb/ad997/printers-Utility.png\"\n        srcset=\"/static/17ae45a6397be1e00f33a569083a63bb/72799/printers-Utility.png 320w,\n/static/17ae45a6397be1e00f33a569083a63bb/6af66/printers-Utility.png 640w,\n/static/17ae45a6397be1e00f33a569083a63bb/ad997/printers-Utility.png 1012w\"\n        sizes=\"(max-width: 1012px) 100vw, 1012px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p><p>You’re done. You can now print to a PDF from any application on your Mac. Select <code class=\"language-text\">PDFwriter</code> as your printer and you will see the PDF show up in the destination folder you created. But we want to be able to print to it from our iPad.</p><p>Open your Printer Sharing settings and share the PDFwriter printer.</p><p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 575px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1c1b7415a9e316afdd75dd5d293394f1/59415/printers-sharing.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.5625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACLklEQVQ4y22Ty1ITQRSG5yUQkrlPT899EgIVQS1IBkhMAklUSliYwsdw4U72voTPZpUrhGzcWP17TpPEiFl89Z9bn+nLGUMEzncpvIdI+vdxFMwZsucUmwe+Paf8XPjOA9kPC71f8JMRvn0nQnGXZPkd1f4wskTi9sst+mcn6B6/QtU90treb4FzWRohT2MUeaL9IovJj7QWeQrpbiN6eYXrz9+QZSEM2o06PGir3Uaunrf31AHRKDNV5omiRSuoidZlnJWJQl9JKVSaJioMHGX4nkWGBW5s1p/BtnbAapnbGseqwXPqnNdxs7al42zXydZrtL8Fl+qMvMgxfX+D2YcrDF6f4aQ6xunJsdbeWYVmI9P68WaG0bCPfq+i3BHVdLQ/GvZ0La8tiwRGUZY4HV5icjHA+GKoCzVVh+61wl6r1A3fTseYjs8xGjw26J12MRmPaN3osfmgj2aZwRCBDd/egWPX4RK+a63wHBP0sjrOR2eWNZxztV+DTzb7dH0wQuFBhj6iBZL9p4TeKr9es+6z0thwQ1dxIAxcehwX68iA4sLVu3ya2wTXGYuvqY07E48Nl3OX65ncAM9kluiT0h06is/uuaYisML5ayexQBqHSCKxkTgwVRzUaIemMuh+fmepRGu3UK1mAabZyNknSt2M5+ufj63hEmGrA9keKF/S2KSJ/PXisM3Pr95MLjCdnOvxYL18NwX9OTQBNf2C/8MNLeTjT2p/9hVB40j9Ac1Vg/75hwgDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PDFWriter Printer Sharing\"\n        title=\"PDFWriter Printer Sharing\"\n        src=\"/static/1c1b7415a9e316afdd75dd5d293394f1/59415/printers-sharing.png\"\n        srcset=\"/static/1c1b7415a9e316afdd75dd5d293394f1/72799/printers-sharing.png 320w,\n/static/1c1b7415a9e316afdd75dd5d293394f1/59415/printers-sharing.png 575w\"\n        sizes=\"(max-width: 575px) 100vw, 575px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p><p>This makes the printer available to other computers on your network, but not on your iPad. It turns out this is exactly what would happen with a real printer.</p><blockquote>\n<p>At this point you should restart your computer. This will ensure that the printer is properly shared and that the CUPS configuration is updated. It is possible that you don’t need to do this, but I couldn’t find the magic set of services that needed to be restarted to see all of the changes.</p>\n</blockquote><p>In order to share the printer to your iPad you need to enable AirPrint.</p><p>Luckily there is an application called <code class=\"language-text\">dns-sd</code> that can advertise a printer as an AirPrint printer. Open a terminal and run the following command:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dns-sd -R <span class=\"token string\">\"PDFwriter @ AirPrint\"</span> _ipp._tcp,_universal <span class=\"token builtin class-name\">.</span> <span class=\"token number\">631</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token assign-left variable\">pdl</span><span class=\"token operator\">=</span>application/octet-stream,application/pdf,image/jpeg,image/png,image/pwg-raster,image/urf <span class=\"token punctuation\">\\</span>\n  <span class=\"token assign-left variable\">adminurl</span><span class=\"token operator\">=</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token assign-left variable\">rp</span><span class=\"token operator\">=</span>printers/PDFwriter <span class=\"token punctuation\">\\</span>\n  <span class=\"token assign-left variable\">TLS</span><span class=\"token operator\">=</span><span class=\"token number\">1.2</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token assign-left variable\">Color</span><span class=\"token operator\">=</span>T <span class=\"token punctuation\">\\</span>\n  <span class=\"token assign-left variable\">Copies</span><span class=\"token operator\">=</span>T</code></pre></div><p>This command will advertise the PDFwriter printer as an AirPrint printer. It will start a daemon and continue to run (until you stop it with <code class=\"language-text\">Ctrl+C</code>). You should see:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Registering Service PDFwriter @ AirPrint._ipp._tcp,_universal port <span class=\"token number\">631</span> TXT <span class=\"token assign-left variable\">pdl</span><span class=\"token operator\">=</span>application/octet-stream,application/pdf,image/jpeg,image/png,image/pwg-raster,image/urf <span class=\"token assign-left variable\">adminurl</span><span class=\"token operator\">=</span> <span class=\"token assign-left variable\">rp</span><span class=\"token operator\">=</span>printers/PDFwriter <span class=\"token assign-left variable\">TLS</span><span class=\"token operator\">=</span><span class=\"token number\">1.2</span> <span class=\"token assign-left variable\">Color</span><span class=\"token operator\">=</span>T <span class=\"token assign-left variable\">Copies</span><span class=\"token operator\">=</span>T\nDATE: ---Sat <span class=\"token number\">17</span> Feb <span class=\"token number\">2024</span>---\n<span class=\"token number\">11</span>:22:40.253  <span class=\"token punctuation\">..</span>.STARTING<span class=\"token punctuation\">..</span>.\n<span class=\"token number\">11</span>:22:40.899  Got a reply <span class=\"token keyword\">for</span> <span class=\"token function\">service</span> PDFwriter @ AirPrint._ipp._tcp.local.: Name now registered and active</code></pre></div><p>At this point, if you were to try to print to this printer from another computer on your network, you could select it and install the driver but you would end up seeing an error message:</p><p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 262px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2097f3fe1bf81bb0eefb4f1f0da7236/8ff13/printers-unable-to-communicate.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.31297709923663%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAADNklEQVQ4y3VUSU9TURTmN6h0eJ2hlpa20Pa1TC0zlJkCQqFM4i8wRE3YIIoLY+LCuDZxYaIkBt1oDNHEmLgxcWvEhUZIjNEw12hMePfznNvXQkAWX96953znO9PNKypx2V85HdYsYcPltO0Qdgl7hCz52J5VLOasopj2HHbrLtl2dR5jW8cm8f6Q722Rw27ZoQsOg2zya7Wa4S6xI6EGUR+rgMftgo1sJ/Hp+72IDj91h0YQedjtFkFi4vGTp+L2my9iceWTeLHyUvjKSgWJisNcwr6uscaCm/pF5DNSCzCbjYirAdxa+YzkchaZmyu48/obamMh8hngJM6hKjX9u36yoGJCbaQcc48+YPjuR8RvrGL++Q/URAJQKJnTcbLgVl4wPwuG3WaBu9SBe/cfYHFpFXMPv2Jp+Rl8nhKao3J0fscFqSq9QluhShb1nHUhFvajKuSD1+OSNvYdgebKC9Jli7MoZoOwWkzIg7dptRhle0bjGUKxPLM95zPBorCf7QZNr3S9yG5TtrxlbowMD4m21mZ0dbYj2d6Khvo69HR3yjN/JXo6MTE+hpaWRnR2tCM9cg4DqT4MDvRr5T4PVa/kWqYHCTUSEpFwBaYmx5EZS8vvaHoY45lRTE5kZPD01ATGRkeQTtN5elLaamtiiKohzV3q5HketGwoPiW4hZbmBiJVIV5XjeoqFYl4LZoaE/Le2JBAfaKOqo/Lc1UswnGMg5bzFcbraqjlJhmoRirB1bKwqoYQqgzKSior/MwjIZWSRamyMNrbmllc4+XIClmQL0QWTIxGwwiHgnQPyMpS/b1IpXppTn1yXjXVOWEaEbeaSx6plIKFLfPWzKZiYaJtMmhrMBpOo7TEiYDfKwX85V6qNCDfHXOIL6HHaLSQnCARtpgci4aFzBoJFbJz2xXBcikaDPgkuKICR/9SrMY+2TIpb/CTuDAzrdE2BW23AHoiYnb2orh+bUEsXJ0XVy5fErR1QdsucDhm5vzU/gCNhQTXWPAXb7K3p4veYBLdXR0F8J3nxs+Hn8jQYOoYp7srKWObaOvy90Ubfk+H39T/NmHnKCjhDs1Ygs//43Asafylfbz7B1qINKb1cHaKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PDFWriter Printer Error\"\n        title=\"PDFWriter Printer Error\"\n        src=\"/static/d2097f3fe1bf81bb0eefb4f1f0da7236/8ff13/printers-unable-to-communicate.png\"\n        srcset=\"/static/d2097f3fe1bf81bb0eefb4f1f0da7236/8ff13/printers-unable-to-communicate.png 262w\"\n        sizes=\"(max-width: 262px) 100vw, 262px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p><p>In order for us to properly share this printer we need to update the CUPS configuration.</p></section>\n<section><h2 id=\"cups\" style=\"position:relative;\"><a href=\"#cups\" aria-label=\"cups permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CUPS</h2><p>CUPS is the <a href=\"https://www.cups.org\">Common Unix Printing System</a> and is the system that manages printers on your Mac. In fact, it is probably the system that manages printers on your Linux machine as well. It is also the default printing system for Windows Subsystem for Linux (WSL) and is used by Docker for Mac. <label for=\"sd-it-has-a-long-and\" class=\"margin-toggle sidenote-number\"></label><input type=\"checkbox\" id=\"sd-it-has-a-long-and\" class=\"margin-toggle\" /><span class=\"sidenote\">It has a long and interesting history: it was created in 1997, by Michael Sweet and open sourced (as GPL) in 1999 and was subsequently bought by Apple in 2007. It continues to be owned by Apple and is open source. However, as of 2018 Apple indicated that they would begin deprecating it in MacOS and subsequently the version that ships has fallen behind. The most current versions fall under the <a href=\"https://openprinting.github.io/\">OpenPrinting</a> project.</span></p><p>Some helpful links:</p><ul>\n<li><a href=\"https://www.cups.org\">CUPS Documentation</a></li>\n<li><a href=\"https://opensource.apple.com/source/cups\">CUPS Apple Open Source</a> (v494.1 at the time of this writing)</li>\n<li><a href=\"https://github.com/apple/cups\">CUPS GitHub Repository</a></li>\n<li><a href=\"https://openprinting.github.io/\">OpenPrinting</a></li>\n</ul><p>The configuration file for CUPS is located on your computer at <code class=\"language-text\">/etc/cups/cupsd.conf</code> (the default non-modified version is <code class=\"language-text\">/etc/cups/cupsd.conf.default</code> as a backup in case you or some process has made changes). We’ll need to share our printer and make some changes to this file in order to print using AirPrint. In a terminal, run the following:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">lpadmin -p PDFwriter -o printer-is-shared<span class=\"token operator\">=</span>true -o <span class=\"token assign-left variable\">cupsIPPSupplies</span><span class=\"token operator\">=</span>false -o <span class=\"token assign-left variable\">cupsSNMPSupplies</span><span class=\"token operator\">=</span>false -u allow:all -E</code></pre></div><h3 id=\"changing-your-cups-configuration\" style=\"position:relative;\"><a href=\"#changing-your-cups-configuration\" aria-label=\"changing your cups configuration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Changing your CUPS configuration</h3><blockquote>\n<p>Note: if you are running this on a MacOS older than High Sierra you may not need this.</p>\n</blockquote><p>The default configuration for CUPS is set to only listen for connections from the local machine on the local interfaces. This is a security feature. But there are cases where you want to relax this security feature. For example, if you want to share a printer on your network or if you want to enable the web interface for CUPS, like we do.</p><p>CUPS relies on the <code class=\"language-text\">ipp</code> protocol (Internet Printing Protocol) which is a simple protocol that is based on HTTP. It is a RESTful protocol that uses the POST method to send print jobs and the GET method to get information about printers. We’ll want to allow other machines on our network to access our printer using this protocol.</p><p>Edit the file <code class=\"language-text\">/etc/cups/cupsd.conf</code>. Change:</p><div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\"># Only listen for connections from the local machine.\nListen localhost:631\nListen /private/var/run/cupsd</code></pre></div><p>to:</p><div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\"># Listen to connections from any interface.\nPort 631\nListen /private/var/run/cupsd\nServerAlias *</code></pre></div><p>This changes the configuration to listen to port 631 on all interfaces (including your ipv4 and ipv6 network interfaces). It also sets the server alias to <code class=\"language-text\">*</code> which is a wildcard for any hostname. Technically this is less secure than you need. If you know your server’s hostname you can set it to that instead.</p><p>It is not required, but can be helpful to enabled the web interface. Change:</p><div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\"># Web interface setting...\nWebInterface No\n\n# Restrict access to the server...\n&lt;Location /&gt;\n  Order allow,deny\n&lt;/Location&gt;</code></pre></div><p>to:</p><div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\"># Web interface setting...\nWebInterface Yes\n\n# Restrict access to the server...\n&lt;Location /&gt;\n  Order allow,deny\n  Allow All\n&lt;/Location&gt;</code></pre></div><p>This will enable the web interface and allow access to it (only the root page, you’ll need to change the <code class=\"language-text\">Location</code> permissions for other paths) from any computer on your network.</p><p>Finally, restart the CUPS service:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> launchctl stop org.cups.cupsd\n<span class=\"token function\">sudo</span> launchctl start org.cups.cupsd</code></pre></div><p>Stopping and starting the service appears fast when you run these commands. But it takes a while (sometimes one to two minutes) for the service to actually stop and start.</p><p>You might be thinking: “hey I can just use <a href=\"https://www.cups.org/doc/man-cupsctl.html\"><code class=\"language-text\">cupsctl</code></a> to change the configuration”. You can, but it doesn’t allow you to change the <code class=\"language-text\">Listen</code> directive directly. Also, it reformats and removes all comments from the file. Because of this, I edit the file directly. If you want to use <code class=\"language-text\">cupsctl</code>, you would run the following:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Only run this if you are sure</span>\n<span class=\"token function\">sudo</span> cupsctl --share-printers --remote-any --remote-admin <span class=\"token string\">\"WebInterface=Yes\"</span></code></pre></div><p>At this point you should be able to go to <a href=\"http://localhost:631\">http://localhost:631</a> (or <a href=\"http://computername.local:631\">http://computername.local:631</a>) and see the CUPS web interface. You should be able to see the PDFwriter printer and you should be able to print to it from any computer or iOS device on your network.</p><p>If you are still getting an error (or if it appears to print but you do not see a file) you will need to look at the CUPS logs:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">tail</span> -f /var/log/cups/error_log</code></pre></div><p>The <code class=\"language-text\">-E</code> flag on our <code class=\"language-text\">lpadmin</code> command should have set the printer to allow all users. If you are still getting an error you can try to adjust the permissions in the CUPS configuration file.</p><h3 id=\"canceling-jobs\" style=\"position:relative;\"><a href=\"#canceling-jobs\" aria-label=\"canceling jobs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Canceling jobs</h3><p>After printing I noticed that the Print Center was full of jobs. You might think you could change the permissions of CUPS to allow you to cancel these jobs (see the <code class=\"language-text\">Cancel-Job</code> directive in the <code class=\"language-text\">cupsd.conf</code> file) or you could use the <code class=\"language-text\">cupsctl</code> command to allow you to cancel jobs (see <code class=\"language-text\">cupsctl --user-cancel-any</code>). But you would be wrong. If you did this you would see the following error in your local CUPS error log:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">E <span class=\"token punctuation\">[</span><span class=\"token number\">18</span>/Feb/2024:07:52:19 -0500<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Client <span class=\"token number\">4</span><span class=\"token punctuation\">]</span> Returning IPP client-error-not-possible <span class=\"token keyword\">for</span> Cancel-Job <span class=\"token punctuation\">(</span>ipp://localhost:631/jobs/47<span class=\"token punctuation\">)</span> from localhost.</code></pre></div><p>Unfortunately, CUPS doesn’t know anything about these jobs. They are job remnants. If you look in the CUPS web interface you will see that the jobs are not there. In order to remove these jobs you will need to use the <code class=\"language-text\">cancel</code> command:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">cancel -a -x</code></pre></div><p>This removes all jobs (<code class=\"language-text\">-a</code>) and forces the removal of the jobs (<code class=\"language-text\">-x</code>). You can also remove a specific job by running <code class=\"language-text\">cancel [job-id]</code>.</p></section>\n<section><h2 id=\"printing-to-an-airprint-printer-from-your-localhost\" style=\"position:relative;\"><a href=\"#printing-to-an-airprint-printer-from-your-localhost\" aria-label=\"printing to an airprint printer from your localhost permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Printing to an AirPrint printer from your localhost</h2><p>You may have noticed that I said you should be able to print to it from any computer or iOS device on your network. If you tried to print from your local computer to the AirPrint computer, you would find that it doesn’t work. This is because the CUPS restricts printing to the localhost from the localhost. If you attempt to print to the AirPrint printer from your local computer you will see the following error in your local CUPS error log:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">E <span class=\"token punctuation\">[</span><span class=\"token number\">18</span>/Feb/2024:08:51:49 -0500<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Client <span class=\"token number\">18</span><span class=\"token punctuation\">]</span> Request from <span class=\"token string\">\"localhost\"</span> using invalid Host: field \"computername.local:63</code></pre></div><p>This is completely intentional and is a security feature. In the <a href=\"https://github.com/apple/cups/blob/a8968fc4257322b1e4e191c4bccedea98d7b053e/scheduler/client.c#L3579C1-L3590C4\">CUPS code</a> you can see that it checks to see if the request is coming from the localhost and if it is it checks to see if the Host header is the same as the server name. If it is not it returns an error:</p><div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">httpAddrLocalhost</span><span class=\"token punctuation\">(</span><span class=\"token function\">httpGetAddress</span><span class=\"token punctuation\">(</span>con<span class=\"token operator\">-></span>http<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n <span class=\"token comment\">/*\n  * Only allow \"localhost\" or the equivalent IPv4 or IPv6 numerical\n  * addresses when accessing CUPS via the loopback interface...\n  */</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">_cups_strcasecmp</span><span class=\"token punctuation\">(</span>con<span class=\"token operator\">-></span>clientname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n          <span class=\"token operator\">!</span><span class=\"token function\">_cups_strcasecmp</span><span class=\"token punctuation\">(</span>con<span class=\"token operator\">-></span>clientname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"localhost.\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n          <span class=\"token operator\">!</span><span class=\"token function\">strcmp</span><span class=\"token punctuation\">(</span>con<span class=\"token operator\">-></span>clientname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n          <span class=\"token operator\">!</span><span class=\"token function\">strcmp</span><span class=\"token punctuation\">(</span>con<span class=\"token operator\">-></span>clientname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"[::1]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div><p>This code was added in 2009 <a href=\"https://github.com/apple/cups/issues/3118\">https://github.com/apple/cups/issues/3118</a>. The goal was to prevent a DNS rebinding attack. This is a type of attack where a malicious website could use a DNS rebinding attack to access the CUPS web interface and print to your printer. Unfortunately, it also prevents you from printing to your AirPrint printer from your local computer (we are explicitly using <code class=\"language-text\">dns-sd</code> to rebind our localhost).There is no way to disable this feature.</p><p>The worst part is this applies to any local loopback interface. For example, if you are attempting to print from the iOS simulator you will also see this error. Printing from an actual iOS device will work because it will not use the loopback interface.</p><h1 id=\"troubleshooting\" style=\"position:relative;\"><a href=\"#troubleshooting\" aria-label=\"troubleshooting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Troubleshooting</h1><ul>\n<li>You may have noticed that the casing of <code class=\"language-text\">PDFwriter</code> (or <code class=\"language-text\">PDFWriter</code>) is inconsistent. If you are having trouble printing to the printer you may want to check the case of the printer name in the CUPS web interface and in the <code class=\"language-text\">dns-sd</code> command.</li>\n<li>If you are attempting to print using an older application you might run into issues with PostScript. In older versions of MacOS (before MacOS Sonoma) the operating system would natively accept PostScript and convert it to PDF. This is no longer the case and any PostScript jobs result in an error. If you are having trouble printing from an older application you might want to try to print to a PostScript file and then convert it to PDF using <code class=\"language-text\">ps2pdf</code>. PDFWriter relied on this behavior and because of this no longer supports PostScript. For more information see <a href=\"https://github.com/rodyager/RWTS-PDFwriter/issues/42\">https://github.com/rodyager/RWTS-PDFwriter/issues/42</a>.</li>\n</ul></section>","frontmatter":{"title":"Printers, Fake Printers, and AirPrint","date":"February 16, 2024","tags":["markdown"],"excerpt":"When the economy crashes and the world ends you'll find us all trading ink cartridges for currency.","comments":"https://github.com/jeffrafter/jeffrafter.github.io/issues/64","image":{"childImageSharp":{"resize":{"src":"/static/db80922f2b85f50bf0a0e9765e17c077/10e03/printers-continuous-ink.png"}}}}}},"pageContext":{"slug":"/printers-fake-printers-and-airprint/","previous":{"fields":{"slug":"/unity-multiplayer-vr-with-normcore/"},"frontmatter":{"tags":["oculus","quest","unity","development","vr","virtual-reality","multiplayer"],"title":"Unity Multiplayer Virtual Reality with Normcore"}},"next":{"fields":{"slug":"/docker-and-cups-pdf/"},"frontmatter":{"tags":["markdown"],"title":"Docker, CUPS-PDF, Avahi and AirPrint"}}}}}