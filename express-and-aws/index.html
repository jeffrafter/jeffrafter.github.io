<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.fe2e00c9a4afacb9f2e1.css">html{box-sizing:border-box;margin:0;padding:0}*,:after,:before{box-sizing:inherit}body{margin:0!important;padding:0}a.anchor,a.anchor:hover,a.anchor:link{background:none!important}figure a.gatsby-resp-image-link{background:none}figure span.gatsby-resp-image-wrapper{max-width:100%!important}article .excerpt{display:none}.btn,.button{display:inline-block;background:none!important;border-radius:40px;line-height:40px;min-height:40px;min-width:80px;padding:0 12px;text-align:center;text-decoration:none;border:1px solid #666;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}@font-face{font-family:et-book;src:url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.eot);src:url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.woff) format("woff"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.ttf) format("truetype"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.svg#etbookromanosf) format("svg");font-weight:400;font-style:normal}@font-face{font-family:et-book;src:url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.eot);src:url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.woff) format("woff"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.ttf) format("truetype"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.svg#etbookromanosf) format("svg");font-weight:400;font-style:italic}@font-face{font-family:et-book;src:url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.eot);src:url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.woff) format("woff"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.ttf) format("truetype"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.svg#etbookromanosf) format("svg");font-weight:700;font-style:normal}@font-face{font-family:et-book-roman-old-style;src:url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.eot);src:url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.woff) format("woff"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.ttf) format("truetype"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.svg#etbookromanosf) format("svg");font-weight:400;font-style:normal}html{font-size:15px}body{width:87.5%;margin-left:auto;margin-right:auto;padding-left:12.5%;font-family:et-book,Palatino,Palatino Linotype,Palatino LT STD,Book Antiqua,Georgia,serif;background-color:#fffff8;color:#111;max-width:1400px;counter-reset:sidenote-counter}h1{font-weight:400;margin-top:4rem;margin-bottom:1.5rem;font-size:3.2rem;line-height:1}h2{margin-top:2.1rem;font-size:2.2rem}h2,h3{font-style:italic;font-weight:400;margin-bottom:1.4rem;line-height:1}h3{font-size:1.7rem;margin-top:2rem}hr{display:block;height:1px;width:55%;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}p.subtitle{font-style:italic;margin-top:1rem;margin-bottom:1rem;font-size:1.8rem;display:block;line-height:1}.numeral{font-family:et-book-roman-old-style}.danger{color:red}article{position:relative;padding:1rem 0}section{padding-top:1rem;padding-bottom:1rem}ol,p,ul{font-size:1.4rem;line-height:2rem}p{margin-top:1.4rem;margin-bottom:1.4rem;padding-right:0;vertical-align:baseline}div.epigraph{margin:5em 0}div.epigraph>blockquote{margin-top:3em;margin-bottom:3em}div.epigraph>blockquote,div.epigraph>blockquote>p{font-style:italic}div.epigraph>blockquote>footer{font-style:normal}div.epigraph>blockquote>footer>cite{font-style:italic}blockquote{font-size:1.4rem}blockquote p{width:55%;margin-right:40px;font-style:italic;color:#999}blockquote footer{width:55%;font-size:1.1rem;text-align:right}section>footer,section>p,section>table{width:55%;clear:left}section>ol,section>ul{width:55%;-webkit-padding-start:5%}li:not(:first-child){margin-top:.25rem}figure{padding:0;border:0;font-size:100%;font:inherit;max-width:55%;-webkit-margin-start:0;-webkit-margin-end:0;-webkit-margin-before:0;margin-block-start:0;-webkit-margin-after:0;margin-block-end:0;margin:0 0 3em}figcaption,figure{vertical-align:baseline}figcaption{margin-top:-2em;margin-bottom:0;font-size:1.1rem;font-style:italic;line-height:1.6;position:relative;max-width:40%}figure.fullwidth figcaption{max-width:80%}a:link,a:visited{color:inherit}a:link{text-decoration:none;border-bottom:1px solid #000;padding-bottom:.05em;margin-bottom:.05em;word-break:break-word}a.anchor:link,nav.navigation a{border-bottom:0;padding-bottom:0;margin-bottom:0}@media screen and (-webkit-min-device-pixel-ratio:0){a:link{background-position-y:101%,101%,101%}}img{max-width:100%}.sidenote{margin-bottom:2em!important}.marginnote,.sidenote{float:right;clear:right;width:45%;margin:0 -75% 0 5%;font-size:1.1rem;line-height:1.3;vertical-align:baseline;position:relative}.sidenote-number{counter-increment:sidenote-counter}.sidenote-number:after,.sidenote:before{font-family:et-book-roman-old-style;position:relative;vertical-align:baseline}.sidenote-number:after{content:counter(sidenote-counter);font-size:1rem;top:-.5rem;left:.1rem}.sidenote:before{content:counter(sidenote-counter) " ";font-size:1rem;top:-.5rem}blockquote .marginnote,blockquote .sidenote{margin-right:-82%;min-width:59%;text-align:left}div.fullwidth,table.fullwidth{width:100%}div.table-wrapper{overflow-x:auto}.sans,div.table-wrapper{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}.sans{letter-spacing:.03em}code{font-family:Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:1rem;line-height:1.42}.sans>code{font-size:1.2rem}h1>code,h2>code,h3>code{font-size:.8em}.marginnote>code,.sidenote>code{font-size:1rem}pre.code{font-size:.9rem;width:52.5%;margin-left:2.5%;overflow-x:auto}pre.code.fullwidth{width:90%}.fullwidth{max-width:100%;clear:both}span.newthought{font-variant:small-caps;font-size:1.2em}input.margin-toggle{display:none}label.sidenote-number{display:inline}label.margin-toggle:not(.sidenote-number){display:none}.iframe-wrapper{position:relative;padding-bottom:56.25%;padding-top:25px;height:0}.iframe-wrapper iframe{position:absolute;top:0;left:0;width:100%;height:100%}@media (max-width:760px){body{padding-left:8%;padding-right:8%}body,hr,section>footer,section>p,section>table{width:100%}pre.code{width:97%}section>ol,section>ul{width:90%}figure{max-width:90%}figcaption,figure.fullwidth figcaption{margin-right:0;max-width:none}blockquote{margin-left:1.5em;margin-right:0}blockquote footer,blockquote p{width:100%}label.margin-toggle:not(.sidenote-number){display:inline}.marginnote,.sidenote{display:none}.margin-toggle:checked+.marginnote,.margin-toggle:checked+.sidenote{display:block;float:left;left:1rem;clear:both;width:95%;margin:1rem 2.5%;vertical-align:baseline;position:relative}label{cursor:pointer}div.table-wrapper,table{width:85%}img{width:100%}}:not(pre)>code[class*=language-]{font-size:.9em!important}.gatsby-highlight:after{content:"";display:block;clear:both}.gatsby-highlight{clear:both}.markdown-body ol,.markdown-body p,.markdown-body ul{font-size:inherit;line-height:inherit}.markdown-body blockquote{font-size:inherit}.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:24px;letter-spacing:normal;border-bottom:1px solid #efefef}@media (max-width:767px){.markdown-body{padding:15px}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;-o-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;-o-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;-o-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;-o-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;-o-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;-o-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;-o-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;-o-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;-o-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;-o-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;-o-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;-o-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><meta name="generator" content="Gatsby 2.23.4"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://jeffrafter.com/express-and-aws/" data-baseprotocol="https:" data-basehost="jeffrafter.com"/><link rel="icon" href="/favicon-32x32.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=bddcaef8d466d0f77d76d3d885709d8f"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><title data-react-helmet="true">Exploring - Using Express and Amazon Web Services | Jeff Rafter</title><meta data-react-helmet="true" name="description" content="Using Express to build out your API can be challenging; but integrating it with all of the products available from Amazon Web Services can feel impossible."/><meta data-react-helmet="true" property="og:title" content="Exploring - Using Express and Amazon Web Services"/><meta data-react-helmet="true" property="og:description" content="Using Express to build out your API can be challenging; but integrating it with all of the products available from Amazon Web Services can feel impossible."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://jeffrafter.com//static/eae0aba8f83488451e9758afef95c138/10e03/express.png"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Jeff Rafter"/><meta data-react-helmet="true" name="twitter:title" content="Exploring - Using Express and Amazon Web Services"/><meta data-react-helmet="true" name="twitter:description" content="Using Express to build out your API can be challenging; but integrating it with all of the products available from Amazon Web Services can feel impossible."/><meta data-react-helmet="true" name="keywords" content="aws, express, terraform"/><style data-styled="coseIW ddlDEo bOnSNx gXLbcD aCPwf" data-styled-version="4.4.1">
/* sc-component-id: sc-global-3268680936 */
::selection{background-color:#dad9d9;color:rgba(0,0,0,0.70);}
/* sc-component-id: sc-bdVaJa */
.coseIW ul{list-style-type:none;margin:1rem 0;padding:0;margin-left:-16px;} .coseIW li{display:inline-block;margin:16px;} .coseIW li a{background:none;}
/* sc-component-id: sc-bwzfXH */
.aCPwf{padding-bottom:36px;}
/* sc-component-id: sc-ifAKCX */
.ddlDEo{width:55%;}
/* sc-component-id: sc-gzVnrw */
.bOnSNx{margin-top:40px;margin-bottom:40px;float:right;}
/* sc-component-id: sc-htoDjs */
.gXLbcD{list-style-type:none;} .gXLbcD li::before{content:'' !important;padding-right:0 !important;}</style><link as="script" rel="preload" href="/webpack-runtime-38c8a4ef93b968ef91ae.js"/><link as="script" rel="preload" href="/framework-8dcecaaefd71e2213eb2.js"/><link as="script" rel="preload" href="/styles-fa79fef4936efa84b233.js"/><link as="script" rel="preload" href="/app-3b271d6a60df7cd92087.js"/><link as="script" rel="preload" href="/commons-52923487d36b93dc329d.js"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-30b85df3d8081f386f13.js"/><link as="fetch" rel="preload" href="/page-data/express-and-aws/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav class="sc-bdVaJa coseIW navigation"><ul><li><a href="/">&amp;</a></li><li><a href="/tags">Tags</a></li><li><a href="/about">About</a></li></ul></nav><main class="content" role="main"><article><header><h1>Exploring - Using Express and Amazon Web Services</h1><p>October 09, 2020</p></header><div class="page-content"><div><section><figure class="fullwidth"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/eae0aba8f83488451e9758afef95c138/21b4d/express.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABT0lEQVQoz7WSy07CQBSGeS1de+Uq0rRAL5SLhhoxkkCMxsTEjYk74s5X4JmEtsy0rPoKv2dmSgSkLExcfDltz8x//p5zcseHU7QuEpjFEFaJwdyDVeQqSngambwrNIRWbiXYLISU4OnBLFKxMoedIr7/FqwklCCHZYZmUVTMgkuMMwb9hME4pfOFLYdHB1O41QR9Zw5Xn8G6nMHRFHZN4WhfsCqqJTYVHXsRnocxHgcRejpHIx/CXRfs1hLctOfwiPEgxG3Pl/G+H2DoCXxcNRbyLzoaw+dkiclbjI/3GE93EbkNpakNh936HG2DRFsBek2fnknEFAS4tny4tQW5W6BVZVLkZbTE60OMUV+0YM3hqofCtujHBnkVGxTNgpqseHcqHJ4ZkVuucrumrNZm/5RXWyAGVD9XxXZPORX82bGMPSypaW+v0p8dZjv/R8FvRlguobBQ5hIAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Express + AWS"
        title="Express + AWS"
        src="/static/eae0aba8f83488451e9758afef95c138/21b4d/express.png"
        srcset="/static/eae0aba8f83488451e9758afef95c138/72799/express.png 320w,
/static/eae0aba8f83488451e9758afef95c138/6af66/express.png 640w,
/static/eae0aba8f83488451e9758afef95c138/21b4d/express.png 1280w"
        sizes="(max-width: 1280px) 100vw, 1280px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></figure><figcaption class="fullwidth">
</figcaption><p><strong>üó∫ Exploring - Work in progress</strong></p><p>Using Express to build out your API can be challenging; but integrating it with all of the products available from Amazon Web Services can feel impossible. This post focuses less on best practices for your API and more on reusable patterns to tie all of those products together. This is the second part in a series on building out a scalable website on AWS. In the <a href="/terraform-and-aws">first part</a> we setup all of the infrastructure we‚Äôll need using Terraform.</p><p>Our API will be built in JavaScript and will run on AWS Lambda as a function. You might prefer TypeScript (as I do) but for the purposes of this post we‚Äôll keep things a little simpler.</p></section>
<section><h2 id="choosing-a-framework" style="position:relative;"><a href="#choosing-a-framework" aria-label="choosing a framework permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Choosing a framework</h2><p>Before we even get started we need to decide what framework we‚Äôll use to write our AWS Lambda function - if any. Out of the box AWS gives you a <code class="language-text">handler</code> pattern that you can use to receive an incoming web request, perform some actions and return a response. For a web server this is really all we need. In fact, using this simple pattern is actually the recommended best practice.</p><p>AWS Lambda is a FaaS (Function as a Service) or ‚Äúserverless‚Äù platform designed to execute discrete ‚Äúfunctions‚Äù or <em>handlers</em>. The expectation is that each route on our website will execute a separate specific function inside Lambda. Each of these routes would be setup individually inside AWS API Gateway and point to their respective AWS Lambda functions. We‚Äôve setup our API Gateway to send all routes to a single function (<code class="language-text">site_api</code>).</p><p>Why would we do this? What are the tradeoffs?</p><p><strong>All routes pointing to a single function</strong></p><ul>
<li>When developing your API you want to be able to test it locally</li>
<li>When deploying you want shared dependencies to be updated simultaneously</li>
<li>Adding a new route to API Gateway and pointing to a new Lambda function is cumbersome</li>
<li>Changing API Gateway can be slow</li>
<li>Our function will have fewer cold-starts</li>
</ul><p><strong>Many routes pointing to separate functions</strong></p><ul>
<li>You might want to restrict deployments for specific parts of the site</li>
<li>You can change parts of the site without changing everything</li>
<li>A single mistake won‚Äôt break the entire site</li>
<li>Deploying new functions will only cause cold-starts on part of the site</li>
<li>You want to use Lambda@Edge</li>
<li>Smaller functions take less time to upload and deploy</li>
<li>Smaller functions have a shorter cold-start time</li>
</ul><p>In general, how you choose between these trade-offs is dictated by the site and team (and in some cases preferences). If you have a smaller site and smaller team then it is often better to favor simplicity. Choosing <strong>All routes pointing to a single function</strong> simplifies local development and deployment but increases risk by putting everything in one function. For example, if you are the only developer (or there are only a couple developers), then layering strict permissions about who can deploy specific parts of the site is overkill.</p><p>What‚Äôs a cold-start? Even though AWS Lambda runs functions ‚Äúon-demand‚Äù it still needs to load the code in order to execute it. If your code-base is large it will take a long time to load before your function can respond to requests. Because this can be slow, AWS tries to avoid doing it too often and keeps the code in a hot-cache for five minutes after it is loaded. If the function is used again, the timeout is restarted. You should try to avoid cold-starts as much as possible and you should try to minimize their impact as much as possible to keep your site snappy. Keeping all of your routes in a separate functions means that the code that needs to be loaded is smaller (and therefore faster to load). But pointing all of your routes to a single shared function means that the function will be used more frequently and will likely have fewer cold-starts.</p><p>As with most things, it depends.</p><p>For our API we‚Äôll use a single function. This is almost always the simplest and easiest choice especially when getting started. As our site grows we can slowly transition from this model to a hybrid model with multiple functions and ultimately to individual functions for every route if needed.</p><h3 id="why-express" style="position:relative;"><a href="#why-express" aria-label="why express permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why Express?</h3><p>Because we‚Äôre using a single function we‚Äôll need to enable that function to handle routing for us (like a traditional web server). There are numerous frameworks that make it easy. <a href="https://expressjs.com/">Express</a> is a ‚ÄúFast, unopinionated, minimalist web framework for Node.js‚Äù. That sounds like what we want. We could choose a smaller framework like Micro from Vercel (used as part of Next.js) - but it is not typically used in serverless environments. We could also choose <a href="https://sailsjs.com/">Sails.js</a>, a much richer MVC framework written in JavaScript. In many cases this is the right choice, but for our purposes we‚Äôll use Express as it is easier to explain what is happening.</p><h1 id="getting-started" style="position:relative;"><a href="#getting-started" aria-label="getting started permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Getting started</h1><p>In the previous post we created a very simple API function:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Event: '</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Context: '</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    statusCode<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      event<span class="token operator">:</span> event<span class="token punctuation">,</span>
      context<span class="token operator">:</span> context<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>In the handler we logged information about the event and context and echoed back the result as JSON. You would never want a function like this in a production application, but this allowed us to quickly setup our API Gateway deployment, test AWS Lambda and make sure our logging worked.</p><p>To make our API we‚Äôll need more code than this. Let‚Äôs create a new folder called <code class="language-text">api</code>. I usually make this a sibling folder to the <code class="language-text">terraform</code> folder we created previously.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">mkdir</span> api</code></pre></div><p>Change to that folder:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> api</code></pre></div><p>We‚Äôll use <code class="language-text">npm</code> to install and manage the packages for our API. Let‚Äôs set that up now:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm init -y</code></pre></div><p>This will generate a default <code class="language-text">package.json</code>:</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"api"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span>
<span class="token punctuation">}</span></code></pre></div><p>Next, we‚Äôll install express:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install --save express</code></pre></div><p>We‚Äôll need a few more packages right away:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install --save cors body-parser cookie-parser http-errors</code></pre></div><p>We‚Äôll also need some AWS-specific packages:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install --save aws-sdk aws-serverless-express</code></pre></div></section>
<section><h2 id="main-application" style="position:relative;"><a href="#main-application" aria-label="main application permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Main application</h2><p>Even though it is not required, it is common to put the main application logic in a file called <code class="language-text">app.js</code>. Create <code class="language-text">app.js</code> and copy the following:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token string">'use strict'</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> createError <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-errors'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> awsServerlessExpressMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'aws-serverless-express/middleware'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Setup middleware for our API</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>extended<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span>credentials<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> isDevelopment <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isDevelopment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>awsServerlessExpressMiddleware<span class="token punctuation">.</span><span class="token function">eventContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Add a single route</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/ok'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    ok<span class="token operator">:</span> <span class="token string">'ok'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// The aws-serverless-express library creates a server and listens on a Unix</span>
<span class="token comment">// Domain Socket for you, so you don't need the usual call to app.listen.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>

<span class="token comment">// Setup 404 and error handler (after middleware)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_req<span class="token punctuation">,</span> _res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token function">createError</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Error handler (must have all four parameters)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> _req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> _next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>message <span class="token operator">=</span> err<span class="token punctuation">.</span>message
  res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>error <span class="token operator">=</span> isDevelopment <span class="token operator">?</span> err <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// render the error</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token operator">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Export your express server so it can be reused depending on how the server is run.</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app</code></pre></div><p>Much of this is boilerplate and looks very similar to the <a href="https://expressjs.com/en/starter/generator.html">Express application generator</a>. There are a few notable differences: for example we are using an AWS specific middleware for reading the event context. Again, the default handler for an AWS Lambda function includes a context associated with the event that triggered it (in our case a request sent to the API Gateway). This context includes useful information like the route, the request headers and AWS specific information such as the currently authenticated AWS Cognito user.</p><p>For now we‚Äôve included a single route that returns a JSON <code class="language-text">ok</code>. We‚Äôll be adding more routes soon.<label for="sd-why-didn-t-we-use" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-why-didn-t-we-use" class="margin-toggle" /><span class="sidenote">Why didn't we use the root route <code>/</code> to test things? Unfortunately the way we've setup our API Gateway as a proxy the root route <code>/</code> won't work. If you open that route in a browser you'll see <code>{'message':"Missing Authentication Token"}</code> regardless of how your Express server is setup. We might have also chosen <code>/ping</code> which is commonly used for health checks. Unfortunately this route is also managed by API Gateway and returns the health status of the gateway itself.</span></p></section>
<section><h2 id="setting-up-the-lambda-handler-function" style="position:relative;"><a href="#setting-up-the-lambda-handler-function" aria-label="setting up the lambda handler function permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting up the Lambda handler function</h2><p>Notice that we aren‚Äôt calling <code class="language-text">app.listen</code> in <code class="language-text">app.js</code> as we normally would. When our server is running within AWS lambda, we don‚Äôt want to listen on a port to receive requests; instead we‚Äôll build a custom AWS handler function and pass the request to our Express server directly.</p><p>Create a new file called <code class="language-text">lambda.js</code>:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token string">'use strict'</span>
<span class="token keyword">const</span> awsServerlessExpress <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'aws-serverless-express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./app'</span><span class="token punctuation">)</span>

<span class="token comment">// If you are returning non-JSON data such as images, fonts, or PDFs</span>
<span class="token comment">// add the associated mime types to this list</span>
<span class="token keyword">const</span> binaryMimeTypes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'application/octet-stream'</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> awsServerlessExpress<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> binaryMimeTypes<span class="token punctuation">)</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> awsServerlessExpress<span class="token punctuation">.</span><span class="token function">proxy</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> event<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div><p>We‚Äôll configure our AWS Lambda function to call this handler which will then pass the request to our Express application. Even if we add more routes to our Express application, we won‚Äôt need to change this simple handler.</p><h1 id="setting-up-a-local-server-for-development" style="position:relative;"><a href="#setting-up-a-local-server-for-development" aria-label="setting up a local server for development permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting up a local server for development</h1><p>We‚Äôve setup our Express app and added a Lambda handler wrapper for it, but it is still difficult for us to test our application locally. We‚Äôll need another wrapper for running our application in development mode. Add the following dependencies:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install --save-dev dotenv nodemon</code></pre></div><p>Notice that we‚Äôre saving these are development dependencies. We won‚Äôt need these for our Lambda function and we want to keep it as small as possible.</p><p>Create a file called <code class="language-text">local.js</code>:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token string">'use strict'</span>
process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">'NODE_ENV'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'development'</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dotenv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./app'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">'PORT'</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">4000</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Listening on http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span></code></pre></div><p>Like <code class="language-text">lambda.js</code>, this wrapper is very simple. It loads our configuration from a <code class="language-text">.env</code> file (if it exists) and sets the application to listen on a port (by default, port <code class="language-text">4000</code>).</p><p>To use this wrapper, we‚Äôll change <code class="language-text">package.json</code> so that the <code class="language-text">start</code> script loads it (and we‚Äôll remove the <code class="language-text">main</code> entry and set <code class="language-text">private</code> to <code class="language-text">true</code> even though this isn‚Äôt necessary at this point):</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"api"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span class="token punctuation">,</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"nodemon local.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"aws-sdk"</span><span class="token operator">:</span> <span class="token string">"^2.766.0"</span><span class="token punctuation">,</span>
    <span class="token property">"aws-serverless-express"</span><span class="token operator">:</span> <span class="token string">"^3.3.8"</span><span class="token punctuation">,</span>
    <span class="token property">"body-parser"</span><span class="token operator">:</span> <span class="token string">"^1.19.0"</span><span class="token punctuation">,</span>
    <span class="token property">"cookie-parser"</span><span class="token operator">:</span> <span class="token string">"^1.4.5"</span><span class="token punctuation">,</span>
    <span class="token property">"cors"</span><span class="token operator">:</span> <span class="token string">"^2.8.5"</span><span class="token punctuation">,</span>
    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.17.1"</span><span class="token punctuation">,</span>
    <span class="token property">"http-errors"</span><span class="token operator">:</span> <span class="token string">"^1.8.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"dotenv"</span><span class="token operator">:</span> <span class="token string">"^8.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"nodemon"</span><span class="token operator">:</span> <span class="token string">"^2.0.4"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>Notice that we execute <code class="language-text">local.js</code> using <code class="language-text">nodemon</code>. <a href="https://nodemon.io/">Nodemon</a> will watch our project folder for changes and reload and restart our server automatically.</p><p>You can start the server by running:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm start</code></pre></div><p>You should see:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">[nodemon] 2.0.4
[nodemon] to restart at any time, enter `rs`
[nodemon] watching path(s): *.*
[nodemon] watching extensions: js,mjs,json
[nodemon] starting `node local.js`
Listening on http://localhost:4000</code></pre></div><p>If you open <a href="http://localhost:4000/ok">http://localhost:4000/ok</a> you should see:</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"ok"</span><span class="token operator">:</span> <span class="token string">"ok"</span><span class="token punctuation">}</span></code></pre></div><p>Not very exciting content, but this is our first JSON API response!</p><h1 id="save-our-progress" style="position:relative;"><a href="#save-our-progress" aria-label="save our progress permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Save our progress</h1><p>We‚Äôll want to use version control to keep track of our changes. We‚Äôll use <code class="language-text">git</code>:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">git init</code></pre></div></section>
<section><h2 id="ignore-some-things" style="position:relative;"><a href="#ignore-some-things" aria-label="ignore some things permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ignore some things</h2><p>Let‚Äôs make sure to ignore our environment variables (which may include sensitive secrets) and some of the files we‚Äôve generated. Create a <code class="language-text">.gitignore</code> file:</p><div class="gatsby-highlight" data-language="gitignore"><pre class="language-gitignore"><code class="language-gitignore"><span class="token comment"># Ignore built releases</span>
<span class="token entry string">dist<span class="token punctuation">/</span><span class="token operator">*</span></span>

<span class="token comment"># =========================</span>
<span class="token comment"># Node.js-Specific Ignores</span>
<span class="token comment"># =========================</span>

<span class="token comment"># Ignore any localstack configuration</span>
<span class="token entry string">.localstack<span class="token operator">*</span></span>

<span class="token comment"># Logs</span>
<span class="token entry string">logs</span>
<span class="token entry string"><span class="token operator">*</span>.log</span>
<span class="token entry string">npm-debug.log<span class="token operator">*</span></span>
<span class="token entry string">yarn-debug.log<span class="token operator">*</span></span>
<span class="token entry string">yarn-error.log<span class="token operator">*</span></span>

<span class="token comment"># Runtime data</span>
<span class="token entry string">pids</span>
<span class="token entry string"><span class="token operator">*</span>.pid</span>
<span class="token entry string"><span class="token operator">*</span>.seed</span>
<span class="token entry string"><span class="token operator">*</span>.pid.lock</span>

<span class="token comment"># Directory for instrumented libs generated by jscoverage/JSCover</span>
<span class="token entry string">lib-cov</span>

<span class="token comment"># Coverage directory used by tools like istanbul</span>
<span class="token entry string">coverage</span>

<span class="token comment"># nyc test coverage</span>
<span class="token entry string">.nyc_output</span>

<span class="token comment"># Ignore test runner output</span>
<span class="token entry string">__tests__<span class="token punctuation">/</span>runner<span class="token punctuation">/</span><span class="token operator">*</span></span>

<span class="token comment"># Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)</span>
<span class="token entry string">.grunt</span>

<span class="token comment"># Bower dependency directory (https://bower.io/)</span>
<span class="token entry string">bower_components</span>

<span class="token comment"># node-waf configuration</span>
<span class="token entry string">.lock-wscript</span>

<span class="token comment"># Compiled binary addons (https://nodejs.org/api/addons.html)</span>
<span class="token entry string">build<span class="token punctuation">/</span>Release</span>

<span class="token comment"># Dependency directories</span>
<span class="token entry string">node_modules<span class="token punctuation">/</span></span>
<span class="token entry string">jspm_packages<span class="token punctuation">/</span></span>

<span class="token comment"># Typescript v1 declaration files</span>
<span class="token entry string">typings<span class="token punctuation">/</span></span>

<span class="token comment"># Optional npm cache directory</span>
<span class="token entry string">.npm</span>

<span class="token comment"># Optional eslint cache</span>
<span class="token entry string">.eslintcache</span>

<span class="token comment"># Optional REPL history</span>
<span class="token entry string">.node_repl_history</span>

<span class="token comment"># Output of 'npm pack'</span>
<span class="token entry string"><span class="token operator">*</span>.tgz</span>

<span class="token comment"># Yarn Integrity file</span>
<span class="token entry string">.yarn-integrity</span>

<span class="token comment"># dotenv environment variables file</span>
<span class="token entry string">.env</span>

<span class="token comment"># =========================</span>
<span class="token comment"># Operating System Files</span>
<span class="token comment"># =========================</span>

<span class="token comment"># OSX</span>
<span class="token comment"># =========================</span>

<span class="token entry string">.DS_Store</span>
<span class="token entry string">.AppleDouble</span>
<span class="token entry string">.LSOverride</span>

<span class="token comment"># Thumbnails</span>
<span class="token entry string">._<span class="token operator">*</span></span>

<span class="token comment"># Files that might appear on external disk</span>
<span class="token entry string">.Spotlight-V100</span>
<span class="token entry string">.Trashes</span>

<span class="token comment"># Directories potentially created on remote AFP share</span>
<span class="token entry string">.AppleDB</span>
<span class="token entry string">.AppleDesktop</span>
<span class="token entry string">Network Trash Folder</span>
<span class="token entry string">Temporary Items</span>
<span class="token entry string">.apdisk</span>

<span class="token comment"># Windows</span>
<span class="token comment"># =========================</span>

<span class="token comment"># Windows image file caches</span>
<span class="token entry string">Thumbs.db</span>
<span class="token entry string">ehthumbs.db</span>

<span class="token comment"># Folder config file</span>
<span class="token entry string">Desktop.ini</span>

<span class="token comment"># Recycle Bin used on file shares</span>
<span class="token entry string">$RECYCLE.BIN<span class="token punctuation">/</span></span>

<span class="token comment"># Windows Installer files</span>
<span class="token entry string"><span class="token operator">*</span>.cab</span>
<span class="token entry string"><span class="token operator">*</span>.msi</span>
<span class="token entry string"><span class="token operator">*</span>.msm</span>
<span class="token entry string"><span class="token operator">*</span>.msp</span>

<span class="token comment"># Windows shortcuts</span>
<span class="token entry string"><span class="token operator">*</span>.lnk</span></code></pre></div></section>
<section><h2 id="commit" style="position:relative;"><a href="#commit" aria-label="commit permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Commit</h2><p>To add all of the files and commit them to the repository we‚Äôll use GitHub Desktop:</p><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/01c6e7aebbcabff12c83a0dd2837d63b/e872c/express-initial-commit.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 70.9375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADCklEQVQ4y2WSy28TVxSHpzvYJQFCkxhIEUgscAIrqLphMjyGQIJC2/+halMgE6Apj8CC14ZHQUFtAqK8KijE9rqiUrvuokUE3EIcxx7HMX7EsZ3E47lzz48zNgXjXOnT8VzN/fTNjBXvquaP27xr+xo9n/Qva/QYDUz9ihZjecs6o6FpLf9uNpat9BgtresND7O8abVR39hSSz+f62tY0dyk9Oz/Ujs8cAK9xgC+OXQEXx/ox0HjKE4e/x6nBk+i9+ARvh7A4OnzODF4Fn2Hj/He0Q/49tB3+KrXwK693duVodt+NWjmnZmCJbKFopCSRKHkiHN/oEwklxGxfEq8tnKiACHm4NRiL4BE2pkTI3dudSg37o2qE1MZkBR8u0MkHUrkC9R6wSHPGYv+SU3Qv7MhCubCFC7FyaTkIqaQxkQxhqvDQ5py435AfWlmYBUX4Egi8ErPz2PzDw7aL5XwImsiTilMURoxpzJroGnMIFyM49rIdU15+DigprMF2LYN9rGQkLcENl0hbLxo4e/EOCKlOOLIlPlfVHVdFk6ycOjmj5oS8PtU6Qg3DESVwqINLgS8lyw8TYYwXojywcyiumphpJTAfd9DTfH5/apb5y75VrhgU0XIhc+zUSTe1tRS/chRFv7i/1VT/P6AKsSHhWXhFaCNC8dmInzzNCYthmfETpTfl1tUXVgW+lg4+viRWuQP4qoqH4UwX6oI3Ud+lplExIpjYiFeFrmYThIxmVpc6Apv3RxWx0NhpHJFys7ZMs9507M2tV8m4kJiIYWLMWIBuYfdyWXv4D3pzoiVIBZ2KKOjvg5uQ+3afBVo579OcNZEaC6KqEjyu8yWcYuqSSKHKZnGg8AjTbk2cnfbT7+F5fATU975M+YMP4nKkd9N6b2QlxvPp+VfZlCOJf+Tz5Iv5fP0OPNKjqXe8yITcl4VojLI8+cHd1VlQ/uWuo9atR3Kmg596XpNd+eSdZpe592n17d16Tu7O/WuL7r1PZ936bt79uidPXv1zv3vcff0fZ3u3LH1s0/r3gAKzFZIhzgotAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Create a commit titled &#39;Initial commit&#39;"
        title="Create a commit titled &#39;Initial commit&#39;"
        src="/static/01c6e7aebbcabff12c83a0dd2837d63b/21b4d/express-initial-commit.png"
        srcset="/static/01c6e7aebbcabff12c83a0dd2837d63b/72799/express-initial-commit.png 320w,
/static/01c6e7aebbcabff12c83a0dd2837d63b/6af66/express-initial-commit.png 640w,
/static/01c6e7aebbcabff12c83a0dd2837d63b/21b4d/express-initial-commit.png 1280w,
/static/01c6e7aebbcabff12c83a0dd2837d63b/29114/express-initial-commit.png 1920w,
/static/01c6e7aebbcabff12c83a0dd2837d63b/c2d13/express-initial-commit.png 2560w,
/static/01c6e7aebbcabff12c83a0dd2837d63b/e872c/express-initial-commit.png 2606w"
        sizes="(max-width: 1280px) 100vw, 1280px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p><h1 id="deploying" style="position:relative;"><a href="#deploying" aria-label="deploying permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deploying</h1><p>We‚Äôll use the <code class="language-text">terrform</code> setup from the <a href="./terraform-and-aws">previous post</a> to deploy our Express application to AWS Lambda. To do this we‚Äôll need to do the following:</p><ul>
<li>Install only the production dependencies</li>
<li>Build and compress the release and copy them to the <code class="language-text">terraform</code> folder</li>
<li>Use terraform to deploy our changes</li>
</ul></section>
<section><h2 id="install-only-the-production-dependencies" style="position:relative;"><a href="#install-only-the-production-dependencies" aria-label="install only the production dependencies permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install only the production dependencies</h2><p>While working locally, we‚Äôve been using some development packages. These aren‚Äôt needed for our production application so we‚Äôll want to remove them (to make our build smaller and startup time faster). If you‚Äôre running your server locally, stop it (use <code class="language-text">Ctrl+C</code>).</p><p>Next, let‚Äôs prune the dependencies to only production packages:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm prune --production</code></pre></div></section>
<section><h2 id="build-and-compress-the-release" style="position:relative;"><a href="#build-and-compress-the-release" aria-label="build and compress the release permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build and compress the release</h2><p>We‚Äôll need to package all of the files into a release for deployment. There are a few ways to do this, each with tradeoffs. To start, we‚Äôll simply compress all of the source code and dependencies into a single zip file. This is far less efficient and will include many files our production application won‚Äôt need - but it will make the process simpler and easier to debug.</p><p>Add the <code class="language-text">zip</code> script to your <code class="language-text">package.json</code>:</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json">  ...
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span class="token punctuation">,</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"nodemon local.js"</span><span class="token punctuation">,</span>
    <span class="token property">"zip"</span><span class="token operator">:</span> <span class="token string">"zip -r ../terraform/api.zip *.js package* node_modules"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...</code></pre></div><p>This creates a file called <code class="language-text">api.zip</code> in the terraform folder. If you‚Äôve named your folders differently (or put them in different locations) you may need to change this.</p><p>Run the command:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm run zip</code></pre></div><p>The zip file is created but it is very large: <code class="language-text">8.0M</code>. We‚Äôll want to make this smaller. Re-install your development dependencies:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install</code></pre></div><p>Instead of including everything, we should build our release using a tool like <a href="https://webpack.js.org/">Webpack</a>. Webpack allows you to transpile and minify your source code into a single JavaScript file; bundling all of the dependencies in the most efficient way. It will also save the hassle of pruning and re-installing dependencies. Let‚Äôs install it:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install --save-dev webpack webpack-cli</code></pre></div><p>Next, we‚Äôll want to create a configuration for Webpack. For now, we‚Äôll focus only on the production build that we plan to upload to AWS. Create a file called <code class="language-text">webpack.config.js</code>:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./lambda.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    library<span class="token operator">:</span> <span class="token string">'api'</span><span class="token punctuation">,</span>
    libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
    umdNamedDefine<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'api.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  target<span class="token operator">:</span> <span class="token string">'node'</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div><p>This configuration tells Webpack to start with <code class="language-text">lambda.js</code> and export a bundled release called <code class="language-text">dist/api.js</code> which will be used as an API and has a <em>Universal Module Declaration</em> (our exported <code class="language-text">handler</code> function). We‚Äôve set our target to <code class="language-text">node</code> meaning we plan to run the generated file using Node (we don‚Äôt plan to run it in a browser).</p><p>To run <code class="language-text">webpack</code> we need to add another script to our <code class="language-text">package.json</code>:</p><div class="gatsby-highlight has-highlighted-lines" data-language="json"><pre class="language-json"><code class="language-json">  ...
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span class="token punctuation">,</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"nodemon local.js"</span><span class="token punctuation">,</span>
    <span class="token property">"zip"</span><span class="token operator">:</span> <span class="token string">"zip -r ../terraform/api.zip *.js package* node_modules"</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"webpack"</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...</code></pre></div><p>Run it:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm run build</code></pre></div><p>You should see:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Hash: a7e54e4024a114c3a6fd
Version: webpack 4.44.2
Time: 559ms
Built at: 10/07/2020 5:05:04 PM
 Asset     Size  Chunks             Chunk Names
api.js  581 KiB       0  [emitted]  main
Entrypoint main = api.js
  [2] external &quot;path&quot; 42 bytes {0} [built]
  [7] external &quot;fs&quot; 42 bytes {0} [built]
  [9] external &quot;buffer&quot; 42 bytes {0} [built]
 [10] external &quot;http&quot; 42 bytes {0} [built]
 [12] external &quot;util&quot; 42 bytes {0} [built]
 [13] external &quot;stream&quot; 42 bytes {0} [built]
 [23] external &quot;url&quot; 42 bytes {0} [built]
 [32] external &quot;events&quot; 42 bytes {0} [built]
 [35] external &quot;net&quot; 42 bytes {0} [built]
 [42] external &quot;querystring&quot; 42 bytes {0} [built]
 [49] external &quot;crypto&quot; 42 bytes {0} [built]
 [56] ./lambda.js 455 bytes {0} [built]
 [63] ./app.js 1.33 KiB {0} [built]
 [75] external &quot;tty&quot; 42 bytes {0} [built]
[109] ./node_modules/express/lib sync 160 bytes {0} [built]
    + 123 hidden modules

WARNING in ./node_modules/express/lib/view.js 81:13-25
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/express/lib/application.js
 @ ./node_modules/express/lib/express.js
 @ ./node_modules/express/index.js
 @ ./app.js
 @ ./lambda.js</code></pre></div><p>The compiled size is now <code class="language-text">581 KiB</code>! That is much smaller than <code class="language-text">8 MB</code>. Unfortunately, you may also see a <code class="language-text">Critical Dependency</code> warning<label for="sd-more-information" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-more-information" class="margin-toggle" /><span class="sidenote">More information about this error can be found <a href="https://github.com/webpack/webpack/issues/1576#issuecomment-475118999">on GitHub</a>.</span>. Why are we getting this warning? Express loads its view engines using a dynamic require:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">var fn = require(mod).__express</code></pre></div><p>Webpack isn‚Äôt sure how to handle this; but luckily we don‚Äôt really care because we‚Äôre not using any view engines. Because of this we can just ignore the warning. If, like me, this bothers you then there are a few options:</p><ol>
<li>Exclude all <code class="language-text">nodeExternals</code> - this will prevent Webpack from bundling any of the <code class="language-text">node_modules</code> in our build</li>
<li>Exclude <code class="language-text">express</code> - this will prevent Webpack from bundling the <code class="language-text">express</code> package in our build</li>
<li>Silence the warning</li>
</ol><p>The first option makes the build incredibly small (less than <code class="language-text">1 Kib</code>), but unfortunately doesn‚Äôt work at all. Because we‚Äôre running on AWS Lambda we need the node modules to be bundled. This also means option 2 won‚Äôt work. Our only option is to silence the warning. Change <code class="language-text">webpack.config.js</code>:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./lambda.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    library<span class="token operator">:</span> <span class="token string">'api'</span><span class="token punctuation">,</span>
    libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
    umdNamedDefine<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'api.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  target<span class="token operator">:</span> <span class="token string">'node'</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  stats<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">warningsFilter</span><span class="token operator">:</span> <span class="token parameter">warning</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">RegExp</span><span class="token punctuation">(</span><span class="token string">'node_modules/express/lib/view.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>warning<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div><p>Let‚Äôs change our <code class="language-text">zip</code> script in <code class="language-text">package.json</code> to use this new file. Also, we‚Äôll add a new <code class="language-text">release</code> script that combines the <code class="language-text">build</code> and <code class="language-text">zip</code> scripts:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">  ...
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
    &quot;start&quot;: &quot;nodemon local.js&quot;,
    &quot;zip&quot;: &quot;cd dist; zip -r ../../terraform/api.zip api.js&quot;,
    &quot;build&quot;: &quot;webpack&quot;,
    &quot;release&quot;: &quot;npm run build &amp;&amp; npm run zip&quot;
  },
  ...</code></pre></div><p>Run the <code class="language-text">release</code>:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm run release</code></pre></div><p>Our compressed <code class="language-text">api.zip</code> is only <code class="language-text">235 KiB</code>.</p><h3 id="remove-the-extracted-comments" style="position:relative;"><a href="#remove-the-extracted-comments" aria-label="remove the extracted comments permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Remove the extracted comments</h3><p>In newer versions of webpack the comments will be automatically extracted and placed in a <code class="language-text">LICENSE.txt</code> file. If you want to avoid this you can turn off comment extraction in your <code class="language-text">webpack.config.js</code>:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"terser-webpack-plugin"</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./lambda.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    library<span class="token operator">:</span> <span class="token string">'api'</span><span class="token punctuation">,</span>
    libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
    umdNamedDefine<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'api.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  target<span class="token operator">:</span> <span class="token string">'node'</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  stats<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">warningsFilter</span><span class="token operator">:</span> <span class="token parameter">warning</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">RegExp</span><span class="token punctuation">(</span><span class="token string">'node_modules/express/lib/view.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>warning<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        terserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
          format<span class="token operator">:</span> <span class="token punctuation">{</span>
            comments<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        extractComments<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div></section>
<section><h2 id="use-terraform-to-deploy-our-changes" style="position:relative;"><a href="#use-terraform-to-deploy-our-changes" aria-label="use terraform to deploy our changes permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Use terraform to deploy our changes</h2><p>Now that we have prepared the release we should be able to apply our changes using <code class="language-text">terraform</code>. Check the plan:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">terraform plan</code></pre></div><p>You should see the modified hash of the source code:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">...
 ~ source_code_hash = &quot;PM7qAOa3MhcDW7/4fxKHxkSe5c6c3DyElx5iTGb8bPY=&quot; -&gt; &quot;APdymEzpkA8Gm1BqKtSRnr/4O5Xl0gZBJHknkbA4LYE=&quot;
...</code></pre></div><p>Apply the changes:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">terraform apply</code></pre></div><p>And answer <code class="language-text">yes</code>. Once complete, open your API in a browser: <a href="https://api.example.com/ok">https://api.example.com/ok</a> (replacing <code class="language-text">example</code> with your domain name). You should see:</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"ok"</span><span class="token operator">:</span> <span class="token string">"ok"</span><span class="token punctuation">}</span></code></pre></div><p>If you don‚Äôt see ‚Äúok‚Äù you might instead see:</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>'message'<span class="token operator">:</span><span class="token string">"Missing Authentication Token"</span><span class="token punctuation">}</span></code></pre></div><p>There are several reasons you might see this:</p><ul>
<li>You attempted to navigate to the root URL (which isn‚Äôt configured)</li>
<li>Your integration or options integration is configured incorrectly</li>
<li>The Lambda function is failing (and errors are configured incorrectly)</li>
<li>The integration is setup to require authorization and there is no authorized user.</li>
</ul><p>In most cases the problem is required authorization. In fact, if you‚Äôve followed the previous tutorial, you should see this error. Feel free to continue (we‚Äôll setup user authorization in the next post). If you want to remove the user authorization requirement, revisit the <a href="https://jeffrafter.com/terraform-and-aws/#create-an-api-gateway-that-proxies-to-the-function"><code class="language-text">site_api_method</code></a> definition. Change <code class="language-text">AWS_IAM</code> to <code class="language-text">NONE</code> and apply the changes. After a few minutes you should be able to see <code class="language-text">&quot;ok&quot;</code> response.</p></section>
<section><h2 id="invoking-the-function-directly" style="position:relative;"><a href="#invoking-the-function-directly" aria-label="invoking the function directly permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Invoking the function directly</h2><p>We could also invoke our function directly (without opening a browser and sending a request through the API Gateway). We can do this using <code class="language-text">awscli</code>. Run the following (changing the <code class="language-text">profile</code> name <code class="language-text">example</code> to the name of your <code class="language-text">awscli</code> profile)<label for="sd-it-s-easy-to-forget" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sd-it-s-easy-to-forget" class="margin-toggle" /><span class="sidenote">It's easy to forget to add the <code>cli-binary-format</code> parameter. If you leave it off you'll see an error: "An error occurred (InvalidRequestContentException) when calling the Invoke operation: Could not parse request body into json: Unexpected character ('¬≠' (code 173)): expected a valid value (number, String, array, object, 'true', 'false' or 'null')
at [Source: (byte[])"ÔøΩÔøΩ(ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ/ÔøΩjÔøΩÔøΩHmÔøΩÔøΩÔøΩD€°‹°yÔøΩ^ÔøΩÔøΩ(ÔøΩ◊ßÔøΩ‹©y ÔøΩiÔøΩ'ÔøΩ*'ÔøΩ;(ÔøΩÔøΩZÔøΩ«≠Q1|"; line: 1, column: 2]". You can make this parameter the default in your <code>~/.aws/config</code>. For more information, see the <a href="https://docs.aws.amazon.com/cli/latest/userguide/cliv2-migration.html#cliv2-migration-binaryparam">AWS documentation</a>.</span>:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">aws lambda invoke \
  --profile example \
  --cli-binary-format raw-in-base64-out \
  --function-name site_lambda_function \
  --payload &#39;{
    &quot;resource&quot;: &quot;/{proxy+}&quot;,
    &quot;path&quot;: &quot;/ok&quot;,
    &quot;httpMethod&quot;: &quot;GET&quot;,
    &quot;body&quot;: &quot;{\&quot;\&quot;}&quot;,
    &quot;headers&quot;: &quot;{\&quot;content-type\&quot;:\&quot;application/json; charset=UTF-8\&quot;}&quot;
  }&#39; /dev/stdout</code></pre></div><p>You should see:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">{&quot;statusCode&quot;:200,&quot;body&quot;:&quot;{\&quot;ok\&quot;:\&quot;ok\&quot;}&quot;,&quot;headers&quot;:{&quot;x-powered-by&quot;:&quot;Express&quot;,&quot;access-control-allow-origin&quot;:&quot;*&quot;,&quot;access-control-allow-credentials&quot;:&quot;true&quot;,&quot;content-type&quot;:&quot;application/json; charset=utf-8&quot;,&quot;content-length&quot;:&quot;11&quot;,&quot;etag&quot;:&quot;W/\&quot;b-2F/2BWc0KYbtLqL5U2Kv5B6uQUQ\&quot;&quot;,&quot;date&quot;:&quot;Thu, 08 Oct 2020 03:25:{4 GMT&quot;,&quot;connection&quot;:&quot;close&quot;},&quot;isBase64Encoded&quot;:false}
    &quot;StatusCode&quot;: 200,
    &quot;ExecutedVersion&quot;: &quot;$LATEST&quot;
}</code></pre></div><p>This is really helpful when debugging API Gateway configuration and request payload problems.</p><p>If you want to view the Lambda function on AWS itself, you should be able to log in and go to <a href="https://console.aws.amazon.com/lambda/home?region=us-east-1#/functions/site_lambda_function?tab=configuration">https://console.aws.amazon.com/lambda/home?region=us-east-1#/functions/site_lambda_function?tab=configuration</a>. From here you can quickly get to the CloudWatch logs to see any information you‚Äôve logged. Let‚Äôs change our <code class="language-text">ok</code> route and have it log some information:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/ok'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'GET ok'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'API Gateway: '</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>apiGateway<span class="token punctuation">)</span><span class="token punctuation">)</span>

  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    ok<span class="token operator">:</span> <span class="token string">'ok'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div><p>Save the change and create a new release:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm run release</code></pre></div><p>Next, we‚Äôll need to deploy the change using Terraform. Let‚Äôs add a <code class="language-text">deploy</code> script to our <code class="language-text">package.json</code>:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
    &quot;start&quot;: &quot;nodemon local.js&quot;,
    &quot;zip&quot;: &quot;cd dist; zip -r ../../terraform/api.zip api.js&quot;,
    &quot;build&quot;: &quot;webpack&quot;,
    &quot;release&quot;: &quot;npm run build &amp;&amp; npm run zip&quot;,
    &quot;deploy&quot;: &quot;cd ../terraform; terraform apply --auto-approve&quot;
  },</code></pre></div><p>Now run:</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm run deploy</code></pre></div><p>You should see Terraform run. Go to your <code class="language-text">ok</code> route in a browser again; wait a few seconds and then open the CloudWatch logs by clicking the <code class="language-text">View logs in CloudWatch</code> button (or, if you‚Äôve closely followed my setup: <a href="https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Flambda$252Fsite_lambda_function">here</a>).</p><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d69bc387a06730821e0b01a2978e0a91/9c507/express-cloudwatch.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 32.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/0lEQVQY011R2ZKEIAz0/3/Rcas8FhwREMUD0OpN0JmHfWg6CekmQCFHC6k0pJ6grMNgXGZBOeNNubYWatSEEQOB47dSsNME62bSukc/o7DUPAwDYgxfnCkhpYgUY85D4HrMCJQflM/LAm1s5nVdsfibi3Xb4Clgvq4rixyduh9HFoaYcJ7nF2y+7zuOzz6BtRvVfDakxTm6ljbgab33kLKHEBJd94t+UDDGZFg7ZaPwGP3HRsYFGwgh8HpVGXx9NqrrBlX1g7IsCS80TZMPYWMeYKL3u/mOP8MUCy1c5An10yykRNt1aNsuc03cj7Q3zzAkZLExN/PUrOMP4vf8A+QVyXUiqfptAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="CloudWatch logs showing the API invocation"
        title="CloudWatch logs showing the API invocation"
        src="/static/d69bc387a06730821e0b01a2978e0a91/21b4d/express-cloudwatch.png"
        srcset="/static/d69bc387a06730821e0b01a2978e0a91/72799/express-cloudwatch.png 320w,
/static/d69bc387a06730821e0b01a2978e0a91/6af66/express-cloudwatch.png 640w,
/static/d69bc387a06730821e0b01a2978e0a91/21b4d/express-cloudwatch.png 1280w,
/static/d69bc387a06730821e0b01a2978e0a91/29114/express-cloudwatch.png 1920w,
/static/d69bc387a06730821e0b01a2978e0a91/c2d13/express-cloudwatch.png 2560w,
/static/d69bc387a06730821e0b01a2978e0a91/9c507/express-cloudwatch.png 2768w"
        sizes="(max-width: 1280px) 100vw, 1280px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p><h1 id="working-with-authenticated-requests" style="position:relative;"><a href="#working-with-authenticated-requests" aria-label="working with authenticated requests permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Working with authenticated requests</h1><p>Looking closely at the logs you might have noticed the <code class="language-text">requestContext</code> node in the <code class="language-text">apiGateway</code> object that was logged:</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json">        ...
        <span class="token property">"requestContext"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"resourceId"</span><span class="token operator">:</span> <span class="token string">"9df9s7"</span><span class="token punctuation">,</span>
            <span class="token property">"resourcePath"</span><span class="token operator">:</span> <span class="token string">"/{proxy+}"</span><span class="token punctuation">,</span>
            <span class="token property">"httpMethod"</span><span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>
            <span class="token property">"extendedRequestId"</span><span class="token operator">:</span> <span class="token string">"p9d45s2gIAMD9yg="</span><span class="token punctuation">,</span>
            <span class="token property">"requestTime"</span><span class="token operator">:</span> <span class="token string">"11/Oct/2020:11:37:39 +0000"</span><span class="token punctuation">,</span>
            <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"/ok"</span><span class="token punctuation">,</span>
            <span class="token property">"accountId"</span><span class="token operator">:</span> <span class="token string">"15635678299"</span><span class="token punctuation">,</span>
            <span class="token property">"protocol"</span><span class="token operator">:</span> <span class="token string">"HTTP/1.1"</span><span class="token punctuation">,</span>
            <span class="token property">"stage"</span><span class="token operator">:</span> <span class="token string">"production"</span><span class="token punctuation">,</span>
            <span class="token property">"domainPrefix"</span><span class="token operator">:</span> <span class="token string">"api"</span><span class="token punctuation">,</span>
            <span class="token property">"requestTimeEpoch"</span><span class="token operator">:</span> <span class="token number">1602416259517</span><span class="token punctuation">,</span>
            <span class="token property">"requestId"</span><span class="token operator">:</span> <span class="token string">"629ceff-03d3-4939-b008-a9920072979e"</span><span class="token punctuation">,</span>
            <span class="token property">"identity"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"cognitoIdentityPoolId"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                <span class="token property">"accountId"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                <span class="token property">"cognitoIdentityId"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                <span class="token property">"caller"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                <span class="token property">"sourceIp"</span><span class="token operator">:</span> <span class="token string">"111.222.333.444"</span><span class="token punctuation">,</span>
                <span class="token property">"principalOrgId"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                <span class="token property">"accessKey"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                <span class="token property">"cognitoAuthenticationType"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                <span class="token property">"cognitoAuthenticationProvider"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                <span class="token property">"userArn"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                <span class="token property">"userAgent"</span><span class="token operator">:</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36"</span><span class="token punctuation">,</span>
                <span class="token property">"user"</span><span class="token operator">:</span> <span class="token null keyword">null</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"domainName"</span><span class="token operator">:</span> <span class="token string">"api.example.com"</span><span class="token punctuation">,</span>
            <span class="token property">"apiId"</span><span class="token operator">:</span> <span class="token string">"9sa8ucem6g"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ...</code></pre></div><p>The <code class="language-text">requestContext</code> has a lot of useful information but most importantly it has an <code class="language-text">identity</code> node representing the user‚Äôs AWS Cognito identity. In this case everything is <code class="language-text">null</code>. That‚Äôs because we didn‚Äôt include any information about our identity pool when making the request.</p><p>More coming‚Ä¶</p><h1 id="storing-and-retrieving-items-from-the-database" style="position:relative;"><a href="#storing-and-retrieving-items-from-the-database" aria-label="storing and retrieving items from the database permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Storing and retrieving items from the database</h1><h1 id="sending-email" style="position:relative;"><a href="#sending-email" aria-label="sending email permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sending email</h1><h1 id="working-locally" style="position:relative;"><a href="#working-locally" aria-label="working locally permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Working locally</h1><h1 id="testing" style="position:relative;"><a href="#testing" aria-label="testing permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Testing</h1></section></div><hr/><h2>Comments</h2><div class="sc-ifAKCX ddlDEo github"><div><p>Thanks for reading ‚ù§Ô∏è ‚Äì comment by replying to the <a href="https://github.com/jeffrafter/jeffrafter.github.io/issues/14">issue for this post</a>.<!-- --> <!-- -->There‚Äôs no comments yet; you could be the first.<br/></p></div><div class="sc-gzVnrw bOnSNx"><a href="https://github.com/jeffrafter/jeffrafter.github.io/issues/14#new_comment_field" target="_blank" rel="noreferrer noopener" class="button btn">Add a comment ‚Üí</a></div></div><hr/><h2>There‚Äôs more to read</h2><div><p><em>Looking for more long-form posts? Here ya go...</em></p></div><ul class="sc-htoDjs gXLbcD"><li><a rel="prev" href="/terraform-and-aws/">‚Üê <!-- -->Terraform and Amazon Web Services</a></li><li><a rel="next" href="/getting-started-with-unity-and-vr/">Getting Started With Unity and Virtual Reality<!-- --> ‚Üí</a></li></ul></div></article></main><footer class="sc-bwzfXH aCPwf footer">¬© <!-- -->2021<!-- -->,<!-- --> <a href="https://jeffrafter.com">jeffrafter.com</a>. Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-61511214-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/express-and-aws/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-3b271d6a60df7cd92087.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-6846fb06ec67c7df9104.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-06b4f92e6d6da3e7e748.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-62ade78c2e0e44b33fb5.js"],"component---src-pages-tags-tsx":["/component---src-pages-tags-tsx-85ba1002141d5ed31e60.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-30b85df3d8081f386f13.js"],"component---src-templates-tag-tsx":["/component---src-templates-tag-tsx-1289ad2b8e0e8d66d692.js"]};/*]]>*/</script><script src="/component---src-templates-post-tsx-30b85df3d8081f386f13.js" async=""></script><script src="/commons-52923487d36b93dc329d.js" async=""></script><script src="/app-3b271d6a60df7cd92087.js" async=""></script><script src="/styles-fa79fef4936efa84b233.js" async=""></script><script src="/framework-8dcecaaefd71e2213eb2.js" async=""></script><script src="/webpack-runtime-38c8a4ef93b968ef91ae.js" async=""></script></body></html>